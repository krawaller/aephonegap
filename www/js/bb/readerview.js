(function(){CATS.bb.ReaderView=CATS.bb.BaseView.extend({tagName:"div",className:"reader",template:$("#readerviewtemplate").html(),localizeid:"reader",events:{"click .modalcloserbutton":"signal","click .buttonpreviousmodal":"clickPrevModal","click .buttonmodalindex":"showIndex","click .buttonmodalleft":"goLeft","click .buttonmodalright":"goRight","click .buttonmodalheadleft":"goLeft","click .buttonmodalheadright":"goRight"},goLeft:function(){return this.currentView.goLeft()},goRight:function(){return this.currentView.goRight()},initialize:function(o){this.listenTo(Backbone,"modal",function(what,data){return this.modalCall(what,data)});this.listenTo(Backbone,"closemodal",this.closeMe);this.listenTo(Backbone,"modalindex",this.hideIndexBtn);this.listenTo(Backbone,"modalitem",this.showIndexBtn);this.listenTo(Backbone,"starttour",this.closeMe);this.listenTo(Backbone,"updatemodalnav",this.updateNav);return this.constructor.__super__.initialize.apply(this,[o])},showIndexBtn:function(){var _ref;console.log("showingbutton?",(_ref=this.displayedview)!=null?_ref.lookup:void 0);if(this.displayedview&&this.displayedview.lookup){return this.$el.addClass("showingmodalindex")}},updateNav:function(left,right){this.$el[left?"addClass":"removeClass"]("navleft");return this.$el[right?"addClass":"removeClass"]("navright")},hideIndexBtn:function(){return this.$el.removeClass("showingmodalindex")},showIndex:function(){return this.displayedview.showIndex()},render:function(){this.$el.html(this.template);this.setUI("davidmodal","davidmodalbody","modalheadline","buttonpreviousmodal","buttonpreviousmodaltext","buttonmodalindex");this.localize();this.ui.davidmodal.hide();$(".main .davidmodalbackdrop").hide();this.glossaryview=(new CATS.bb.GlossaryView).render();this.glossaryview.keep=true;this.toolboxview=(new CATS.bb.ToolboxView).render();this.toolboxview.keep=true;this.infoview=(new CATS.bb.InfoView).render();this.infoview.keep=true;this.expressionsview=(new CATS.bb.ExpressionsView).render();this.expressionsview.keep=true;return this},modalCall:function(what,data,previous){var view;console.log("MODALCALL",what,data);view=function(){switch(what){case"toolbox":if(data&&!previous){this.toolboxview.showItem(data)}return this.toolboxview;case"checkmathobj":return new CATS.bb.MathView(data);case"expressions":return this.expressionsview;case"settings":return new CATS.bb.SettingsView;case"reporttext":return new CATS.bb.ReportTextView(data);case"glossary":if(data&&!previous){this.glossaryview.showItem(data)}return this.glossaryview;case"info":if(data&&!previous){this.infoview.showItem(data)}return this.infoview}}.call(this);if(data&&view.lookup){this.showIndexBtn()}else{this.hideIndexBtn()}this.fixPrevModalButton(what,data);this.lastcall={what:what,data:data};if(view){this.showView(view,what);this.currentView=view;if(view.updateButtons){return view.updateButtons()}}},fixPrevModalButton:function(what,data){var _ref;if((_ref=this.prevmodal)==null){this.prevmodal={what:what,data:data}}if(this.showing){console.log("updating prevmodalbutton. heading to",what,data,"button right now points to",this.prevmodal.what,this.prevmodal.data,"last call was",this.lastcall.what);if(what!==this.lastcall.what){this.prevmodal=this.lastcall;this.ui.buttonpreviousmodaltext.setText(["ui","reader","buttonbackto"+this.prevmodal.what,CATS.settings.lang],true);return this.$el.addClass("showprevmodalbtn")}}else{this.prevmodal={what:what,data:data};return this.$el.removeClass("showprevmodalbtn")}},clickPrevModal:function(){var nowat;console.log("going back! am at",this.lastcall.what,"button points to",this.prevmodal.what,this.prevmodal.data);nowat=this.lastcall;this.modalCall(this.prevmodal.what,this.prevmodal.data,true);this.prevmodal=nowat;return this.ui.buttonpreviousmodaltext.setText(["ui","reader","buttonbackto"+this.prevmodal.what,CATS.settings.lang],true)},showView:function(view,what){if(this.displayedview){if(this.displayedview.keep){this.displayedview.$el.hide()}else{this.displayedview.kill()}}this.displayedview=view;if(view.lookup){console.log("LOOKUPVIEW",view.indexing);if(!view.indexing){this.showIndexBtn()}else{this.hideIndexBtn()}}if(!view.keep){view.render()}else{view.$el.show()}this.ui.davidmodalbody.append(view.el);this.what=what;this.localizeSpecial();if(!this.showing){$(".main .davidmodalbackdrop").show();this.ui.davidmodal.show();setTimeout(function(){return $("body").addClass("showingdavidmodal")},10);return this.showing=true}},localizeSpecial:function(){if(this.displayedview){return this.ui.modalheadline.setText(["ui","reader","headline"+this.displayedview.localizeid,CATS.settings.lang],false,false,true)}},closeMe:function(){this.showing=false;$("body").removeClass("showingdavidmodal");setTimeout(_.bind(function(){$(".main .davidmodalbackdrop").hide();return this.ui.davidmodal.hide()},this),400);return this.hideIndexBtn()},signal:function(){return Backbone.trigger("closemodal")}})}).call(this);
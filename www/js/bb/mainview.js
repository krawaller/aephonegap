(function(){CATS.bb.MainView=CATS.bb.BaseView.extend({tagName:"div",className:"main nofocus",template:$("#mainviewtemplate").html(),localizeid:"main",events:{"click .textreport":"textReport","click .btn-group[data-toggle='buttons-radio']":"radioButtons","click .errorlink":"errorLink","click .mathobj":"showMath"},showMath:function(e){return console.log("WOOO",e,$(e.target).closest(".mathobj").attr("data-obj"))},radioButtons:function(e){var btngroup,dataname,hidden,src,val;src=$(e.srcElement||e.target).closest("button");val=src.val();btngroup=src.closest(".btn-group");dataname=btngroup.attr("data-name");hidden=btngroup.prev();hidden.val(val);btngroup.find(".active").removeClass("active");src.addClass("active");console.log("EVENT",e);console.log("RADIO BUTTON SELECT",dataname,val,"found btngroup",btngroup.length,"found hidden",hidden.length);return btngroup.trigger("radiobtnselect",{val:val,dataname:dataname})},focusTextField:function(){this.$el.addClass("focusedtext").removeClass("nofocus");return this.ui.buttoncalc.addClass("active")},blurTextField:function(){this.$el.removeClass("focusedtext").addClass("nofocus");return this.ui.buttoncalc.removeClass("active")},initialize:function(o){var me;this.updateDimensionsDo=_.bind(this.updateDimensionsDo,this);this.updateDimensions=_.bind(this.updateDimensions,this);this.updateDimensions();$(window).on("orientationchange",this.updateDimensions);if(window.location.protocol.match("http")||window.location.pathname.match("KungD")){$(window).resize(this.updateDimensions)}this.listenTo(Backbone,"sethideexpl",this.updateHideExpl);this.listenTo(Backbone,"settextreportmode",this.updateTextReport);this.listenTo(Backbone,"sethidehelpmode",this.updateHideHelp);this.listenTo(Backbone,"setqmode",this.updateQuestionMode);this.listenTo(Backbone,"focusTextField",this.focusTextField);this.listenTo(Backbone,"blurTextField",this.blurTextField);me=this;console.log("UPSTART");this.prepareData(function(){console.log("RENDERING");me.render();$("body").prepend(me.el);console.log("DOOOONE! WOO!");return setTimeout(function(){return $("body").addClass("loaded")},800)});return this.constructor.__super__.initialize.apply(this,[o])},prepareData:function(callback){var lang,_i,_len,_ref;CATS.math.augmentTooldefsWithDependencies(CATS.math);CATS.math.simplifiers=CATS.math.gatherSimplifiers(CATS.math);CATS.math.decimalifiers=CATS.math.gatherDecimalifiers(CATS.math);CATS.math.desperates=CATS.math.gatherDesperates(CATS.math);CATS.texts.wordIndex={};CATS.texts.toolIndex={};CATS.texts.infoIndex={};console.log("FFS",CATS.texts);CATS.math.count=CATS.texts.totalToolCount();_ref=["sv","en"];for(_i=0,_len=_ref.length;_i<_len;_i++){lang=_ref[_i];CATS.texts.wordIndex[lang]=CATS.texts.makeWordIndex(lang);CATS.texts.toolIndex[lang]=CATS.texts.makeToolIndex(lang);CATS.texts.infoIndex[lang]=CATS.texts.makeInfoIndex(lang)}CATS.texts.generateToolTagIndex();CATS.texts.generateAllToolLists();if(callback){return callback()}},render:function(){this.$el.append((new CATS.bb.LanguageSelectView).render().el);$("#loadscreen").hide();return this.listenTo(Backbone,"setlang",this.render2)},render2:function(){$("#loadscreen").show();this.$el.html(this.template);this.setUI("wrapper","controlpanelsection","homesection","modalsection","leftsection","toursection","parsersection","buttoncalc","calcsection","schoolrootsection","glossarysection","toolboxsection");this.ui.controlpanelsection.append((new CATS.bb.ControlpanelView).render().el);this.ui.modalsection.append((new CATS.bb.ReaderView).render().el);this.ui.homesection.append((new CATS.bb.InfoTabView).render().rootMe("home").$el);this.ui.calcsection.append((new CATS.bb.ParserView).render().rootMe("calc").$el.addClass("active"));this.ui.glossarysection.append((new CATS.bb.WordIndexView).render().rootMe("glossary").el);this.ui.toolboxsection.append((new CATS.bb.ToolIndexView).render().rootMe("toolbox").el);this.ui.schoolrootsection.append((new CATS.bb.LessonListView).render().rootMe("schoolroot").el);$("#loadscreen").hide();this.$el.show();this.$(".davidmodalbackdrop").hide();this.localize();this.updateTextReport();this.updateHideHelp();setTimeout(this.updateDimensions,10);return this},doLangTip:function(){console.log("DOing langtip",$(".buttonsettings"));$(".buttonsettings").tooltip({html:true,trigger:"manual",placement:"right",title:this.getText(["ui","main","langtip",CATS.settings.lang],true)});$(".buttonsettings").tooltip("show");return setTimeout(function(){return $(".buttonsettings").tooltip("destroy")},4e3)},updateDimensions:function(){clearTimeout(this.dimtime);return this.dimtime=setTimeout(this.updateDimensionsDo,100)},updateDimensionsDo:function(){var height,min,orientation,size,width;clearTimeout(this.dimtime);console.log("WOOO",this);height=document.documentElement.clientHeight;width=document.documentElement.clientWidth;CATS.settings.height=height;CATS.settings.width=width;orientation=height>width?"portrait":"landscape";min=Math.min(height,width);size=width<710||height<390?"phone":"large";$("body").removeClass("phone").removeClass("large").removeClass("portrait").removeClass("landscape").addClass(size).addClass(orientation);CATS.settings.orientation=orientation;CATS.settings.size=size;return console.log("DIMENSIONS",orientation,size,height,width)},updateTextReport:function(){return $("body")[CATS.settings.textreportmode==="yes"?"addClass":"removeClass"]("textreportmode")},updateHideHelp:function(){$("body")[CATS.settings.hidehelpmode==="yes"?"addClass":"removeClass"]("hidehelpmode");return localStorage.setItem("ALGEBRAEXPLORERSETTINGS",JSON.stringify(CATS.settings))},updateQuestionMode:function(to){console.log("QMODE",to);return $("body")[to==="yes"?"addClass":"removeClass"]("usingq")},textReport:function(e){return Backbone.trigger("modal","reporttext",{why:"textreport",text:$(e.currentTarget).parent().text().slice(0,-1),path:$(e.currentTarget).attr("path")})},errorLink:function(e){return Backbone.trigger("modal","reporttext",{why:"direct"})}})}).call(this);
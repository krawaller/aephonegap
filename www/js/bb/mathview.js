(function(){CATS.bb.MathView=CATS.bb.BaseView.extend({template:$("#mathviewtemplate").html(),localizeid:"mathview",className:"mathview davidmodalcontent",initialize:function(mathobj){this.mathobj=mathobj;return this.constructor.__super__.initialize.apply(this,arguments)},render:function(){this.$el.html(this.template);this.setUI("jaxcont","objcont","descriptioncontent");this.setUIprocessTexts("structinstruction");this.localize();this.draw();if(!(this.mathobj.objs&&this.mathobj.objs.length)){this.ui.structinstruction.hide()}this.$el.prepend(this.getUnderConstructionHTML());return this},cleanViews:function(){var view,_i,_len,_ref,_results;_ref=this.childViews||[];_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){view=_ref[_i];_results.push(view.kill())}return _results},draw:function(){var jaxview,mobj,objview;this.cleanViews();mobj=this.mathobj;console.log("DRAWING",this.addr,mobj);jaxview=new CATS.bb.jaxview(mobj,this.addr?[this.addr]:[]);this.ui.jaxcont.append(jaxview.render().el);objview=new CATS.bb.objview(mobj,this.addr?[this.addr]:[]);objview.on("clickedobject",this.zoom,this);this.ui.objcont.append(objview.render().el);this.childViews=[jaxview,objview];return this.typeset(this.el)},localizeSpecial:function(){var lang,lines,mobj,parent,pos,ptype,str,type,_ref;lines=CATS.texts.ui.mathview;if((_ref=this.addr)==null){this.addr=[]}mobj=CATS.math.lookUp(this.mathobj,this.addr);type=mobj.type;lang=CATS.settings.lang;str="";if(this.addr.length){parent=CATS.math.lookUp(this.mathobj,this.addr.slice(0,-1));ptype=parent.type;pos=this.addr.slice(-1);console.log("PARENT",ptype,ptype+"child"+pos,lines[ptype+"child"+pos],lines[ptype+"child"]);str=lines.chose[lang]+" ";str+=lines[ptype+"child"+pos]?lines[ptype+"child"+pos][lang]:(lines[ptype+"child"]||lines.objectchild)[lang]+" "+(1+parseInt(pos));str+=" "+lines.inside[lang]+" "+(lines[ptype+"item"]||lines.objectitem)[lang]+". "}str+=(this.addr.length?lines.chosebeginning:lines.beginning)[lang]+" ";str+=CATS.texts.describe(mobj,lang);return this.ui.descriptioncontent.html(CATS.texts.processText(str,lang))},zoom:function(addr){this.addr=addr;this.draw();this.localizeSpecial();this.$el.addClass("zoomed");return console.log("ZOOOOM",addr)}})}).call(this);
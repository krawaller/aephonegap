(function(){CATS.bb.MathView=CATS.bb.BaseView.extend({localizeid:"mathview",className:"mathview viewbox",initialize:function(){return this.constructor.__super__.initialize.apply(this,arguments)},category:"calc",events:{"click .structobj":"selectObj","click button":"toggleImplicit"},render:function(){this.setContent(CATS.cache.templates["#mathviewtemplate"]);this.setTitle("mathheader");this.setUI("jaxcontwith","jaxcontwithout","objcont","descriptioncontent","structinstruction","showimplicitbutton");return this},toggleImplicit:function(e){return $(e.srcElement||e.target).closest(".togglebox").toggleClass("togglesecond")},showItem:function(str){this.mathobj=JSON.parse(str);this.implicit=CATS.app.helpers.hasimplicit(this.mathobj);if(!this.implicit){this.ui.showimplicitbutton.hide()}return this.draw()},draw:function(){this.drawMath();this.drawObj();return this.drawText()},drawMath:function(){var me;me=this;this.ui.jaxcontwith.html(CATS.app.mathmlprinter(this.mathobj,this.addr?[this.addr]:[],[],void 0,CATS.settings));this.typeset(this.ui.jaxcontwith,function(){return me.ui.jaxcontwith.find(".mathobj").removeClass(".mathobj")});if(this.implicit){this.ui.jaxcontwithout.html(CATS.app.mathmlprinter(this.mathobj,this.addr?[this.addr]:[],[],void 0,CATS.settings,void 0,true));return this.typeset(this.ui.jaxcontwithout,function(){return me.ui.jaxcontwithout.find(".mathobj").removeClass(".mathobj")})}},drawObj:function(){return this.ui.objcont.html(CATS.app.objprinttable({o:this.mathobj,prepath:this.addr?[this.addr]:[],markpaths:[],lang:CATS.settings.lang}))},selectObj:function(e){var addrlength,addrstr,attr,clickedobj,n,_ref;e.stopPropagation();e.preventDefault();clickedobj=$(e.currentTarget);attr=clickedobj.attr("data-addr");_ref=$(e.currentTarget).attr("data-addr").split("|"),addrlength=_ref[0],addrstr=_ref[1];this.ui.objcont.find(".markme").removeClass("markme");this.ui.objcont.find(".markchild").removeClass("markchild");this.ui.objcont.find(".group"+addrstr).addClass("markchild");console.log("Now marking "+addrstr);clickedobj.addClass("markme");return this.zoom(function(){var _i,_len,_ref1,_results;if(addrlength==="0"){return[]}else{_ref1=addrstr.split("_");_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){n=_ref1[_i];_results.push(parseInt(n))}return _results}}())},drawText:function(){var lang,str,_ref;lang=CATS.settings.lang;if((_ref=this.addr)==null){this.addr=[]}if(this.addr.length===0&&this.mathobj.objs){this.ui.structinstruction.show()}else{this.ui.structinstruction.hide()}str=CATS.texts.youhavechosen(this.mathobj,this.addr,lang);return this.ui.descriptioncontent.html(CATS.texts.processText(str,lang))},zoom:function(addr){this.addr=addr;this.drawMath();this.drawText();return this.$el.addClass("zoomed")}})}).call(this);
(function(){CATS.bb.MathView=CATS.bb.BaseView.extend({localizeid:"mathview",className:"mathview viewbox",initialize:function(){return this.constructor.__super__.initialize.apply(this,arguments)},category:"calc",events:{"click .structobj":"selectObj","click button":"toggleImplicit"},render:function(){this.setContent(CATS.cache.templates["#mathviewtemplate"]);this.setTitle("mathheader");this.setUI("jaxcontwith","jaxcontwithout","objcont","descriptioncontent","structinstruction","showimplicitbutton");return this},toggleImplicit:function(e){return $(e.srcElement||e.target).closest(".togglebox").toggleClass("togglesecond")},showItem:function(str){this.mathobj=JSON.parse(str);if(!CATS.app.helpers.hasimplicitmult(this.mathobj)){this.ui.showimplicitbutton.hide()}return this.draw()},draw:function(){this.drawMath();this.drawObj();return this.drawText()},drawMath:function(){this.ui.jaxcontwith.html(CATS.app.mathmlprinter(this.mathobj,this.addr?[this.addr]:[],[]));this.typeset(this.ui.jaxcontwith);this.ui.jaxcontwith.find(".mathobj").removeClass(".mathobj");if(CATS.app.helpers.hasimplicitmult(this.mathobj)){this.ui.jaxcontwithout.html(CATS.app.mathmlprinter(this.mathobj,this.addr?[this.addr]:[],[],void 0,void 0,void 0,true));this.typeset(this.ui.jaxcontwithout);return this.ui.jaxcontwithout.find(".mathobj").removeClass(".mathobj")}},drawObj:function(){return this.ui.objcont.html(CATS.app.objprinter(this.mathobj,this.addr?[this.addr]:[],[]))},selectObj:function(e){var addrlength,addrstr,attr,clickedobj,n,_ref;e.stopPropagation();e.preventDefault();clickedobj=$(e.currentTarget);attr=clickedobj.attr("data-addr");_ref=$(e.currentTarget).attr("data-addr").split("|"),addrlength=_ref[0],addrstr=_ref[1];this.ui.objcont.find(".markme").removeClass("markme");clickedobj.addClass("markme");return this.zoom(function(){var _i,_len,_ref1,_results;if(addrlength==="0"){return[]}else{_ref1=addrstr.split(",");_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){n=_ref1[_i];_results.push(parseInt(n))}return _results}}())},drawText:function(){var lang,lines,mobj,parent,pos,ptype,str,type,_ref;lines=CATS.texts.ui.mathview;if((_ref=this.addr)==null){this.addr=[]}if(this.addr.length===0&&this.mathobj.objs){this.ui.structinstruction.show()}else{this.ui.structinstruction.hide()}mobj=CATS.math.lookUp(this.mathobj,this.addr);type=mobj.type;lang=CATS.settings.lang;str="";if(this.addr.length){parent=CATS.math.lookUp(this.mathobj,this.addr.slice(0,-1));ptype=parent.type;pos=this.addr.slice(-1);console.log("PARENT",ptype,ptype+"child"+pos,lines[ptype+"child"+pos],lines[ptype+"child"]);str=lines.chose[lang]+" ";str+=lines[ptype+"child"+pos]?lines[ptype+"child"+pos][lang]:(lines[ptype+"child"]||lines.objectchild)[lang]+" "+(1+parseInt(pos));str+=" "+lines.inside[lang]+" "+(lines[ptype+"item"]||lines.objectitem)[lang]+". "}str+=(this.addr.length?lines.chosebeginning:lines.beginning)[lang]+" ";str+=CATS.texts.describe(mobj,lang);return this.ui.descriptioncontent.html(CATS.texts.processText(str,lang))},zoom:function(addr){this.addr=addr;this.drawMath();this.drawText();return this.$el.addClass("zoomed")}})}).call(this);
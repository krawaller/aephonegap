(function(){CATS.bb.TourView=CATS.bb.BaseView.extend({events:{"click button.tourender":"endTour",click:"nextTourItem"},initialize:function(o){var item;this.$el.hide();this.listenTo(Backbone,"starttour",this.startTour);this.touritems=function(){var _results;_results=[];for(item in CATS.texts.tour){_results.push(item)}return _results}();this.setUI("popover","popovercontent","middlemarker");return this.constructor.__super__.initialize.apply(this,[o])},endTour:function(){$(".tourhighlight").removeClass("tourhighlight");this.$el.hide("fast");return delete this.target},startTour:function(){this.$el.show("fast");this.pos=-1;return this.nextTourItem()},nextTourItem:function(){var lang,leftextra,pos,touritem,_ref,_ref1,_ref2;lang=CATS.settings.lang;this.pos++;if(this.pos===this.touritems.length){return this.endTour()}else{console.log("TOTOTT",this.touritems,this.pos);touritem=CATS.texts.tour[this.touritems[this.pos]];$(".tourhighlight").removeClass("tourhighlight");if(touritem.selector){this.target=$(touritem.selector).addClass("tourhighlight")}else{delete this.target}this.ui.popovercontent.animate({opacity:0},{duration:150,complete:function(){return $(this).html(touritem.content[lang]).animate({opacity:1},{duration:150})}});pos=this.target?this.target.position():{full:true,top:CATS.settings.height/2-40,left:CATS.settings.width/2-100};if(!pos.full&&!((_ref=touritem.offset)!=null?_ref.full:void 0)&&CATS.settings.orientation==="landscape"&&CATS.settings.size==="large"){leftextra=204}else{leftextra=0}console.log("POOOOS",pos);return this.ui.popover.animate({top:Math.floor(parseInt(pos.top))+(((_ref1=touritem.offset)!=null?_ref1.top:void 0)||0),left:Math.floor(parseInt(pos.left))+(((_ref2=touritem.offset)!=null?_ref2.left:void 0)||0)+leftextra},300,function(){return console.log("animated to new position!")})}}})}).call(this);
(function(){CATS.bb.LookupView=CATS.bb.BaseView.extend({initialize:function(o){this.startHist();return CATS.bb.BaseView.prototype.initialize.apply(this,[o])},template:$("#lookupviewtemplate").html(),startHist:function(){return this.history=[]},hpos:-1,lookup:true,className:"lookup",events:{"click .lookupindexitem":"clickedItemInIndex"},render:function(){this.$el.html(this.template);this.setUI("lookupindex","lookupitem");this.ui.lookupindex.append(this.indexview.render().el);this.ui.lookupitem.append(this.itemview.render().el);if(this.columns){this.ui.lookupindex.addClass("leftcolumn");this.ui.lookupitem.addClass("rightcolumn")}this.listenTo(Backbone,"setlang",this.changeLanguage);this.showIndex();return this},clickedItemInIndex:function(e){var item;item=$(e.currentTarget).attr("lookupid");console.log("lookupitemclick",item);return this.showItem(item)},changeLanguage:function(lang){if(this.currentitem){this.showItem(this.currentitem)}if(this.indexview.changeIndex){return this.indexview.changeIndex(lang)}},showItem:function(lookupid,histwalk){var _base;this.currentitem=lookupid;this.$el.removeClass("showingindex").addClass("showingitem");this.ui.lookupindex.find(".lookupcurrent").removeClass("lookupcurrent");this.ui.lookupindex.find("[lookupid='"+lookupid+"']").addClass("lookupcurrent");if(typeof(_base=this.indexview).lookingUp==="function"){_base.lookingUp(lookupid)}this.itemview.$el.show();this.itemview.showItem(lookupid);this.indexing=false;Backbone.trigger("modalitem");if(!histwalk){if(lookupid===this.history[this.history.length-1]){this.hpos=this.history.length-1}else{this.hpos=this.history.length;this.history.push(lookupid);if(this.hpos===20){this.hpos=19;this.history=this.history.slice(1)}}}return this.updateButtons()},showIndex:function(){this.$el.removeClass("showingitem").addClass("showingindex");this.indexing=true;return Backbone.trigger("modalindex")},updateButtons:function(){if(this.history){console.log("UPDATEBUTTONS","hpos",this.hpos,"historylen",this.history.length,"history",this.history,"LEFT",this.hpos>0,"RIGHT",this.hpos+1<this.history.length);return Backbone.trigger("updatemodalnav",this.hpos>0,this.hpos+1<this.history.length)}else{return Backbone.trigger("updatemodalnav",false,false)}},goLeft:function(){this.hpos--;return this.showItem(this.history[this.hpos],true)},goRight:function(){this.hpos++;return this.showItem(this.history[this.hpos],true)}})}).call(this);
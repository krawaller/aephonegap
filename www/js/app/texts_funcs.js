(function(){var addExampleContent,addMathContent,addToolLinks,checker,exampleContent,exportTo,generateAllToolLists,generateToolTagIndex,getCachedToolListsForTag,icon,k,links,makeToolIndex,makeWordIndex,mathContent,maths,numberStr,numbers,orderNumberStr,ordernumbers,ordersuffixes,processText,toolLink,toolListsForTag,totalToolCount,transformHtmlShorts,v,_ref;icon=(typeof require==="undefined"?this.CATS.app.helpers:require("./helpers")).icon;links=(typeof require==="undefined"?this.CATS.texts:"FOOBAR").links;maths={base:["x^y",[0]],basefactor:["(4x)^3",[0,0]],denominator:["x/y",[1]],denominatorfactor:["x/(y*z)",[1,1]],equality:"x=y",equation:"3x=6",exponent:["x^y",[1]],fraction:"x/y",fractionbase:["(x/y)^z",[0]],fractiondenominator:["x/(y/z)",[1]],fractionfactor:["x*(2/y)*z",[1]],fractionnumerator:["(x/y)/z",[0]],forbiddenequality:"2y!=7",fractionterm:["2+(x/y)+3",[1]],neg1:"-1",negativebase:["(-x)^y",[0]],negativeexponent:["x^-y",[1]],negativefactor:["x*(-y)*z",[1]],negativefraction:"-(x/y)",negativedenominatorfactor:["x/(y*-z)",[1,1]],negativenumeratorfactor:["(x*-y)/z",[0,1]],negativeproduct:"-(x*y)",negativeproductfactor:["x*(-(y*3))*z",[1]],negativesum:"-(x+y)",nonstrictcomparison:"3x<=2y",numerator:["x/y",[0]],numeratorfactor:["(xy)/z",[0,1]],percent:"%",product:"x*y*z",productbase:["(x*y)^z",[0]],productexponent:["x^(y*z)",[1]],productfactor:["x*(2*y)*z",[1]],productterm:["x+2y+z",[1]],power:"4^3",powerbase:["(x^y)^z",[0]],powerfactor:["x*(y^2)*z",[1]],powerproduct:"x2*y3*z4",rootindex:["3root8",[1]],strictcomparison:"3x<2y",sumbase:["(x+y)^z",[0]],sumexponent:["x^(y+z)",[1]],sumfactor:["3*(y+2)*z",[1]],sumterm:["x+(3+y)+5",[1]],variable:{sv:['5*"inköpspris"+7',[0,1]],en:['5*"price"+7',[0,1]]}};numbers={sv:["en","två","tre","fyra","fem","sex","sju","åtta","nio","tio","elva","tolv","tretton","fjorton","femton","sexton","sjutton","arton","nitton","tjugo"],en:["one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen","twenty"]};ordernumbers={sv:["första","andra","tredje","fjärde","femte","sjätte","sjunde","åttonde","nionde","tionde","elfte","tolfte"],en:["first","second","third","fourth","fifth","sixth","seventh","eighth","ninth","tenth","eleventh","twelfth"]};ordersuffixes={en:"th",sv:"de"};orderNumberStr=function(num,lang){return ordernumbers[lang][num-1]||(numbers[lang][num-1]?numbers[lang][num-1]+ordersuffixes:""+num)};numberStr=function(num,lang){return numbers[lang][num-1]||""+num};makeWordIndex=function(lang){var def,ret,word;ret=[];for(word in links){def=links[word];if(word!=="MAKESAFE"&&def.headline[lang]){ret.push([word,def.headline[lang]])}}return ret.sort(function(o1,o2){if(o1[1].toLowerCase()<o2[1].toLowerCase()){return-1}else{return 1}})};makeToolIndex=function(lang){var classes,def,headline,realdef,ret,tool,_ref,_ref1,_ref2;ret=[];_ref=CATS.texts.tools;for(tool in _ref){def=_ref[tool];if(!!(tool==="simplifier"||tool==="decimalifier")){continue}realdef=CATS.math[tool];classes=[];classes.push(((_ref1=realdef.info)!=null?_ref1.uses:void 0)?"toolcomplex":"toolatomic");if((_ref2=realdef.info)!=null?_ref2.effect:void 0){classes.push("tool"+realdef.info.effect)}headline=typeof def[lang]==="string"?def[lang]:def[lang].name;ret.push([tool,headline,classes])}return ret.sort(function(o1,o2){if(o1[1].toLowerCase()<o2[1].toLowerCase()){return-1}else{return 1}})};totalToolCount=function(){var compl,def,effect,realdef,ret,tool,_name,_ref,_ref1,_ref2;ret={total:0};_ref=CATS.texts.tools;for(tool in _ref){def=_ref[tool];if(!!(tool==="simplifier"||tool==="decimalifier")){continue}ret.total++;realdef=CATS.math[tool];if(!realdef||!realdef.info){console.log("ACK",tool,"GOT",realdef)}compl=((_ref1=realdef.info)!=null?_ref1.uses:void 0)?"complex":"atomic";effect=realdef.info.effect;if((_ref2=ret[_name=compl+effect])==null){ret[_name]=0}ret[compl+effect]++}return ret};checker=function(){var def,done,remaining,toolname,_ref;done=0;remaining=0;_ref=CATS.texts.tools;for(toolname in _ref){def=_ref[toolname];if(typeof def.sv==="string"){remaining++}else{done++}}console.log("DONE",done,"REMAINING",remaining);return done+"/"+(done+remaining)};generateAllToolLists=function(callback){var tag;console.log("OK, gonna do all tool lists! Wee!");for(tag in CATS.texts.links){if(tag!=="MAKESAFE"){CATS.cache.lists[tag]=toolListsForTag(tag)}}console.log("DONE!",CATS.cache.lists);if(callback){return callback()}};toolListsForTag=function(tag,lang){var kind,num,ret,toolIndex,toolname,tools,_i,_j,_len,_len1,_ref,_ref1;toolIndex=CATS.texts.toolTagIndex;ret={notoollist:CATS.texts.links[tag].notoollist};if(!ret.notoollist){_ref=["basic","complex"];for(_i=0,_len=_ref.length;_i<_len;_i++){kind=_ref[_i];tools=((_ref1=toolIndex[tag])!=null?_ref1[kind]:void 0)||[];num=0;if(tools.length===0){}else{for(_j=0,_len1=tools.length;_j<_len1;_j++){toolname=tools[_j];num+=toolname.split("|").length}}ret[kind]=num}}return ret};generateToolTagIndex=function(){var me,opp,realdef,tag,tagindex,tool,_i,_len,_ref,_ref1,_ref2;tagindex={};_ref=CATS.math;for(tool in _ref){realdef=_ref[tool];if(!(realdef.info&&!(tool==="simplifier"||tool==="decimalifier"))){continue}opp=realdef.info.opposite||"";if(tool>opp){me=tool+(opp?"|"+opp:"");_ref1=realdef.info.tags||[];for(_i=0,_len=_ref1.length;_i<_len;_i++){tag=_ref1[_i];if(!CATS.texts.links[tag]){throw"UNKNOWN LINK: "+realdef.info.name+" ---- "+tag}if((_ref2=tagindex[tag])==null){tagindex[tag]={basic:[],complex:[]}}tagindex[tag][realdef.info.uses?"complex":"basic"].push(me)}}}return CATS.texts.toolTagIndex=tagindex};getCachedToolListsForTag=function(tag){return CATS.cache.lists[tag]};processText=function(text,lang,except,words){var lookfor,regex,safe;if(!words&&typeof CATS!==void 0){words=CATS.texts.links;console.log("PROCESSING TEXT",text)}text="</a> "+text;if(except){console.log("PROCESSING TEXT",text,"except",except)}for(lookfor in words){if(!words[lookfor].matcher[lang]){continue}regex=new RegExp("[.]*\\<\\/[^\\>]*\\>[^\\<]*?([ (]|^)(("+words[lookfor].matcher[lang]+")[ ).!?:;\\-,])","gi");safe=0;while(safe<10&&text.match(regex)){text=text.replace(regex,function(wholematch,start,matchwithend,match){var end,intro,link;link=lookfor!==except&&lookfor!=="MAKESAFE"?"<a href='#' class='wordlink' linkto='"+lookfor+"'>"+match+"</a>":"<span>"+match+"</span>";end=matchwithend.substr(match.length);intro=wholematch.substr(0,wholematch.length-matchwithend.length);return""+intro+start+link+end})}}return transformHtmlShorts(text.slice(5),lang,words)};addToolLinks=function(text,lang){return text.replace(/TOOL\[([^\[\]]*)]/g,function(toolpart,toolname,charnum,full){if(!CATS.texts.tools[toolname]){console.log("WHAT THE EFFFF",full);throw"Cannot find tool to link to: "+toolname}return toolLink(toolname,lang)})};toolLink=function(toolname,lang){var name;name=CATS.texts.tools[toolname][lang].name||CATS.texts.tools[toolname][lang];return"<a href='#' class='toollink intexttoollink' linkto='"+toolname+"'>"+name+"</a>"};addExampleContent=function(text){return text.replace(/EXAMPLE\[([^\[\]]*)]/g,function(part,str,a,b,c){var both,toolid,_ref;_ref=str.split("|"),toolid=_ref[0],both=_ref[1];return exampleContent(toolid,both)})};exampleContent=function(toolid,both){var example;example=$("#EXAMPLE"+toolid).children();return"<div class='clearfix clear-both opsection'>\n	<div class='opcontainer'>\n		<div class='beforecontainer oppartcontainer'>"+example.eq(0).html()+"</div>\n		<div class='arrow'>"+(both?"&harr;":"&rarr;")+"</div>\n		<div class='aftercontainer oppartcontainer'>"+example.eq(1).html()+"</div>\n	</div>\n</div>"};mathContent=function(mathstr){var mathid,mathprint,objprint,objtoo,_ref,_ref1;_ref=mathstr.split("|"),mathid=_ref[0],objtoo=_ref[1];if(!maths[mathid]){throw"Cannot find math content "+mathid}_ref1=$("#MATH"+mathid).children(),mathprint=_ref1[0],objprint=_ref1[1];return"<div class='exampleholder mathblock'>"+$(mathprint).html()+(objtoo?"<div class='objholder'><div class='mathobj clearfix'>"+$(objprint).html()+"</div></div>":"")+"</div>"};addMathContent=function(text,lang){return text.replace(/MATH\[([^\[\]]*)]/g,function(part,mathstr,a,b,c){return mathContent(mathstr,lang)})};transformHtmlShorts=function(text,lang,words){text=text.replace(/\ *NEWLINE\ */g,"<br><br/>");text=text.replace(/\ *LIST___(.*?)___LIST\ */g,function(full,items){return"<ul class='intextlist'>"+(items+"___").replace(/(.*?)___/g,function(withunderscores,item,a,b,c){return"<li>"+item+"</li>"})+"</ul>"});return text=text.replace(/WORDLIST\[([^\[\]]*)]/g,function(part,wordlist){var listedwords,word;listedwords=wordlist.split(",");return"<div class='davidlist'>"+function(){var _i,_len,_results;_results=[];for(_i=0,_len=listedwords.length;_i<_len;_i++){word=listedwords[_i];_results.push("<a href='#' class='wordlink davidlink' linkto='"+word+"'>"+words[word].headline[lang]+"</a>")}return _results}().join("")+"</div>"})};if(typeof exports==="undefined"){exportTo=this.CATS.texts}else{exportTo=exports}_ref={mathContent:mathContent,processText:processText,addToolLinks:addToolLinks,maths:maths,getCachedToolListsForTag:getCachedToolListsForTag,orderNumberStr:orderNumberStr,numberStr:numberStr,numbers:numbers,ordernumbers:ordernumbers,ordersuffixes:ordersuffixes,generateToolTagIndex:generateToolTagIndex,makeToolIndex:makeToolIndex,checker:checker,totalToolCount:totalToolCount,makeWordIndex:makeWordIndex,generateAllToolLists:generateAllToolLists,toolListsForTag:toolListsForTag};for(k in _ref){v=_ref[k];exportTo[k]=v}}).call(this);
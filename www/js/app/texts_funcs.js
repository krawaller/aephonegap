(function(){var addExampleContent,addMathContent,addToolLinks,augmentToolTag,checker,exampleContent,exportTo,generateAllToolLists,generateToolTagIndex,getCachedToolListsForTag,icon,k,links,makeToolIndex,makeWordIndex,mathContent,maths,numberStr,numbers,opsLeft,orderNumberStr,ordernumbers,ordersuffixes,processText,toolLink,toolListsForTag,tools,totalToolCount,transformHtmlShorts,v,_ref,_ref1,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};_ref=typeof require==="undefined"?this.CATS.app.helpers:require("./helpers"),icon=_ref.icon,augmentToolTag=_ref.augmentToolTag;links=(typeof require==="undefined"?this.CATS.texts:"FOOBAR").links;tools=(typeof require==="undefined"?this.CATS.texts:"FOOBAR").tools;maths={absolute:"|x|",additionexample:"1+2=3",additionneutral:"5+0=5",additioncommutativity:"1+2=2+1",additionassociativity:"1+(2+3)=(1+2)+3",associativity:"a+(b+c)=a+b+c",base:["x^y",[0]],basefactor:["(4x)^3",[0,0]],base10log:"lg7",coefficient:["5x",[0]],commutativity:"a+b=b+a",constanti:"i",cubicroot:{en:"cbrt5",sv:"3rot5"},denominator:["x/y",[1]],denominatorfactor:["x/(y*z)",[1,1]],difference:"5-2",divisionexample:"10/2=5",divisiondecimal:"10/4=2.5",divisionnotcommutative:"10/2!=2/10",divisionneutralelement:"10/1=10",divisionzerodenom:{en:"10/0=undefined",sv:"10/0=odefinierad"},divtest:{sv:"3delar18",en:"3divs18"},distribution:"a(b+c)=ab+ac",elsebranch:{sv:["om (x<0) så -x annars x",[2]],en:["if (x<0) then -x else x",[2]]},equality:"x=y",equation:"3x=6",exponent:["x^y",[1]],exponent2:["x^2",[1]],example:"3-((2*x)/5)",fraction:"x/y",fractionbase:["(x/y)^z",[0]],fractiondenominator:["x/(y/z)",[1]],fractionfactor:["x*(2/y)*z",[1]],fractionnumerator:["(x/y)/z",[0]],forbiddenequality:"2y!=7",ifcondition:{sv:["om (x<0) så -x annars x",[0]],en:["if (x<0) then -x else x",[0]]},ifelse:{sv:"om (x<0) så -x annars x",en:"if (x<0) then -x else x"},integertest:{sv:"8heltal",en:"8int"},fractionterm:["2+(x/y)+3",[1]],logicand:{en:"(x=2)and(y<5)",sv:"(x=2)och(y<5)"},logicnot:{en:"notp",sv:"ejp"},logicor:{en:"(x=2)or(y<5)",sv:"(x=2)eller(y<5)"},multiplicationexample:"3*4=12",multiplicationisaddition:"3*4=(4+4+4=3+3+3+3",multiplicationcommutativity:"3*4=4*3",multiplicationassociativity:"2*(3*4)=(2*3)*4",multiplicationneutral:"5*1=5",naturallog:"lnx",neg1:"-1",negativebase:["(-x)^y",[0]],negativeexponent:["x^-y",[1]],negativefactor:["x*(-y)*z",[1]],negativefraction:"-(x/y)",negativedenominatorfactor:["x/(y*-z)",[1,1]],negativenumeratorfactor:["(x*-y)/z",[0,1]],negativeproduct:"-(x*y)",negativeproductfactor:["x*(-(y*3))*z",[1]],negativesum:"-(x+y)",nonstrictcomparison:"3x<=2y",numerator:["x/y",[0]],numeratorfactor:["(xy)/z",[0,1]],percent:"%",pi:"pi",plusminus:"+-3",product:"x*y*z",productbase:["(x*y)^z",[0]],productexponent:["x^(y*z)",[1]],productfactor:["x*(2*y)*z",[1]],productterm:["x+2y+z",[1]],power:"4^3",powerbase:["(x^y)^z",[0]],powerfactor:["x*(y^2)*z",[1]],powerproduct:"x2*y3*z4",radicand:{en:["5root8",[0]],sv:["5rot8",[0]]},root:{en:"5root8",sv:"5rot8"},rootindex:{en:["5root8",[1]],sv:["5rot8",[1]]},strictcomparison:"3x<2y",squareroot:{en:"sqrt5",sv:"rot5"},subtraction:"5-2=3",sumbase:["(x+y)^z",[0]],sumexponent:["x^(y+z)",[1]],sumfactor:["3*(y+2)*z",[1]],sumterm:["x+(3+y)+5",[1]],thenbranch:{sv:["om (x<0) så -x annars x",[1]],en:["if (x<0) then -x else x",[1]]},variable:{sv:['5*"inköpspris"+7',[0,1]],en:['5*"price"+7',[0,1]]},zeroprod:"x*0=0"};numbers={sv:["en","två","tre","fyra","fem","sex","sju","åtta","nio","tio","elva","tolv","tretton","fjorton","femton","sexton","sjutton","arton","nitton","tjugo"],en:["one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen","twenty"]};ordernumbers={sv:["första","andra","tredje","fjärde","femte","sjätte","sjunde","åttonde","nionde","tionde","elfte","tolfte","trettonde","fjortonde","femtonde","sextonde","sjuttonde","artonde","nittonde","tjugonde"],en:["first","second","third","fourth","fifth","sixth","seventh","eighth","ninth","tenth","eleventh","twelfth","thirteenth","fourteenth","fifteenth","sixteenth","seventeenth","nineteenth","twentieth"]};ordersuffixes=function(num,lang){var mod;mod=num%10;if(lang==="sv"){if(mod===1||mod===2){return":a"}else{return":e"}}else if(mod===1){return":st"}else if(mod===2){return":nd"}else if(mod===3){return":rd"}else{return":th"}};orderNumberStr=function(num,lang){return ordernumbers[lang][num-1]||num+ordersuffixes(num,lang)};numberStr=function(num,lang){return numbers[lang][num-1]||""+num};makeWordIndex=function(lang){var def,ret,word;ret=[];for(word in links){def=links[word];if(word!=="MAKESAFE"&&def.headline[lang]){ret.push([word,def.headline[lang]])}}return ret.sort(function(o1,o2){if(o1[1].toLowerCase()<o2[1].toLowerCase()){return-1}else{return 1}})};makeToolIndex=function(lang){var classes,def,headline,realdef,ret,tool,_ref1,_ref2,_ref3;ret=[];_ref1=CATS.texts.tools;for(tool in _ref1){def=_ref1[tool];if(!!(tool==="simplifier"||tool==="decimalifier")){continue}realdef=CATS.math[tool];classes=[];classes.push(((_ref2=realdef.info)!=null?_ref2.uses:void 0)?"toolcomplex":"toolatomic");if((_ref3=realdef.info)!=null?_ref3.effect:void 0){classes.push("tool"+realdef.info.effect)}headline=typeof def[lang]==="string"?def[lang]:def[lang].name;ret.push([tool,headline,classes])}return ret.sort(function(o1,o2){if(o1[1].toLowerCase()<o2[1].toLowerCase()){return-1}else{return 1}})};totalToolCount=function(){var compl,def,effect,realdef,ret,tool,_name,_ref1,_ref2,_ref3;ret={total:0};_ref1=CATS.texts.tools;for(tool in _ref1){def=_ref1[tool];if(!!(tool==="simplifier"||tool==="decimalifier")){continue}ret.total++;realdef=CATS.math[tool];if(!realdef||!realdef.info){console.log("ACK",tool,"GOT",realdef)}compl=((_ref2=realdef.info)!=null?_ref2.uses:void 0)?"complex":"atomic";effect=realdef.info.effect;if((_ref3=ret[_name=compl+effect])==null){ret[_name]=0}ret[compl+effect]++}return ret};checker=function(){var def,done,remaining,toolname,_ref1;done=0;remaining=0;_ref1=CATS.texts.tools;for(toolname in _ref1){def=_ref1[toolname];if(typeof def.sv==="string"){remaining++}else{done++}}console.log("DONE",done,"REMAINING",remaining);return done+"/"+(done+remaining)};generateAllToolLists=function(callback){var tag;console.log("OK, gonna do all tool lists! Wee!");for(tag in CATS.texts.links){if(tag!=="MAKESAFE"){CATS.cache.lists[tag]=toolListsForTag(tag)}}console.log("DONE!",CATS.cache.lists);if(callback){return callback()}};toolListsForTag=function(tag,lang){var kind,mytools,num,ret,toolIndex,toolname,toolnamepair,_i,_j,_k,_len,_len1,_len2,_ref1,_ref2,_ref3;toolIndex=CATS.texts.toolTagIndex;ret={notoollist:CATS.texts.links[tag].notoollist};if(!false){_ref1=["basic","complex"];for(_i=0,_len=_ref1.length;_i<_len;_i++){kind=_ref1[_i];mytools=((_ref2=toolIndex[tag])!=null?_ref2[kind]:void 0)||[];num=0;if(mytools.length===0){}else{for(_j=0,_len1=mytools.length;_j<_len1;_j++){toolnamepair=mytools[_j];_ref3=toolnamepair.split("|");for(_k=0,_len2=_ref3.length;_k<_len2;_k++){toolname=_ref3[_k];if(CATS.math[toolname].info.tags.indexOf(tag)!==-1){num++}}}}ret[kind]=num}}return ret};generateToolTagIndex=function(){var me,opp,opptags,othertag,realdef,tag,tagindex,tool,_i,_j,_len,_len1,_ref1,_ref2,_ref3,_ref4,_ref5;tagindex={};_ref1=CATS.math;for(tool in _ref1){realdef=_ref1[tool];if(realdef.info&&!(tool==="simplifier"||tool==="decimalifier")){realdef=augmentToolTag(realdef,CATS.math)}}_ref2=CATS.math;for(tool in _ref2){realdef=_ref2[tool];if(!(realdef.info&&!(tool==="simplifier"||tool==="decimalifier"))){continue}opp=realdef.info.opposite||"";if(tool>opp){me=tool+(opp?"|"+opp:"");_ref3=realdef.info.tags||[];for(_i=0,_len=_ref3.length;_i<_len;_i++){tag=_ref3[_i];if(!CATS.texts.links[tag]){throw"UNKNOWN LINK: "+realdef.info.name+" ---- "+tag}if((_ref4=tagindex[tag])==null){tagindex[tag]={basic:[],complex:[]}}tagindex[tag][realdef.info.uses?"complex":"basic"].push(me)}if(opp){opptags=CATS.math[opp].info.tags;for(_j=0,_len1=opptags.length;_j<_len1;_j++){othertag=opptags[_j];if(!!(__indexOf.call(realdef.info.tags,othertag)>=0)){continue}if((_ref5=tagindex[othertag])==null){tagindex[othertag]={basic:[],complex:[]}}tagindex[othertag][CATS.math[opp].info.uses?"complex":"basic"].push(opp)}}}}return CATS.texts.toolTagIndex=tagindex};getCachedToolListsForTag=function(tag){return CATS.cache.lists[tag]};processText=function(text,lang,except,words){var lookfor,regex,safe;if(!words&&typeof CATS!==void 0){words=CATS.texts.links}text="</a> "+text;for(lookfor in words){if(!words[lookfor].matcher[lang]){continue}regex=new RegExp("[.]*\\<\\/[^\\>]*\\>[^\\<]*?([ (]|^)(("+words[lookfor].matcher[lang]+")[ ).!?:;\\-,'])","gi");safe=0;while(safe<10&&text.match(regex)){text=text.replace(regex,function(wholematch,start,matchwithend,match){var end,intro,link;link=lookfor!==except&&lookfor!=="MAKESAFE"&&!(except&&words[lookfor].redirectto===except)?"<a href='#' class='wordlink' linkto='"+lookfor+"'>"+match+"</a>":"<span>"+match+"</span>";end=matchwithend.substr(match.length);intro=wholematch.substr(0,wholematch.length-matchwithend.length);return""+intro+link+end})}}return transformHtmlShorts(text.slice(5),lang,words)};addToolLinks=function(text,lang){return text.replace(/TOOL\[([^\[\]]*)]/g,function(toolpart,toolname,charnum,full){if(!CATS.texts.tools[toolname]){console.log("WHAT THE EFFFF",full);throw"Cannot find tool to link to: "+toolname}return toolLink(toolname,lang)})};toolLink=function(toolname,lang){var name;name=CATS.texts.tools[toolname][lang].name||CATS.texts.tools[toolname][lang];return"<a href='#' class='toollink intexttoollink' linkto='"+toolname+"'>"+name+"</a>"};addExampleContent=function(text){return text.replace(/EXAMPLE\[([^\[\]]*)]/g,function(part,str,a,b,c){var both,toolid,_ref1;_ref1=str.split("|"),toolid=_ref1[0],both=_ref1[1];return exampleContent(toolid,both)})};exampleContent=function(toolid,both){var example;example=$("#EXAMPLE"+toolid).children();return"<div class='clearfix clear-both opsection'>\n	<div class='opcontainer'>\n		<div class='beforecontainer oppartcontainer'>"+example.eq(0).html()+"</div>\n		<div class='arrow'>"+(both?"&harr;":"&rarr;")+"</div>\n		<div class='aftercontainer oppartcontainer'>"+example.eq(1).html()+"</div>\n	</div>\n</div>"};mathContent=function(mathstr){var mathid,mathprint,objprint,objtoo,_ref1,_ref2;_ref1=mathstr.split("|"),mathid=_ref1[0],objtoo=_ref1[1];if(!maths[mathid]){throw"Cannot find math content "+mathid}_ref2=$("#MATH"+mathid).children(),mathprint=_ref2[0],objprint=_ref2[1];return"<div class='exampleholder mathblock'>"+$(mathprint).html()+(objtoo?"<div class='objholder'><div class='mathobj clearfix'>"+$(objprint).html()+"</div></div>":"")+"</div>"};addMathContent=function(text,lang){return text.replace(/MATH\[([^\[\]]*)]/g,function(part,mathstr,a,b,c){return mathContent(mathstr,lang)})};transformHtmlShorts=function(text,lang,words){text=text.replace(/\ *NEWLINE\ */g,"<br><br/>");text=text.replace(/\ *LIST___(.*?)___LIST\ */g,function(full,items){return"<ul class='intextlist'>"+(items+"___").replace(/(.*?)___/g,function(withunderscores,item,a,b,c){return"<li>"+item+"</li>"})+"</ul>"});return text=text.replace(/WORDLIST\[([^\[\]]*)]/g,function(part,wordlist){var listedwords,word;listedwords=wordlist.split(",");return"<div class='davidlist textlist'>"+function(){var _i,_len,_results;_results=[];for(_i=0,_len=listedwords.length;_i<_len;_i++){word=listedwords[_i];_results.push("<a href='#' class='wordlink davidlink' linkto='"+word+"'>"+words[word].headline[lang]+"</a>")}return _results}().join("")+"</div>"})};opsLeft=function(){var op,opdef,_results;_results=[];for(op in tools){opdef=tools[op];if(typeof opdef.en==="string"){_results.push(console.log("Op not done",op))}}return _results};if(typeof exports==="undefined"){exportTo=this.CATS.texts}else{exportTo=exports}_ref1={opsLeft:opsLeft,mathContent:mathContent,processText:processText,addToolLinks:addToolLinks,maths:maths,getCachedToolListsForTag:getCachedToolListsForTag,orderNumberStr:orderNumberStr,numberStr:numberStr,numbers:numbers,ordernumbers:ordernumbers,ordersuffixes:ordersuffixes,generateToolTagIndex:generateToolTagIndex,makeToolIndex:makeToolIndex,checker:checker,totalToolCount:totalToolCount,makeWordIndex:makeWordIndex,generateAllToolLists:generateAllToolLists,toolListsForTag:toolListsForTag};for(k in _ref1){v=_ref1[k];exportTo[k]=v}}).call(this);
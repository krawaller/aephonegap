(function(){var And,DivTest,Eq,Err,FALSE,Frac,Fraction,I,IfElse,IntTest,Neg,Neq,Not,NotEqual,Num,OK,Or,Power,Prod,Product,Sum,TRUE,UNDEFINED,absorbOrsInAnd,absorbSubAnds,absorbSubOrs,addNewVar,andWithFalseIsFalse,andWithIncompatiblePartsToFalse,collapseDecFracIntegerTest,collapseDoubleNot,collapseIfElseWithSameBranches,collapseNegIntegerTest,collapseNotAnd,collapseNotOr,collapseNotRel,combineOppositeOrEqsToEqInAnd,combineOppositeStrictCombsInOr,compareRelations,complexComparisonToBool,conjunctionWithHiddenOppsToFalse,conjunctionWithOppsToFalse,deepcopy,disjunctionWithHiddenOppsToTrue,disjunctionWithNeqInCompToTrue,disjunctionWithOppsToTrue,evalIfElse,evalNumIntegerTest,evalNumericDivTest,evalNumericRelation,expandRelToNot,exploreForbiddenEqWith1Or0,exportTo,findInferredComp,findRelCouple,flipRel,flipRelation,funcs,isErr,isLogic,isLogicContainer,k,mixin,notFalseIsTrue,notTrueIsFalse,numericRelToBool,one,opRel,orWithTrueIsTrue,printObj,purgeDuplicatesFromLogic,purgeFalseFromOr,purgeSpiritDuplicatesFromLogic,purgeTrueFromAnd,removeInferredComp,removeSuperfluousCompsInAnd,removeSuperfluousCompsInOrWithNeq,removeSuperfluousEqsInOr,removeSuperfluousNeqsInAnd,shaveCompWithEqInAnd,shaveRelsInAnd,substitute,swallowContainedComparisons,swallowContainedComparisonsInOr,undefinedChildToFalseInLogic,unravelEqOfPowAndOne,unrollIfElse,v,writeDivTestAsIntTest,x,y,z,zero,_ref,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};_ref=typeof require==="undefined"?this.CATS.math.toolhelpers:require("./toolhelpers"),isErr=_ref.isErr,I=_ref.I,flipRel=_ref.flipRel,deepcopy=_ref.deepcopy,opRel=_ref.opRel,x=_ref.x,y=_ref.y,z=_ref.z,IfElse=_ref.IfElse,DivTest=_ref.DivTest,IntTest=_ref.IntTest,Eq=_ref.Eq,Neq=_ref.Neq,UNDEFINED=_ref.UNDEFINED,And=_ref.And,Or=_ref.Or,Not=_ref.Not,TRUE=_ref.TRUE,FALSE=_ref.FALSE,Neg=_ref.Neg,mixin=_ref.mixin,Product=_ref.Product,Sum=_ref.Sum,Power=_ref.Power,Fraction=_ref.Fraction,Frac=_ref.Frac,NotEqual=_ref.NotEqual,Num=_ref.Num,Prod=_ref.Prod,Sum=_ref.Sum,zero=_ref.zero,one=_ref.one,Err=_ref.Err,OK=_ref.OK,printObj=_ref.printObj;evalNumericRelation=function(o){var num1,num2;num1=o.deps.newEvalNumVal(o.target.objs[0]);num2=o.deps.newEvalNumVal(o.target.objs[1]);if(num1===false||num2===false){throw"Tried to eval nonnumeric relation!"}switch(o.target.val.toLowerCase()){case"eq":return num1===num2;case"lt":return num1<num2;case"leq":return num1<=num2;case"gt":return num1>num2;case"geq":return num1>=num2;case"neq":return num1!==num2;default:throw"Unknown relation kind: "+o.target.val}};isLogicContainer=function(o){var _ref1;return(_ref1=o.type)==="AND"||_ref1==="OR"||_ref1==="NOT"||_ref1==="XOR"};isLogic=function(o){var _ref1;return(_ref1=o.type)==="AND"||_ref1==="OR"||_ref1==="NOT"||_ref1==="XOR"||_ref1==="relation"||_ref1==="variable"||_ref1==="true"||_ref1==="false"};findRelCouple=function(list,wanted,deps,msg){var r1,r1pos,r2,r2pos,_i,_j,_len,_len1,_ref1,_ref2;_ref1=list.objs;for(r1pos=_i=0,_len=_ref1.length;_i<_len;r1pos=++_i){r1=_ref1[r1pos];_ref2=list.objs;for(r2pos=_j=0,_len1=_ref2.length;_j<_len1;r2pos=++_j){r2=_ref2[r2pos];if(r2pos!==r1pos){if(wanted===deps.compareRelations(r1,r2,deps).what){return{selection:[[r1pos],[r2pos]]}}}}}return Err(msg||"nofind")};compareRelations=function(r1,r2,deps){var combo,combos,r1other,r1var,r2other,r2var,_i,_len,_ref1;combos=[[0,1,0,1],[0,1,1,0],[1,0,0,1],[1,0,1,0]];for(_i=0,_len=combos.length;_i<_len;_i++){combo=combos[_i];r1var=combo[0],r1other=combo[1],r2var=combo[2],r2other=combo[3];if(r1.val==="neq"&&((_ref1=r2.val)==="geq"||_ref1==="leq")){if(deps.equal(r1.objs[r1var],r2.objs[r2var])&&deps.equal(r1.objs[r1other],r2.objs[r2other])){return{what:"shave",r1:r1var,r2:r2var}}}}return{what:"nothing"}};findInferredComp=function(r1,r2,deps){var combo,combos,firstother,firstvar,rel,secondother,secondvar,_i,_len;combos=[[0,1,0,1],[0,1,1,0],[1,0,0,1],[1,0,1,0]];for(_i=0,_len=combos.length;_i<_len;_i++){combo=combos[_i];firstvar=combo[0],firstother=combo[1],secondvar=combo[2],secondother=combo[3];if(deps.equal(r1.objs[firstvar],r2.objs[secondvar])){if(firstvar!==secondvar&&r1.val[0]===r2.val[0]||firstvar===secondvar&&r1.val[0]!==r2.val[0]){rel=deepcopy(r1);rel.objs[firstvar]=deepcopy(r2.objs[secondother]);rel.val=rel.val[0]+(r1.val.length+r2.val.length===6?"eq":"t");return rel}}}return false};flipRelation={info:{name:"flipRelation",effect:"condsimpl",example:"3=>x",tags:["logic","relation"],lesson:"relationmanip"},target:{type:"relation"},auto:function(o){if(o.target.objs[0].type!=="variable"&&o.target.objs[1].type==="variable"){return OK}else{return Err("NOSIMPL")}},perform:function(o){var rel;rel=flipRel(o.target);rel.objs=[rel.objs[1],rel.objs[0]];return{result:rel}}};evalNumericDivTest={info:{name:"evalNumericDivTest",effect:"simplifying",example:"3 divides 12",tags:["divtest","logic","logictrue","logicfalse"],lesson:"logicevaluations",uses:["writeDivTestAsIntTest","collapseDecFracIntegerTest","sameNumerDenomFracToOne","eliminateCommonInnerFacsInFrac","collapseNegOneDenom","evalNumIntegerTest"]},target:{type:"DIVTEST",validate:function(o){if(!(o.target.objs[0].type==="number"||o.target.objs[0].type==="negation"&&o.target.objs[0].objs[0].type==="number")){return Err("VALmustbetestofnums",[0])}else if(!(o.target.objs[1].type==="number"||o.target.objs[1].type==="negation"&&o.target.objs[1].objs[0].type==="number")){return Err("VALmustbetestofnums",[1])}else{return OK}}},prints:{errors:["VALmustbetestofnums","VALmustbetestofnums"]},perform:function(o){o["do"]("writeDivTestAsIntTest","firstturntointtest");o["try"]("collapseDecFracIntegerTest","decimaltofalse");o["try"]("sameNumerDenomFracToOne","sametoone",[0]);o["try"]("eliminateCommonInnerFacsInFrac","dodivision",[0]);o["try"]("collapseNegOneDenom","removeneg1denom",[0]);return o["try"]("evalNumIntegerTest","nowevaltotrue")}};writeDivTestAsIntTest={info:{name:"writeDivTestAsIntTest",effect:"simplifying",example:"3 divides 12",tags:["divtest","integertest"],lesson:"logicevaluations"},target:{type:"DIVTEST"},perform:function(o){return{beforemarks:[[0],[1]],aftermarks:[[0,0],[0,1]],result:IntTest(Frac(o.target.objs[0],o.target.objs[1]))}}};absorbSubAnds={info:{name:"absorbSubAnds",effect:"simplifying",example:{str:"x and (y and z)",selection:[[1]]},tags:["logic","logicand","associativity"],lesson:"logic101"},prints:{errors:["SELmustselectand"]},target:"AND",selection:{filter:"AND"},perform:function(_arg){var at,child,chosenfacs,fac,facs,marks,pos,target,tfacs,_i,_j,_len,_len1,_ref1,_ref2;target=_arg.target,_ref1=_arg.selection,chosenfacs=_ref1[0];tfacs=target.objs;facs=[];marks=[];at=0;for(pos=_i=0,_len=tfacs.length;_i<_len;pos=++_i){fac=tfacs[pos];if(__indexOf.call(chosenfacs,pos)>=0){_ref2=tfacs[pos].objs;for(_j=0,_len1=_ref2.length;_j<_len1;_j++){child=_ref2[_j];facs.push(child);marks.push([at++])}}else{at++;facs.push(fac)}}return{result:And(facs),beforemarks:function(){var _k,_len2,_results;_results=[];for(_k=0,_len2=chosenfacs.length;_k<_len2;_k++){pos=chosenfacs[_k];_results.push([pos])}return _results}(),aftermarks:marks}}};absorbSubOrs={info:{name:"absorbSubOrs",effect:"simplifying",example:{str:"x or (y or z)",selection:[[1]]},tags:["logic","logicor","associativity"],lesson:"logic101"},prints:{errors:["SELmustselector"]},target:"OR",selection:{filter:"OR"},perform:function(_arg){var at,child,chosenfacs,fac,facs,marks,pos,target,tfacs,_i,_j,_len,_len1,_ref1,_ref2;target=_arg.target,_ref1=_arg.selection,chosenfacs=_ref1[0];tfacs=target.objs;facs=[];marks=[];at=0;for(pos=_i=0,_len=tfacs.length;_i<_len;pos=++_i){fac=tfacs[pos];if(__indexOf.call(chosenfacs,pos)>=0){_ref2=tfacs[pos].objs;for(_j=0,_len1=_ref2.length;_j<_len1;_j++){child=_ref2[_j];facs.push(child);marks.push([at++])}}else{at++;facs.push(fac)}}return{result:Or(facs),beforemarks:function(){var _k,_len2,_results;_results=[];for(_k=0,_len2=chosenfacs.length;_k<_len2;_k++){pos=chosenfacs[_k];_results.push([pos])}return _results}(),aftermarks:marks}}};notFalseIsTrue={info:{name:"notFalseIsTrue",effect:"simplifying",example:"not false",tags:["logic","logicnot","logicfalse","logictrue"],lesson:"logic102"},prints:{errors:["mustbenotfalse"]},target:{type:"not",validate:function(o){if(o.deps.equal(o.target.objs[0],FALSE)){return OK}else{return Err("mustbenotfalse")}}},perform:function(o){return{result:TRUE}}};notTrueIsFalse={info:{name:"notTrueIsFalse",effect:"simplifying",example:"not true",tags:["logic","logicnot","logicfalse","logictrue"],lesson:"logic102"},prints:{errors:["mustbenottrue"]},target:{type:"not",validate:function(o){if(o.deps.equal(o.target.objs[0],TRUE)){return OK}else{return Err("mustbenottrue")}}},perform:function(o){return{result:FALSE}}};andWithFalseIsFalse={info:{name:"andWithFalseIsFalse",effect:"simplifying",example:{str:"(x=2) and false",selection:[[1]]},tags:["logic","logicand","logicfalse","zeroprod"],lesson:"logic101"},target:"and",selection:{max:1,filter:"false"},perform:function(o){return{result:FALSE,beforemarks:[o.selection[0]]}}};orWithTrueIsTrue={info:{name:"orWithTrueIsTrue",effect:"simplifying",example:{str:"(x=2) or true",selection:[[1]]},tags:["logic","logicor","logictrue","zeroprod"],lesson:"logic101"},target:"or",selection:{max:1,filter:"true"},perform:function(o){return{result:TRUE,beforemarks:[o.selection[0]]}}};purgeTrueFromAnd={info:{name:"purgeTrueFromAnd",effect:"simplifying",example:{str:"(x=2) and true",selection:[[1]]},tags:["logic","logicand","logictrue","remove","neutralelement"],lesson:"logic101"},target:"and",selection:{filter:"true",minleft:1},perform:function(o){var pos;return{result:o.deps.collapseStubList(And(o.target.objs.filter(function(i,pos){return __indexOf.call(o.selection[0],pos)<0}))),beforemarks:function(){var _i,_len,_ref1,_results;_ref1=o.selection[0];_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){pos=_ref1[_i];_results.push([pos])}return _results}()}}};purgeFalseFromOr={info:{name:"purgeFalseFromOr",effect:"simplifying",example:{str:"(x=2) or false",selection:[[1]]},tags:["logic","logicor","logicfalse","remove","neutralelement"],lesson:"logic101"},target:"or",selection:{filter:"false",minleft:1},perform:function(o){var pos;return{result:o.deps.collapseStubList(Or(o.target.objs.filter(function(i,pos){return __indexOf.call(o.selection[0],pos)<0}))),beforemarks:function(){var _i,_len,_ref1,_results;_ref1=o.selection[0];_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){pos=_ref1[_i];_results.push([pos])}return _results}()}}};collapseDoubleNot={info:{name:"collapseDoubleNot",effect:"simplifying",example:"not not x",tags:["logic","logicnot"],lesson:"logic102"},prints:{errors:["mustbedoublenot"]},target:{type:"not",validate:function(o){if(o.target.objs[0].type==="NOT"){return OK}else{return Err("mustbedoublenot")}}},perform:function(o){return{result:o.target.objs[0].objs[0],beforemarks:[[0,0]]}}};numericRelToBool={info:{name:"numericRelToBool",effect:"simplifying",example:{str:"3=4",choices:["false"]},tags:["logic","relation","logictrue","logicfalse"],lesson:"logicevaluations"},prints:{instructions:["CHOrelationevaluationresult"],errors:["VALwrongeval","TARmustbenumericrel"]},target:{type:"relation",validate:function(_arg){var deps,left,right,_ref1,_ref2;deps=_arg.deps,_ref1=_arg.target,_ref2=_ref1.objs,left=_ref2[0],right=_ref2[1];if(deps.newEvalNumVal(left)===false){return Err("TARmustbenumericrel",[0])}else if(deps.newEvalNumVal(right)===false){return Err("TARmustbenumericrel",[1])}else{return OK}}},choices:{instruction:"CHOrelationevaluationresult",options:["true","false","youdecide"]},auto:function(o){var ans;ans=o.deps.evalNumericRelation(o);return{choices:[ans===true?"true":"false"]}},validate:function(o){var ans;ans=o.deps.evalNumericRelation(o);if(ans&&o.choices[0]==="true"||!ans&&o.choices[0]==="false"){return OK}else{return Err("VALwrongeval")}},perform:function(o){if(o.choices[0]==="youdecide"){return{result:o.deps.evalNumericRelation(o)==="true"?TRUE:FALSE}}else{return{result:o.choices[0]==="true"?TRUE:FALSE}}}};purgeDuplicatesFromLogic={info:{name:"purgeDuplicatesFromLogic",effect:"simplifying",example:{str:"x and y and x and z and x",selection:[[0,2,4]]},tags:["logic","logicand","logicor","remove"],lesson:"logic101"},prints:{instructions:["SELchoosedupl"],errors:["TARmustbeandor","VALmustbesame","AUTOnoduplicates"]},target:{validate:function(_arg){var target;target=_arg.target;if(target.type==="AND"||target.type==="OR"){return OK}else{return Err("TARmustbeandor")}}},selection:{min:2,instruction:"SELchoosedupl"},validate:function(o){var first,pos,_i,_len,_ref1;first=o.target.objs[o.selection[0][0]];_ref1=o.selection[0].slice(1);for(_i=0,_len=_ref1.length;_i<_len;_i++){pos=_ref1[_i];if(!o.deps.equal(first,o.target.objs[pos])){return Err("VALmustbesame",[pos])}}return OK},auto:function(o){var n,othern,otherseq,same,seq,_i,_j,_len,_len1,_ref1,_ref2;_ref1=o.target.objs.slice(0);for(n=_i=0,_len=_ref1.length;_i<_len;n=++_i){seq=_ref1[n];same=[];_ref2=o.target.objs.slice(n+1);for(othern=_j=0,_len1=_ref2.length;_j<_len1;othern=++_j){otherseq=_ref2[othern];if(o.deps.equal(seq,otherseq)){same.push(othern+n+1)}}if(same.length){return{selection:[[n].concat(same)]}}}return Err("AUTOnoduplicates")},perform:function(o){var pos,res,_ref1;res=o.deps.collapseStubList({type:o.target.type,objs:o.target.objs.filter(function(obj,n){return!(__indexOf.call(o.selection[0].slice(1),n)>=0)})});return{result:res,beforemarks:function(){var _i,_len,_ref1,_results;_ref1=o.selection[0];_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){pos=_ref1[_i];_results.push([pos])}return _results}(),aftermarks:(_ref1=res.type)==="AND"||_ref1==="OR"?[[o.selection[0][0]]]:void 0}}};purgeSpiritDuplicatesFromLogic={info:{name:"purgeSpiritDuplicatesFromLogic",effect:"simplifying",example:{str:"x < y and z and y>x",selection:[[0,2]]},tags:["logic","logicand","logicor"],uses:["makeEqual","purgeDuplicatesFromLogic"],lesson:"logic101"},prints:{instructions:["SELchoosespritidupl"],errors:["TARmustbeandor","VALmustnotalreadybeequal","VALmustbespirit","AUTOnospirits"]},target:{validate:function(_arg){var target;target=_arg.target;if(target.type==="AND"||target.type==="OR"){return OK}else{return Err("TARmustbeandor")}}},selection:{min:2,instruction:"SELchoosedupl"},validate:function(o){var first,pos,_i,_len,_ref1;first=o.target.objs[o.selection[0][0]];_ref1=o.selection[0].slice(1);for(_i=0,_len=_ref1.length;_i<_len;_i++){pos=_ref1[_i];if(o.deps.equal(first,o.target.objs[pos])){return Err("VALmustnotalreadybeequal",[pos])}if(!o.deps.isKindredSpirits({obj1:first,obj2:o.target.objs[pos],deps:o.deps}).result){return Err("VALmustbespirit",[pos])}}return OK},auto:function(o){var n,othern,otherseq,same,seq,_i,_j,_len,_len1,_ref1,_ref2;_ref1=o.target.objs.slice(0);for(n=_i=0,_len=_ref1.length;_i<_len;n=++_i){seq=_ref1[n];same=[];_ref2=o.target.objs.slice(n+1);for(othern=_j=0,_len1=_ref2.length;_j<_len1;othern=++_j){otherseq=_ref2[othern];if(!o.deps.equal(seq,otherseq)){if(o.deps.isKindredSpirits({obj1:seq,obj2:otherseq,deps:o.deps}).result){same.push(othern+n+1)}}}if(same.length){return{selection:[[n].concat(same)]}}}return Err("AUTOnospirits")},perform:function(o){var p,pos,sels,_i,_j,_len,_len1,_ref1,_ref2;sels=o.selection[0];_ref1=sels.slice(1);for(_i=0,_len=_ref1.length;_i<_len;_i++){p=_ref1[_i];o["do"]("makeEqual","makesame",{hunt:[[sels[0]],[p]]})}o["do"]("purgeDuplicatesFromLogic","thenpurge",{selection:[sels]});if((_ref2=o.target.type)==="AND"||_ref2==="OR"){o.aftermark([[o.selection[0][0]]])}for(_j=0,_len1=sels.length;_j<_len1;_j++){pos=sels[_j];o.beforemark([pos])}return o}};substitute={info:{name:"substitute",effect:"condsimpl",example:{str:"x=5 and y=3x",selection:[[0],[1]],direction:"left",hunt:[[1,1]],choices:["keep"]},tags:["logic"],desperate:true,lesson:"rel102"},prints:{errors:["SELmustbeeqrel","SELnolonedepvarineq","SELdoesnthavechosenvar","DIRmustselvarside","DIRmustselsidewithnonuniquevar","HUNTnotsameaschosen","AUTOnovartochange"],instructions:["DIRvarsideinsel","SELeqwithvar","SELparttosubstin","CHOkeeporskipsource"]},target:{type:"AND"},selection:{makefirstunique:true,questions:[{instruction:"SELeqwithvar",type:"equality",filter:function(o){var globalvars,side,vars,_i,_len,_ref1,_ref2;return OK;vars=o.deps.varDependency(o.item);globalvars=o.deps.varDependency(o.target);_ref1=o.item.objs;for(_i=0,_len=_ref1.length;_i<_len;_i++){side=_ref1[_i];if(side.type==="variable"&&vars[side.val].length===1&&((_ref2=globalvars[side.val])!=null?_ref2.length:void 0)>1){return OK}}return Err("SELnolonedepvarineq")}},{instruction:"SELparttosubstin",filter:function(o){var chosenpart,chosenrel,path;chosenrel=o.target.objs[o.selection[0][0]];chosenpart=chosenrel.objs[o.direction==="left"?0:1];path=o.deps.findPathTo(o.item,chosenpart);if(!path){return Err("SELdoesnthavechosenpart")}else{return OK}}}]},direction:{instruction:"DIRvarsideinsel",validate:function(o){var chosenrel,chosenvar,globalvars,_ref1;return OK;chosenrel=o.target.objs[o.selection[0][0]];chosenvar=chosenrel.objs[o.direction==="left"?0:1];if(chosenvar.type!=="variable"){return Err("DIRmustselvarside")}else{globalvars=o.deps.varDependency(o.target);if(((_ref1=globalvars[chosenvar.val])!=null?_ref1.length:void 0)>1){return OK}else{return Err("DIRmustselsidewithnonuniquevar")}}}},hunt:{instruction:"HUNTvartosubstto",fromPath:function(o){return o.selection[1]},validate:function(o){var chosenrel,chosenvar,hunttarget;chosenrel=o.target.objs[o.selection[0][0]];chosenvar=chosenrel.objs[o.direction==="left"?0:1];hunttarget=o.deps.lookUp(o.target,o.selection[1].concat(o.hunt[0]));if(o.deps.equal(chosenvar,hunttarget)){return OK}else{return Err("HUNTnotsameaschosen")}}},choices:{instruction:"CHOkeeporskipsource",options:["keep","skip"]},auto:function(o){var globalvars,introducedvars,n,otherside,othersidedeps,othersidedepsarr,path,pointless,reln,relvars,relvarsarr,ret,side,sides,sourceeq,statement,statementdeps,statementdepsarr,thisvar,thisvardeps,v,varname,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref1,_ref2,_ref3,_ref4;ret=[];globalvars=o.deps.varDependency(o.target);_ref1=o.target.objs;for(reln=_i=0,_len=_ref1.length;_i<_len;reln=++_i){sourceeq=_ref1[reln];if(!(sourceeq.type==="relation"&&sourceeq.val==="eq"&&!(sourceeq.objs[0].type==="variable"&&sourceeq.objs[1].type==="variable")&&!o.deps.containsType(sourceeq,"plusminus"))){continue}relvars=o.deps.varDependency(sourceeq);relvarsarr=Object.keys(relvars);_ref2=[[0,1],[1,0]];for(_j=0,_len1=_ref2.length;_j<_len1;_j++){sides=_ref2[_j];side=sides[0],otherside=sides[1];othersidedeps=o.deps.varDependency(sourceeq.objs[otherside]);othersidedepsarr=Object.keys(othersidedeps);pointless=false;for(_k=0,_len2=othersidedepsarr.length;_k<_len2;_k++){v=othersidedepsarr[_k];if(othersidedeps[v].length===globalvars[v].length){pointless=true}}if(!pointless){thisvar=sourceeq.objs[side];thisvardeps=o.deps.varDependency(thisvar);if(Object.keys(thisvardeps).length===1){varname=Object.keys(thisvardeps)[0];if(((_ref3=relvars[varname])!=null?_ref3.length:void 0)===1){_ref4=o.target.objs;for(n=_l=0,_len3=_ref4.length;_l<_len3;n=++_l){statement=_ref4[n];if(!(n!==reln&&(statement.val==="eq"||o.desperate))){continue}statementdeps=o.deps.varDependency(statement);statementdepsarr=Object.keys(statementdeps);if(statementdepsarr.length>1){introducedvars=relvarsarr.filter(function(v){return __indexOf.call(statementdepsarr,v)<0});if(o.desperate||introducedvars.length===0){path=o.deps.findPathTo(statement,thisvar);if(path){ret.push([Object.keys(othersidedeps).length,{selection:[[reln],[n]],direction:side?"right":"left",hunt:[path],choices:["keep"]}])}}}}}}}}}if(ret.length){ret.sort(function(o1,o2){if(o1[0]<o2[0]){return-1}else{return 1}});return ret[0][1]}else{return Err("AUTOnovartochange")}},perform:function(o){var aftermarks,newchain,origvarpath,sourcepos,targetpath,tarpos,varexchangepath,varreplacement,_ref1,_ref2,_ref3;_ref1=o.selection,_ref2=_ref1[0],sourcepos=_ref2[0],_ref3=_ref1[1],tarpos=_ref3[0];origvarpath=[sourcepos,o.direction==="left"?0:1];varexchangepath=[sourcepos,o.direction==="left"?1:0];targetpath=[tarpos].concat(o.hunt[0]);varreplacement=o.deps.lookUp(o.target,varexchangepath);newchain=o.deps.exchangeChild(o.target,varreplacement,targetpath);if(o.choices[0]==="skip"){newchain=o.deps.collapseStubList(And(newchain.objs.filter(function(o,n){return n!==sourcepos})));aftermarks=newchain.type!=="AND"?o.hunt:[[tarpos-(tarpos>sourcepos?1:0)].concat(o.hunt[0])]}else{aftermarks=[varexchangepath,targetpath]}return{result:newchain,beforemarks:[[sourcepos],[tarpos].concat(o.hunt[0])],aftermarks:aftermarks}}};addNewVar={info:{name:"addNewVar",effect:"complicating",example:{str:"x=3andy=4",argument:[{type:"variable",val:"t"},Num(2)]},tags:["logic","introduce"],lesson:"relationcomb"},target:{type:"all"},direction:"DIRbeginorend",argument:{validate:function(o){var vardeps;vardeps=o.deps.varDependency(o.target);if(vardeps[o.argument[0].val]){return Err("ARGcantaddexistingvar")}else{return OK}},questions:[{instruction:"ARGnewvar"},{instruction:"ARGvalue",validate:function(){return OK}}]},perform:function(o){var chain,newtruth;newtruth=Eq(o.argument[0],o.argument[1]);if(o.direction==="right"){chain=And((o.target.type==="AND"?o.target.objs:[o.target]).concat(newtruth));return{result:chain,aftermarks:[[chain.objs.length-1]]}}else{return{result:And([newtruth].concat(o.target.type==="AND"?o.target.objs:o.target)),aftermarks:[[0]]}}}};evalNumIntegerTest={info:{name:"evalNumIntegerTest",effect:"simplifying",example:"5isinteger",tags:["logic","integertest"],lesson:"logicevaluations"},target:{type:"isinteger",validate:function(o){var _ref1;if((_ref1=o.target.objs[0].type)==="number"||_ref1==="constant"||_ref1==="const"){return OK}else{return Err("TARmustbetestofnumorconst")}}},perform:function(_arg){var int,test,_ref1;int=_arg.target.objs[0];test=(_ref1=int.type)==="const"||_ref1==="constant"?false:parseFloat(int.val)===parseInt(int.val);return{beforemarks:[[0]],result:test?TRUE:FALSE}}};collapseNegIntegerTest={info:{name:"collapseNegIntegerTest",effect:"simplifying",example:"(-3) is integer",tags:["logic","integertest"],lesson:"logicevaluations"},target:{type:"isinteger",validate:function(o){if(o.target.objs[0].type==="negation"){return OK}else{return Err("TARmustbetestofneg")}}},perform:function(_arg){var negee;negee=_arg.target.objs[0].objs[0];return{beforemarks:[[0,0]],aftermarks:[[0]],result:IntTest(negee)}}};collapseDecFracIntegerTest={info:{name:"collapseDecFracIntegerTest",effect:"simplifying",example:"(2/3)isinteger",tags:["logic","integertest","logicfalse","fraction","decimal"],lesson:"logicevaluations",uses:["fracToDecNum","fracWithNegNumToDecNum","evalNumIntegerTest"]},target:{type:"isinteger",validate:function(_arg){var denom,denomval,frac,numberValue,numer,numerval,res,test,_ref1,_ref2,_ref3,_ref4;_ref1=_arg.deps,numberValue=_ref1.numberValue,_ref2=_arg.target,_ref3=_ref2.objs,test=_ref3[0];frac=test.type==="negation"?test.objs[0]:test;if(frac.type!=="fraction"){return Err("TARmustbefracornegfrac")}else{_ref4=frac.objs,numer=_ref4[0],denom=_ref4[1];if(numer.type!=="number"&&!(numer.type==="negation"&&numer.objs[0].type==="number")){return Err("TARnumermustbenum",[0])}else if(denom.type!=="number"&&!(denom.type==="negation"&&denom.objs[0].type==="number")){return Err("TARdenommustbenum",[1])}else{numerval=numberValue(numer);denomval=numberValue(denom);res=numerval/denomval;if(res!==parseInt(res)){return OK}else{return Err("TARmustbedecresult")}}}}},perform:function(o){o["try"]("fracToDecNum","becamedec",[0]);o["try"]("fracToDecNum","becamedecneg",[0,0]);o["try"]("fracWithNegNumToDecNum","becamedecinnerneg",[0]);return o["do"]("evalNumIntegerTest","evaltofalse")}};evalIfElse={info:{name:"evaluateIfElse",effect:"simplifying",example:{target:IfElse(TRUE,y,z)},tags:["logic","ifelse"],lesson:"logic102",uses:["unrollIfElse","purgeTrueFromAnd","notTrueIsFalse","notFalseIsTrue","andWithFalseIsFalse","purgeFalseFromOr"]},target:{type:"ifelse",validate:function(o){var _ref1;if((_ref1=o.target.objs[0].type)==="true"||_ref1==="false"){return OK}else{return Err("TARcondmustbebool")}}},perform:function(o){o["do"]("unrollIfElse","phraseasdis");if(o.deps.equal(o.target.objs[0].objs[0],TRUE)){o.beforemark([[0],[1]]);o["do"]("purgeTrueFromAnd","removetruefromfirst",{aim:[0],selection:[[0]]});o["do"]("notTrueIsFalse","secondcondisfalse",{aim:[1,0]});o["do"]("andWithFalseIsFalse","secondbranchcollapses",{aim:[1],selection:[[0]]});return o["do"]("purgeFalseFromOr","removefalseandgetfirstbranch",{selection:[[1]]})}else{o.beforemark([[0],[2]]);o["do"]("notFalseIsTrue","notfalseistrue",{aim:[1,0]});o["do"]("purgeTrueFromAnd","removetruefromsecond",{aim:[1],selection:[[0]]});o["do"]("andWithFalseIsFalse","collapsefirstbranch",{aim:[0],selection:[[0]]});return o["do"]("purgeFalseFromOr","removefalseandgetsecondbranch",{selection:[[0]]})}}};collapseIfElseWithSameBranches={info:{name:"collapseIfElseWithSameBranches",effect:"simplifying",example:{target:IfElse(x,y,y)},tags:["logic","ifelse"],lesson:"logic102"},prints:{errors:["TARmustbesamebranches"]},target:{type:"ifelse",validate:function(o){if(o.deps.equal(o.target.objs[1],o.target.objs[2])){return OK}else{return Err("TARmustbesamebranches")}}},perform:function(o){return{result:o.target.objs[1],beforemarks:[[1],[2]]}}};absorbOrsInAnd={info:{name:"absorbOrsInAnd",effect:"simplifying",example:{str:"(x=2orx=3orx=4)andy=2",selection:[[0]]},tags:["logic","logicand","logicor","distribution"],lesson:"logic101"},target:"AND",selection:{max:1,filter:"OR"},perform:function(o){var chosen,n,pos,prop,rest;pos=o.selection[0][0];chosen=o.target.objs[pos];rest=o.target.objs.filter(function(o,i){return i!==pos});return{result:Or(function(){var _i,_len,_ref1,_results;_ref1=chosen.objs;_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){prop=_ref1[_i];_results.push(And([prop].concat(rest)))}return _results}()),beforemarks:[[pos,0],[pos,1]],aftermarks:function(){var _i,_ref1,_results;_results=[];for(n=_i=0,_ref1=o.target.objs.length;0<=_ref1?_i<_ref1:_i>_ref1;n=0<=_ref1?++_i:--_i){_results.push([n,0])}return _results}()}}};unrollIfElse={info:{name:"unrollIfElse",effect:"simplifying",example:{target:IfElse(x,y,z)},tags:["logic","ifelse"],lesson:"logic102"},target:"ifelse",perform:function(_arg){var cond,els,the,_ref1;_ref1=_arg.target.objs,cond=_ref1[0],the=_ref1[1],els=_ref1[2];return{result:Or(And(cond,the),And(Not(cond),els))}}};collapseNotRel={info:{name:"collapseNotRel",effect:"simplifying",example:"not (x=y)",tags:["logic","logicnot","relation"],opposite:"expandRelToNot",lesson:"relationmanip"},prints:{errors:["TARmustbenotrel"]},target:{type:"NOT",validate:function(o){if(o.target.objs[0].type==="relation"){return OK}else{return Err("TARmustbenotrel")}}},perform:function(_arg){var rel;rel=_arg.target.objs[0];return{result:opRel(rel)}}};expandRelToNot={info:{name:"expandRelToNot",effect:"complicating",example:"x=y",tags:["logic","relation","logicnot"],opposite:"collapseNotRel",lesson:"relationmanip"},target:{type:"relation"},perform:function(o){return{result:Not(opRel(o.target))}}};collapseNotOr={info:{name:"collapseNotOr",effect:"simplifying",example:"not (x or y)",tags:["logic","logicor","logicnot"],lesson:"logic102"},prints:{errors:["TARmustbenotor"]},target:{type:"NOT",validate:function(o){if(o.target.objs[0].type==="OR"){return OK}else{return Err("TARmustbenotor")}}},perform:function(_arg){var n,part,parts;parts=_arg.target.objs[0].objs;return{result:And(function(){var _i,_len,_results;_results=[];for(_i=0,_len=parts.length;_i<_len;_i++){part=parts[_i];_results.push(Not(part))}return _results}()),beforemarks:[[0]],aftermarks:function(){var _i,_ref1,_results;_results=[];for(n=_i=0,_ref1=parts.length;0<=_ref1?_i<_ref1:_i>_ref1;n=0<=_ref1?++_i:--_i){_results.push([n,0])}return _results}()}}};collapseNotAnd={info:{name:"collapseNotAnd",effect:"simplifying",example:"not (x and y)",tags:["logic","logicand","logicor","logicnot"],lesson:"logic102"},prints:{errors:["TARmustbenotand"]},target:{type:"NOT",validate:function(o){if(o.target.objs[0].type==="AND"){return OK}else{return Err("TARmustbenotor")}}},perform:function(_arg){var n,part,parts;parts=_arg.target.objs[0].objs;return{result:Or(function(){var _i,_len,_results;_results=[];for(_i=0,_len=parts.length;_i<_len;_i++){part=parts[_i];_results.push(Not(part))}return _results}()),beforemarks:[[0]],aftermarks:function(){var _i,_ref1,_results;_results=[];for(n=_i=0,_ref1=parts.length;0<=_ref1?_i<_ref1:_i>_ref1;n=0<=_ref1?++_i:--_i){_results.push([n,0])}return _results}()}}};shaveRelsInAnd={info:{name:"shaveRelsInAnd",effect:"simplifying",example:{str:"x<=3 and x!=3",selection:[[1],[0]]},tags:["logic","logicand","comparison","forbiddenequality","merge"],lesson:"relationcomb"},target:"AND",selection:{makefirstunique:true,questions:[{instruction:"SELneg",filter:function(o){if(o.item.type==="relation"&&o.item.val==="neq"){return OK}else{return Err("SELmustbeneq")}}},{instruction:"SELineq",filter:function(o){if(o.item.type==="relation"&&(o.item.val==="geq"||o.item.val==="leq")){return OK}else{return Err("SELmustbeineq")}}}]},auto:function(o){var neq,neqpos,other,otherpos,_i,_j,_len,_len1,_ref1,_ref2;_ref1=o.target.objs;for(neqpos=_i=0,_len=_ref1.length;_i<_len;neqpos=++_i){neq=_ref1[neqpos];if(neq.type==="relation"&&neq.val==="neq"){_ref2=o.target.objs;for(otherpos=_j=0,_len1=_ref2.length;_j<_len1;otherpos=++_j){other=_ref2[otherpos];if(otherpos!==neqpos&&other.type==="relation"&&(other.val==="geq"||other.val==="leq")){if(o.deps.equal(neq.objs[0],other.objs[0])&&o.deps.equal(neq.objs[1],other.objs[1])||o.deps.equal(neq.objs[0],other.objs[1])&&o.deps.equal(neq.objs[1],other.objs[0])){return{selection:[[neqpos],[otherpos]]}}}}}}return Err("AUTOnoshaves")},perform:function(o){var neqpos,newand,otherpos,_ref1,_ref2,_ref3;_ref1=o.selection,_ref2=_ref1[0],neqpos=_ref2[0],_ref3=_ref1[1],otherpos=_ref3[0];o.report("negpos "+neqpos+" otherpos "+otherpos);o.target.objs[otherpos].val=o.target.objs[otherpos].val==="geq"?"gt":"lt";o.report("switched");newand=o.deps.collapseStubList(And(o.target.objs.filter(function(part,n){return n!==neqpos})));return{result:newand,beforemarks:[[neqpos],[otherpos]],aftermarks:newand.type!=="AND"?[]:otherpos>neqpos?[[otherpos-1]]:[[otherpos]]}}};shaveCompWithEqInAnd={info:{name:"shaveCompWithEqInAnd",effect:"simplifying",example:{str:"x<=3 and x=3",selection:[[1],[0]]},tags:["logic","remove","logicand","comparison","equality"],lesson:"relationcomb"},target:"AND",selection:{makefirstunique:true,questions:[{instruction:"SELeg",filter:function(o){if(o.item.type==="relation"&&o.item.val==="eq"){return OK}else{return Err("SELmustbeneq")}}},{instruction:"SELineq",filter:function(o){if(o.item.type==="relation"&&(o.item.val==="geq"||o.item.val==="leq")){return OK}else{return Err("SELmustbeineq")}}}]},auto:function(o){var neq,neqpos,other,otherpos,_i,_j,_len,_len1,_ref1,_ref2;_ref1=o.target.objs;for(neqpos=_i=0,_len=_ref1.length;_i<_len;neqpos=++_i){neq=_ref1[neqpos];if(neq.type==="relation"&&neq.val==="eq"){_ref2=o.target.objs;for(otherpos=_j=0,_len1=_ref2.length;_j<_len1;otherpos=++_j){other=_ref2[otherpos];if(otherpos!==neqpos&&other.type==="relation"&&(other.val==="geq"||other.val==="leq")){if(o.deps.equal(neq.objs[0],other.objs[0])&&o.deps.equal(neq.objs[1],other.objs[1])||o.deps.equal(neq.objs[0],other.objs[1])&&o.deps.equal(neq.objs[1],other.objs[0])){return{selection:[[neqpos],[otherpos]]}}}}}}return Err("AUTOnoshaves")},perform:function(o){var neqpos,newand,otherpos,_ref1,_ref2,_ref3;_ref1=o.selection,_ref2=_ref1[0],neqpos=_ref2[0],_ref3=_ref1[1],otherpos=_ref3[0];newand=o.deps.collapseStubList(And(o.target.objs.filter(function(part,n){return n!==otherpos})));return{result:newand,beforemarks:[[neqpos],[otherpos]],aftermarks:newand.type!=="AND"?[]:otherpos>neqpos?[[otherpos-1]]:[[otherpos]]}}};removeSuperfluousNeqsInAnd={info:{name:"removeSuperfluousNeqsInAnd",effect:"simplifying",example:{str:"x!=3 and x<2",selection:[[0],[1]]},tags:["logic","forbiddenequality","comparison","logicand","remove","relation"],lesson:"relationcomb",desperate:true},target:"AND",selection:{max:1,makefirstunique:true,questions:[{instruction:"SELneq",filter:function(o){if(o.item.type==="relation"&&o.item.val==="neq"){return OK
}else{return Err("SELmustbeneq")}}},{instruction:"SELineq",filter:function(o){var _ref1;if(o.item.type==="relation"&&((_ref1=o.item.val)==="lt"||_ref1==="leq"||_ref1==="gt"||_ref1==="geq"||_ref1==="eq")){return OK}else{return Err("SELmustbeineq")}}}]},auto:function(o){var neq,neqcomp,neqpos,neqval,neqvalside,nv,other,othercomp,othercompside,otherpos,otherval,ov,testrel,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref1,_ref2,_ref3,_ref4,_ref5;_ref1=o.target.objs;for(neqpos=_i=0,_len=_ref1.length;_i<_len;neqpos=++_i){neq=_ref1[neqpos];if(neq.type==="relation"&&neq.val==="neq"){_ref2=neq.objs;for(neqvalside=_j=0,_len1=_ref2.length;_j<_len1;neqvalside=++_j){neqval=_ref2[neqvalside];nv=o.deps.newEvalNumVal(neqval);if(nv!==false){neqcomp=neq.objs[neqvalside?0:1];if(o.desperate===2||Object.keys(o.deps.varDependency(neqcomp)).length===1){_ref3=o.target.objs;for(otherpos=_k=0,_len2=_ref3.length;_k<_len2;otherpos=++_k){other=_ref3[otherpos];if(otherpos!==neqpos&&other.type==="relation"&&((_ref4=other.val)==="lt"||_ref4==="leq"||_ref4==="gt"||_ref4==="geq"||_ref4==="eq")){_ref5=other.objs;for(othercompside=_l=0,_len3=_ref5.length;_l<_len3;othercompside=++_l){othercomp=_ref5[othercompside];if(!o.deps.equal(othercomp,neqcomp)){continue}otherval=other.objs[othercompside?0:1];ov=o.deps.newEvalNumVal(otherval);if(ov!==false){testrel={type:"relation",val:other.val,objs:[neqval,otherval]};if(othercompside!==0){testrel=flipRel(testrel)}if(o.deps.evalNumericRelation({target:testrel,deps:o.deps})===false){return{selection:[[neqpos],[otherpos]]}}}}}}}}}}}return Err("AUTOnofix")},perform:function(o){var neqpos,otherpos,r,_ref1,_ref2,_ref3;_ref1=o.selection,_ref2=_ref1[0],neqpos=_ref2[0],_ref3=_ref1[1],otherpos=_ref3[0];r=o.deps.collapseStubList(And(o.target.objs.filter(function(part,n){return n!==neqpos})));return{result:r,beforemarks:[[neqpos],[otherpos]],aftermarks:r.type!=="AND"?[]:otherpos>neqpos?[[otherpos-1]]:[[otherpos]]}}};removeSuperfluousCompsInAnd={info:{name:"removeSuperfluousCompsInAnd",effect:"simplifying",example:{str:"x=3 and x<5",selection:[[0],[1]]},tags:["logic","remove","equality","comparison","logicand","relation"],lesson:"relationcomb"},target:"AND",selection:{max:1,makefirstunique:true,questions:[{instruction:"SELneq",filter:function(o){if(o.item.type==="relation"&&o.item.val==="eq"){return OK}else{return Err("SELmustbeeq")}}},{instruction:"SELineq",filter:function(o){var _ref1;if(o.item.type==="relation"&&((_ref1=o.item.val)==="lt"||_ref1==="leq"||_ref1==="gt"||_ref1==="geq"||_ref1==="eq")){return OK}else{return Err("SELmustbeineq")}}}]},auto:function(o){var neq,neqcomp,neqpos,neqval,neqvalside,nv,other,othercomp,othercompside,otherpos,otherval,ov,testrel,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref1,_ref2,_ref3,_ref4,_ref5;_ref1=o.target.objs;for(neqpos=_i=0,_len=_ref1.length;_i<_len;neqpos=++_i){neq=_ref1[neqpos];if(neq.type==="relation"&&neq.val==="eq"){_ref2=neq.objs;for(neqvalside=_j=0,_len1=_ref2.length;_j<_len1;neqvalside=++_j){neqval=_ref2[neqvalside];nv=o.deps.newEvalNumVal(neqval);if(nv!==false){neqcomp=neq.objs[neqvalside?0:1];_ref3=o.target.objs;for(otherpos=_k=0,_len2=_ref3.length;_k<_len2;otherpos=++_k){other=_ref3[otherpos];if(otherpos!==neqpos&&other.type==="relation"&&((_ref4=other.val)==="lt"||_ref4==="leq"||_ref4==="gt"||_ref4==="geq"||_ref4==="eq")){_ref5=other.objs;for(othercompside=_l=0,_len3=_ref5.length;_l<_len3;othercompside=++_l){othercomp=_ref5[othercompside];if(!o.deps.equal(othercomp,neqcomp)){continue}otherval=other.objs[othercompside?0:1];ov=o.deps.newEvalNumVal(otherval);if(ov!==false){testrel={type:"relation",val:other.val,objs:[neqval,otherval]};if(othercompside!==0){testrel=flipRel(testrel)}if(o.deps.evalNumericRelation({target:testrel,deps:o.deps})===true){return{selection:[[neqpos],[otherpos]]}}}}}}}}}}return Err("AUTOnofix")},perform:function(o){var neqpos,otherpos,r,_ref1,_ref2,_ref3;_ref1=o.selection,_ref2=_ref1[0],neqpos=_ref2[0],_ref3=_ref1[1],otherpos=_ref3[0];r=o.deps.collapseStubList(And(o.target.objs.filter(function(part,n){return n!==otherpos})));return{result:r,beforemarks:[[neqpos],[otherpos]],aftermarks:r.type!=="AND"?[]:otherpos>neqpos?[[otherpos-1]]:[[otherpos]]}}};conjunctionWithOppsToFalse={info:{name:"conjunctionWithOppsToFalse",effect:"simplifying",example:{str:"x and not x",selection:[[0],[1]]},tags:["logic","logicand","logicnot","logicfalse"],lesson:"relationcomb"},target:"AND",selection:{max:1,makefirstunique:true,questions:[{instruction:"SELfirst"},{instruction:"SELnotfirst",filter:"NOT"}]},validate:function(o){if(!o.deps.equal(o.target.objs[o.selection[0][0]],o.target.objs[o.selection[1][0]].objs[0])){return Err("VALnotnotsame")}else{return OK}},auto:function(o){var first,fpos,second,spos,_i,_j,_len,_len1,_ref1,_ref2;_ref1=o.target.objs;for(fpos=_i=0,_len=_ref1.length;_i<_len;fpos=++_i){first=_ref1[fpos];_ref2=o.target.objs;for(spos=_j=0,_len1=_ref2.length;_j<_len1;spos=++_j){second=_ref2[spos];if(spos!==fpos&&o.deps.equal(second,Not(first))){return{selection:[[fpos],[spos]]}}}}return Err("AUTOnoopp")},perform:function(o){return{beforemarks:o.selection,result:FALSE}}};conjunctionWithHiddenOppsToFalse={info:{name:"conjunctionWithHiddenOppsToFalse",effect:"simplifying",example:{str:"x=y and y!=x",selection:[[0,1]]},tags:["logic","logicand","logicnot","logicfalse","relation"],uses:["expandRelToNot","makeEqual","conjunctionWithOppsToFalse"],lesson:"relationcomb"},target:"AND",selection:{max:2,min:2,filter:"relation"},auto:function(o){var first,fpos,opp,second,spos,_i,_j,_len,_len1,_ref1,_ref2;_ref1=o.target.objs;for(fpos=_i=0,_len=_ref1.length;_i<_len;fpos=++_i){first=_ref1[fpos];if(!(first.type==="relation")){continue}opp=opRel(deepcopy(first));_ref2=o.target.objs;for(spos=_j=0,_len1=_ref2.length;_j<_len1;spos=++_j){second=_ref2[spos];if(spos!==fpos&&second.type==="relation"){if(o.deps.isKindredSpirits({obj1:opp,obj2:second,deps:o.deps}).result){return{selection:[[fpos,spos]]}}}}}return Err("AUTOnoopp")},perform:function(o){var fpos,spos,_ref1;_ref1=o.selection[0],fpos=_ref1[0],spos=_ref1[1];o.beforemark([[fpos],[spos]]);o["do"]("expandRelToNot","makereltonot",{aim:[spos]});o.report("BEFORE MAKEEQUAL",[fpos],"-",[spos,0]);o["do"]("makeEqual","makesamenow",{hunt:[[fpos],[spos,0]]});return o["do"]("conjunctionWithOppsToFalse","nowtofalse",{selection:[[fpos],[spos]]})}};disjunctionWithHiddenOppsToTrue={info:{name:"disjunctionWithHiddenOppsToTrue",effect:"simplifying",example:{str:"x=y or y!=x",selection:[[0,1]]},tags:["logic","logicor","logicnot","logictrue","relation"],uses:["expandRelToNot","makeEqual","disjunctionWithOppsToTrue"],lesson:"relationcomb"},target:"OR",selection:{max:2,min:2,filter:"relation"},auto:function(o){var first,fpos,opp,second,spos,_i,_j,_len,_len1,_ref1,_ref2;_ref1=o.target.objs;for(fpos=_i=0,_len=_ref1.length;_i<_len;fpos=++_i){first=_ref1[fpos];if(!(first.type==="relation")){continue}opp=opRel(deepcopy(first));_ref2=o.target.objs;for(spos=_j=0,_len1=_ref2.length;_j<_len1;spos=++_j){second=_ref2[spos];if(spos!==fpos&&second.type==="relation"){if(o.deps.isKindredSpirits({obj1:opp,obj2:second,deps:o.deps}).result){return{selection:[[fpos,spos]]}}}}}return Err("AUTOnoopp")},perform:function(o){var fpos,spos,_ref1;_ref1=o.selection[0],fpos=_ref1[0],spos=_ref1[1];o.beforemark([[fpos],[spos]]);o["do"]("expandRelToNot","makereltonot",{aim:[spos]});o.report("BEFORE MAKEEQUAL",[fpos],"-",[spos,0]);o["do"]("makeEqual","makesamenow",{hunt:[[fpos],[spos,0]]});return o["do"]("disjunctionWithOppsToTrue","nowtotrue",{selection:[[fpos],[spos]]})}};disjunctionWithOppsToTrue={info:{name:"disjunctionWithOppsToTrue",effect:"simplifying",example:{str:"x or not x",selection:[[0],[1]]},tags:["logic","logicor","logicnot","logictrue"],lesson:"relationcomb"},target:"OR",selection:{max:1,makefirstunique:true,questions:[{instruction:"SELfirst"},{instruction:"SELnotfirst",filter:function(o){if(o.item.type==="NOT"&&o.deps.equal(o.item.objs[0],o.target.objs[o.selection[0][0]])){return OK}else{return Err("SELnotnot")}}}]},auto:function(o){var first,fpos,second,spos,_i,_j,_len,_len1,_ref1,_ref2;_ref1=o.target.objs;for(fpos=_i=0,_len=_ref1.length;_i<_len;fpos=++_i){first=_ref1[fpos];_ref2=o.target.objs;for(spos=_j=0,_len1=_ref2.length;_j<_len1;spos=++_j){second=_ref2[spos];if(spos!==fpos&&o.deps.equal(second,Not(first))){return{selection:[[fpos],[spos]]}}}}return Err("AUTOnoopp")},perform:function(o){return{beforemarks:o.selection,result:TRUE}}};andWithIncompatiblePartsToFalse={info:{name:"andWithIncompatiblePartsToFalse",effect:"simplifying",example:{str:"x<3 and x=5",selection:[[0],[1]]},tags:["logic","logicand","logicfalse","relation"],lesson:"relationcomb"},target:"AND",selection:{max:1,makefirstunique:true,questions:[{instruction:"SELfirstpart",filter:function(o){if(o.item.type==="relation"&&o.item.val!=="neq"){return OK}else{return Err("SELmustbenotneq")}}},{instruction:"SELsecondpart",filter:function(o){if(o.item.type==="relation"&&o.item.val!=="neq"){return OK}else{return Err("SELmustbenotneq")}}}]},auto:function(o){var first,firstcomp,firstcompval,firstpart,firstpos,firstresult,firstside,second,secondcomp,secondcompval,secondpart,secondpos,secondresult,secondside,test1,test2,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8;_ref1=o.target.objs.slice(0,-1);for(firstpos=_i=0,_len=_ref1.length;_i<_len;firstpos=++_i){first=_ref1[firstpos];if(first.type==="relation"&&first.val!=="neq"){_ref2=o.target.objs;for(secondpos=_j=0,_len1=_ref2.length;_j<_len1;secondpos=++_j){second=_ref2[secondpos];if(secondpos!==firstpos&&second.type==="relation"&&second.val!=="neq"){_ref3=first.objs;for(firstside=_k=0,_len2=_ref3.length;_k<_len2;firstside=++_k){firstpart=_ref3[firstside];_ref4=second.objs;for(secondside=_l=0,_len3=_ref4.length;_l<_len3;secondside=++_l){secondpart=_ref4[secondside];if(!o.deps.equal(firstpart,secondpart)){continue}firstcomp=first.objs[firstside?0:1];firstcompval=o.deps.newEvalNumVal(firstcomp);if(firstcompval!==false){secondcomp=second.objs[secondside?0:1];secondcompval=o.deps.newEvalNumVal(secondcomp);if(secondcompval!==false){test1={type:"relation",val:first.val,objs:[secondcomp,firstcomp]};if(firstside===1){test1=flipRel(test1)}test2={type:"relation",val:second.val,objs:[firstcomp,secondcomp]};if(secondside===1){test2=flipRel(test2)}if(test1.val==="eq"||test2.val==="eq"){if(test1.val===test2.val){if(!o.deps.equal(firstcomp,secondcomp)){return{selection:[[firstpos],[secondpos]]}}}else if(test1.val.length===2&&test2.val.length===2&&o.deps.equal(firstcomp,secondcomp)){return{selection:[[firstpos],[secondpos]]}}else if(test1.val[0]==="g"&&firstcompval>secondcompval||test1.val[0]==="l"&&firstcompval<secondcompval||test2.val[0]==="g"&&firstcompval<secondcompval||test2.val[0]==="l"&&firstcompval>secondcompval){return{selection:[[firstpos],[secondpos]]}}}else if(((_ref5=test1.val)==="gt"||_ref5==="geq")&&((_ref6=test2.val)==="lt"||_ref6==="leq")||((_ref7=test2.val)==="gt"||_ref7==="geq")&&((_ref8=test1.val)==="lt"||_ref8==="leq")){firstresult=o.deps.evalNumericRelation({target:test1,deps:o.deps});secondresult=o.deps.evalNumericRelation({target:test2,deps:o.deps});if(!firstresult||!secondresult){return{selection:[[firstpos],[secondpos]]}}}}}}}}}}}return Err("AUTOnoincompat")},perform:function(o){return{beforemarks:o.selection,result:FALSE}}};combineOppositeOrEqsToEqInAnd={info:{name:"combineOppositeOrEqsToEqInAnd",effect:"simplifying",example:{str:"x<=3 and x>=3",selection:[[0],[1]]},tags:["logic","comparison","equality","relation","merge","logicand"],lesson:"relationcomb"},target:"AND",selection:{max:1,makefirstunique:true,questions:[{instruction:"SELfirstpart",filter:function(o){var _ref1;if(o.item.type==="relation"&&((_ref1=o.item.val)==="leq"||_ref1==="geq")){return OK}else{return Err("SELmustbenotneq")}}},{instruction:"SELsecondpart",filter:function(o){var _ref1;if(o.item.type==="relation"&&((_ref1=o.item.val)==="leq"||_ref1==="geq")){return OK}else{return Err("SELmustbenotneq")}}}]},auto:function(o){var first,firstcomp,firstpart,firstpos,firstside,second,secondcomp,secondpart,secondpos,secondside,test1,test2,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6;_ref1=o.target.objs.slice(0,-1);for(firstpos=_i=0,_len=_ref1.length;_i<_len;firstpos=++_i){first=_ref1[firstpos];if(first.type==="relation"&&((_ref2=first.val)==="leq"||_ref2==="geq")){_ref3=o.target.objs;for(secondpos=_j=0,_len1=_ref3.length;_j<_len1;secondpos=++_j){second=_ref3[secondpos];if(secondpos!==firstpos&&second.type==="relation"&&((_ref4=second.val)==="leq"||_ref4==="geq")){_ref5=first.objs;for(firstside=_k=0,_len2=_ref5.length;_k<_len2;firstside=++_k){firstpart=_ref5[firstside];_ref6=second.objs;for(secondside=_l=0,_len3=_ref6.length;_l<_len3;secondside=++_l){secondpart=_ref6[secondside];if(!o.deps.equal(firstpart,secondpart)){continue}firstcomp=first.objs[firstside?0:1];if(o.deps.newEvalNumVal(firstcomp)!==false){secondcomp=second.objs[secondside?0:1];if(o.deps.equal(firstcomp,secondcomp)){test1={type:"relation",val:first.val,objs:[secondcomp,firstcomp]};if(firstside===1){test1=flipRel(test1)}if(o.deps.evalNumericRelation({target:test1,deps:o.deps})===true){test2={type:"relation",val:second.val,objs:[firstcomp,secondcomp]};if(secondside===1){test2=flipRel(test2)}if(o.deps.evalNumericRelation({target:test2,deps:o.deps})===true){return{selection:[[firstpos],[secondpos]]}}}}}}}}}}}return Err("AUTOnocombinable")},perform:function(o){var neqpos,otherpos,r,_ref1,_ref2,_ref3;_ref1=o.selection,_ref2=_ref1[0],neqpos=_ref2[0],_ref3=_ref1[1],otherpos=_ref3[0];o.target.objs[otherpos].val="eq";r=o.deps.collapseStubList(And(o.target.objs.filter(function(part,n){return n!==neqpos})));return{result:r,beforemarks:[[neqpos],[otherpos]],aftermarks:r.type!=="AND"?[]:otherpos>neqpos?[[otherpos-1]]:[[otherpos]]}}};swallowContainedComparisons={info:{name:"swallowContainedComparisons",effect:"simplifying",example:{str:"x<3 and x<8",selection:[[0],[1]]},tags:["logic","logicand","comparison","relation","remove"],lesson:"relationcomb"},prints:{errors:["AUTOnoswallow"]},target:{type:"AND"},selection:{max:1,makefirstunique:true,questions:[{instruction:"SELkeeppart",filter:function(o){var _ref1;if(o.item.type==="relation"&&((_ref1=o.item.val)==="lt"||_ref1==="leq"||_ref1==="gt"||_ref1==="geq")){return OK}else{return Err("SELmustbenotneq")}}},{instruction:"SELkillpart",filter:function(o){var _ref1;if(o.item.type==="relation"&&((_ref1=o.item.val)==="lt"||_ref1==="leq"||_ref1==="gt"||_ref1==="geq")){return OK}else{return Err("SELmustbenotneq")}}}]},auto:function(o){var first,firstcomp,firstpart,firstpos,firstside,firstval,keep,second,secondcomp,secondpart,secondpos,secondside,secondval,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7;_ref1=o.target.objs.slice(0,-1);for(firstpos=_i=0,_len=_ref1.length;_i<_len;firstpos=++_i){first=_ref1[firstpos];if(first.type==="relation"&&((_ref2=first.val)==="lt"||_ref2==="leq"||_ref2==="gt"||_ref2==="geq")){_ref3=o.target.objs;for(secondpos=_j=0,_len1=_ref3.length;_j<_len1;secondpos=++_j){second=_ref3[secondpos];if(secondpos!==firstpos&&second.type==="relation"&&((_ref4=second.val)==="lt"||_ref4==="leq"||_ref4==="gt"||_ref4==="geq")){_ref5=first.objs;for(firstside=_k=0,_len2=_ref5.length;_k<_len2;firstside=++_k){firstpart=_ref5[firstside];_ref6=second.objs;for(secondside=_l=0,_len3=_ref6.length;_l<_len3;secondside=++_l){secondpart=_ref6[secondside];if(!o.deps.equal(firstpart,secondpart)){continue}firstcomp=first.objs[firstside?0:1];firstval=o.deps.newEvalNumVal(firstcomp);if(firstval!==false){secondcomp=second.objs[secondside?0:1];secondval=o.deps.newEvalNumVal(secondcomp);if(secondval!==false){if(firstval!==secondval){keep=0;if(first.val[0]===second.val[0]&&firstside===secondside){keep=first.val[0]==="g"?"greatest":"smallest"}else if(first.val[0]!==second.val[0]&&firstside!==secondside){keep=(_ref7=first.val[0]+second.val[0]+firstside+""+secondside)==="gl01"||_ref7==="lg10"?"greatest":"smallest"}if(keep==="greatest"){return{selection:secondval>firstval?[[secondpos],[firstpos]]:[[firstpos],[secondpos]]}}else if(keep==="smallest"){return{selection:secondval<firstval?[[secondpos],[firstpos]]:[[firstpos],[secondpos]]}}}else if(first.val.length!==second.val.length){if(firstside===secondside&&first.val[0]===second.val[0]||firstside!==secondside&&first.val[0]!==second.val[0]){return{selection:first.val.length===2?[[firstpos],[secondpos]]:[[secondpos],[firstpos]]}}}}}}}}}}}return Err("AUTOnoswallow")},perform:function(o){var keeppos,killpos,r,_ref1,_ref2,_ref3;_ref1=o.selection,_ref2=_ref1[0],keeppos=_ref2[0],_ref3=_ref1[1],killpos=_ref3[0];r=o.deps.collapseStubList(And(o.target.objs.filter(function(part,n){return n!==killpos})));return{result:r,beforemarks:[[keeppos],[killpos]],aftermarks:r.type!=="AND"?[]:keeppos>killpos?[[keeppos-1]]:[[keeppos]]}}};complexComparisonToBool={info:{name:"complexComparisonToBool",effect:"simplifying",example:{str:"i<2",hunt:[[0]]},tags:["logic","constanti","comparison","relation"],lesson:"complexconst"},target:{type:"relation",validate:function(o){var _ref1;if(((_ref1=o.target.val)==="lt"||_ref1==="leq"||_ref1==="gt"||_ref1==="geq")&&o.deps.containsTypeWithVal(o.target,"const","i")){return OK}else{return Err("TARnoconst")}}},hunt:{instruction:"HUNTcompl"},auto:function(o){var path;path=o.deps.findPathTo(o.target,I);if(path){return{hunt:[path]}}else{return Err("AUTOnocompl")}},perform:function(o){var dir,side;dir=o.target.val[0];side=o.hunt[0][0];return{result:side===1&&dir==="g"||side===0&&dir==="l"?TRUE:FALSE}}};combineOppositeStrictCombsInOr={info:{name:"combineOppositeStrictCombsInOr",effect:"simplifying",example:{str:"x<3 or x>3",selection:[[0],[1]]},tags:["logic","comparison","forbiddenequality","logicor","relation","merge"],lesson:"relationcomb"},target:"OR",selection:{max:1,makefirstunique:true,questions:[{instruction:"SELfirstpart",filter:function(o){var _ref1;if(o.item.type==="relation"&&((_ref1=o.item.val[0])==="l"||_ref1==="g")&&o.item.val.length===2){return OK}else{return Err("SELmustbenotneq")}}},{instruction:"SELsecondpart",filter:function(o){var _ref1;if(o.item.type==="relation"&&((_ref1=o.item.val[0])==="l"||_ref1==="g")&&o.item.val.length===2){return OK}else{return Err("SELmustbenotneq")}}}]},auto:function(o){var first,firstotherside,firstpart,firstpos,firstside,second,secondotherside,secondpart,secondpos,secondside,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6;_ref1=o.target.objs.slice(0,-1);for(firstpos=_i=0,_len=_ref1.length;_i<_len;firstpos=++_i){first=_ref1[firstpos];if(first.type==="relation"&&((_ref2=first.val)==="lt"||_ref2==="gt")){_ref3=o.target.objs;for(secondpos=_j=0,_len1=_ref3.length;_j<_len1;secondpos=++_j){second=_ref3[secondpos];if(secondpos!==firstpos&&second.type==="relation"&&((_ref4=second.val)==="lt"||_ref4==="gt")){_ref5=first.objs;for(firstside=_k=0,_len2=_ref5.length;_k<_len2;firstside=++_k){firstpart=_ref5[firstside];firstotherside=firstside?0:1;_ref6=second.objs;for(secondside=_l=0,_len3=_ref6.length;_l<_len3;secondside=++_l){secondpart=_ref6[secondside];if(!o.deps.equal(firstpart,secondpart)){continue}secondotherside=secondside?0:1;if(o.deps.equal(first.objs[firstotherside],second.objs[secondotherside])){if(firstside===secondside&&first.val[0]!==second.val[0]||firstside!==secondside&&first.val[0]===second.val[0]){return{selection:[[firstpos],[secondpos]]}}}}}}}}}return Err("AUTOnocombinable")},perform:function(o){var change,child,n,res,without;change=mixin({val:"neq"},deepcopy(o.target.objs[o.selection[0][0]]));without=Or(function(){var _i,_len,_ref1,_results;_ref1=o.target.objs;_results=[];for(n=_i=0,_len=_ref1.length;_i<_len;n=++_i){child=_ref1[n];if(n!==o.selection[1][0]){_results.push(child)}}return _results}());res=o.deps.collapseStubList(o.deps.exchangeChild(without,change,o.selection[0]));console.log("EXCHANGEDDDD");printObj(res);return{result:res,beforemarks:o.selection,aftermarks:o.target.type==="OR"?[o.selection[0]]:[]}}};swallowContainedComparisonsInOr={info:{name:"swallowContainedComparisonsInOr",effect:"simplifying",example:{str:"x<3 or x<8",selection:[[0],[1]]},tags:["logic","logicor","comparison","remove","relation"],lesson:"relationcomb"},prints:{errors:["AUTOnoswallow"]},target:{type:"OR"},selection:{max:1,makefirstunique:true,questions:[{instruction:"SELkeeppart",filter:function(o){var _ref1;if(o.item.type==="relation"&&((_ref1=o.item.val)==="lt"||_ref1==="leq"||_ref1==="gt"||_ref1==="geq")){return OK}else{return Err("SELmustbenotneq")}}},{instruction:"SELkillpart",filter:function(o){var _ref1;if(o.item.type==="relation"&&((_ref1=o.item.val)==="lt"||_ref1==="leq"||_ref1==="gt"||_ref1==="geq")){return OK}else{return Err("SELmustbenotneq")}}}]},auto:function(o){var first,firstcomp,firstpart,firstpos,firstside,firstval,keep,second,secondcomp,secondpart,secondpos,secondside,secondval,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7;_ref1=o.target.objs.slice(0,-1);for(firstpos=_i=0,_len=_ref1.length;_i<_len;firstpos=++_i){first=_ref1[firstpos];if(first.type==="relation"&&((_ref2=first.val)==="lt"||_ref2==="leq"||_ref2==="gt"||_ref2==="geq")){_ref3=o.target.objs;for(secondpos=_j=0,_len1=_ref3.length;_j<_len1;secondpos=++_j){second=_ref3[secondpos];if(secondpos!==firstpos&&second.type==="relation"&&((_ref4=second.val)==="lt"||_ref4==="leq"||_ref4==="gt"||_ref4==="geq")){_ref5=first.objs;for(firstside=_k=0,_len2=_ref5.length;_k<_len2;firstside=++_k){firstpart=_ref5[firstside];_ref6=second.objs;for(secondside=_l=0,_len3=_ref6.length;_l<_len3;secondside=++_l){secondpart=_ref6[secondside];if(!o.deps.equal(firstpart,secondpart)){continue}firstcomp=first.objs[firstside?0:1];firstval=o.deps.newEvalNumVal(firstcomp);if(firstval!==false){secondcomp=second.objs[secondside?0:1];secondval=o.deps.newEvalNumVal(secondcomp);if(secondval!==false&&firstval!==secondval){keep=0;if(first.val[0]===second.val[0]&&firstside===secondside){keep=first.val[0]==="g"?"greatest":"smallest"}else if(first.val[0]!==second.val[0]&&firstside!==secondside){keep=(_ref7=first.val[0]+second.val[0]+firstside+""+secondside)==="gl01"||_ref7==="lg10"?"greatest":"smallest"}if(keep==="greatest"){return{selection:secondval<firstval?[[secondpos],[firstpos]]:[[firstpos],[secondpos]]}}else if(keep==="smallest"){return{selection:secondval>firstval?[[secondpos],[firstpos]]:[[firstpos],[secondpos]]}}}else if(first.val.length!==second.val.length){if(firstside===secondside&&first.val[0]===second.val[0]||firstside!==secondside&&first.val[0]!==second.val[0]){return{selection:first.val.length===3?[[firstpos],[secondpos]]:[[secondpos],[firstpos]]}}}}}}}}}}return Err("AUTOnoswallow")},perform:function(o){var keeppos,killpos,r,_ref1,_ref2,_ref3;_ref1=o.selection,_ref2=_ref1[0],keeppos=_ref2[0],_ref3=_ref1[1],killpos=_ref3[0];r=o.deps.collapseStubList(And(o.target.objs.filter(function(part,n){return n!==killpos})));return{result:r,beforemarks:[[keeppos],[killpos]],aftermarks:r.type!=="AND"?[]:keeppos>killpos?[[keeppos-1]]:[[keeppos]]}}};removeSuperfluousEqsInOr={info:{name:"removeSuperfluousEqsInOr",effect:"simplifying",example:{str:"x=3 or x>2",selection:[[0],[1]]},tags:["logic","equality","comparison","logicor","remove","relation"],lesson:"relationcomb"},target:"OR",selection:{max:1,makefirstunique:true,questions:[{instruction:"SELeq",filter:function(o){if(o.item.type==="relation"&&o.item.val==="eq"){return OK}else{return Err("SELmustbeeq")}}},{instruction:"SELineq",filter:function(o){var _ref1;if(o.item.type==="relation"&&((_ref1=o.item.val)==="lt"||_ref1==="leq"||_ref1==="gt"||_ref1==="geq")){return OK}else{return Err("SELmustbeineq")}}}]},auto:function(o){var neq,neqcomp,neqpos,neqval,neqvalside,nv,other,othercomp,othercompside,otherpos,otherval,ov,testrel,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref1,_ref2,_ref3,_ref4,_ref5;_ref1=o.target.objs;for(neqpos=_i=0,_len=_ref1.length;_i<_len;neqpos=++_i){neq=_ref1[neqpos];if(neq.type==="relation"&&neq.val==="eq"){_ref2=neq.objs;for(neqvalside=_j=0,_len1=_ref2.length;_j<_len1;neqvalside=++_j){neqval=_ref2[neqvalside];nv=o.deps.newEvalNumVal(neqval);if(nv!==false){neqcomp=neq.objs[neqvalside?0:1];_ref3=o.target.objs;for(otherpos=_k=0,_len2=_ref3.length;_k<_len2;otherpos=++_k){other=_ref3[otherpos];if(otherpos!==neqpos&&other.type==="relation"&&((_ref4=other.val)==="lt"||_ref4==="leq"||_ref4==="gt"||_ref4==="geq")){_ref5=other.objs;for(othercompside=_l=0,_len3=_ref5.length;_l<_len3;othercompside=++_l){othercomp=_ref5[othercompside];if(!o.deps.equal(othercomp,neqcomp)){continue}otherval=other.objs[othercompside?0:1];ov=o.deps.newEvalNumVal(otherval);if(ov!==false){testrel={type:"relation",val:other.val,objs:[neqval,otherval]};if(othercompside!==0){testrel=flipRel(testrel)}console.log("CAME THIS FAR");printObj(testrel);if(o.deps.evalNumericRelation({target:testrel,deps:o.deps})===true){return{selection:[[neqpos],[otherpos]]}}}}}}}}}}return Err("AUTOnofix")},perform:function(o){var neqpos,otherpos,r,_ref1,_ref2,_ref3;_ref1=o.selection,_ref2=_ref1[0],neqpos=_ref2[0],_ref3=_ref1[1],otherpos=_ref3[0];r=o.deps.collapseStubList(And(o.target.objs.filter(function(part,n){return n!==neqpos})));return{result:r,beforemarks:[[neqpos],[otherpos]],aftermarks:r.type!=="OR"?[]:otherpos>neqpos?[[otherpos-1]]:[[otherpos]]}}};disjunctionWithNeqInCompToTrue={info:{name:"disjunctionWithNeqInCompToTrue",effect:"simplifying",example:{str:"x!=3 or x>2",selection:[[0],[1]]},tags:["logic","forbiddenequality","comparison","logicor","logictrue","relation"],lesson:"relationcomb"},target:"OR",selection:{max:1,makefirstunique:true,questions:[{instruction:"SELneq",filter:function(o){if(o.item.type==="relation"&&o.item.val==="neq"){return OK}else{return Err("SELmustbeneq")}}},{instruction:"SELineq",filter:function(o){var _ref1;if(o.item.type==="relation"&&((_ref1=o.item.val)==="lt"||_ref1==="leq"||_ref1==="gt"||_ref1==="geq")){return OK}else{return Err("SELmustbeineq")}}}]},auto:function(o){var neq,neqcomp,neqpos,neqval,neqvalside,nv,other,othercomp,othercompside,otherpos,otherval,ov,testrel,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref1,_ref2,_ref3,_ref4,_ref5;_ref1=o.target.objs;for(neqpos=_i=0,_len=_ref1.length;_i<_len;neqpos=++_i){neq=_ref1[neqpos];if(neq.type==="relation"&&neq.val==="neq"){_ref2=neq.objs;for(neqvalside=_j=0,_len1=_ref2.length;_j<_len1;neqvalside=++_j){neqval=_ref2[neqvalside];nv=o.deps.newEvalNumVal(neqval);if(nv!==false){neqcomp=neq.objs[neqvalside?0:1];_ref3=o.target.objs;for(otherpos=_k=0,_len2=_ref3.length;_k<_len2;otherpos=++_k){other=_ref3[otherpos];if(otherpos!==neqpos&&other.type==="relation"&&((_ref4=other.val)==="lt"||_ref4==="leq"||_ref4==="gt"||_ref4==="geq")){_ref5=other.objs;for(othercompside=_l=0,_len3=_ref5.length;_l<_len3;othercompside=++_l){othercomp=_ref5[othercompside];if(!o.deps.equal(othercomp,neqcomp)){continue}otherval=other.objs[othercompside?0:1];ov=o.deps.newEvalNumVal(otherval);if(ov!==false){testrel={type:"relation",val:other.val,objs:[neqval,otherval]};if(othercompside!==0){testrel=flipRel(testrel)}console.log("CAME THIS FAR");printObj(testrel);if(o.deps.evalNumericRelation({target:testrel,deps:o.deps})===true){return{selection:[[neqpos],[otherpos]]}}}}}}}}}}return Err("AUTOnofix")},perform:function(o){return{result:TRUE,beforemarks:o.selection}}};removeSuperfluousCompsInOrWithNeq={info:{name:"removeSuperfluousCompsInOrWithNeq",effect:"simplifying",example:{str:"x!=3 or x<2",selection:[[0],[1]]},tags:["logic","logicor","forbiddenequality","comparison","relation","remove"],lesson:"relationcomb"},target:"OR",selection:{max:1,makefirstunique:true,questions:[{instruction:"SELneq",filter:function(o){if(o.item.type==="relation"&&o.item.val==="neq"){return OK}else{return Err("SELmustbeneq")}}},{instruction:"SELineq",filter:function(o){var _ref1;if(o.item.type==="relation"&&((_ref1=o.item.val)==="lt"||_ref1==="leq"||_ref1==="gt"||_ref1==="geq")){return OK}else{return Err("SELmustbeineq")}}}]},auto:function(o){var neq,neqcomp,neqpos,neqval,neqvalside,nv,other,othercomp,othercompside,otherpos,otherval,ov,testrel,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref1,_ref2,_ref3,_ref4,_ref5;_ref1=o.target.objs;for(neqpos=_i=0,_len=_ref1.length;_i<_len;neqpos=++_i){neq=_ref1[neqpos];if(neq.type==="relation"&&neq.val==="neq"){_ref2=neq.objs;for(neqvalside=_j=0,_len1=_ref2.length;_j<_len1;neqvalside=++_j){neqval=_ref2[neqvalside];nv=o.deps.newEvalNumVal(neqval);if(nv!==false){neqcomp=neq.objs[neqvalside?0:1];_ref3=o.target.objs;for(otherpos=_k=0,_len2=_ref3.length;_k<_len2;otherpos=++_k){other=_ref3[otherpos];if(otherpos!==neqpos&&other.type==="relation"&&((_ref4=other.val)==="lt"||_ref4==="leq"||_ref4==="gt"||_ref4==="geq")){_ref5=other.objs;for(othercompside=_l=0,_len3=_ref5.length;_l<_len3;othercompside=++_l){othercomp=_ref5[othercompside];if(!o.deps.equal(othercomp,neqcomp)){continue}otherval=other.objs[othercompside?0:1];ov=o.deps.newEvalNumVal(otherval);if(ov!==false){testrel={type:"relation",val:other.val,objs:[neqval,otherval]};if(othercompside!==0){testrel=flipRel(testrel)}console.log("CAME THIS FAR");printObj(testrel);if(o.deps.evalNumericRelation({target:testrel,deps:o.deps})===false){return{selection:[[neqpos],[otherpos]]}}}}}}}}}}return Err("AUTOnofix")},perform:function(o){var neqpos,otherpos,r,_ref1,_ref2,_ref3;_ref1=o.selection,_ref2=_ref1[0],otherpos=_ref2[0],_ref3=_ref1[1],neqpos=_ref3[0];r=o.deps.collapseStubList(And(o.target.objs.filter(function(part,n){return n!==neqpos})));return{result:r,beforemarks:[[neqpos],[otherpos]],aftermarks:r.type!=="OR"?[]:otherpos>neqpos?[[otherpos-1]]:[[otherpos]]}}};removeInferredComp={info:{name:"removeInferredComp",effect:"simplifying",example:{str:"x<y and y<2 and x<2",selection:[[0,1],[2]]},tags:["logic","relation","logicand","comparison","remove"],lesson:"relationcomb"},target:"AND",selection:{questions:[{instruction:"SELfromrels",max:2,min:2},{instruction:"SELinfrel",max:1}]},auto:function(o){var infrel,r1,r1pos,r2,r2pos,r3,r3pos,_i,_j,_k,_len,_len1,_len2,_ref1,_ref2,_ref3,_ref4,_ref5;_ref1=o.target.objs;for(r1pos=_i=0,_len=_ref1.length;_i<_len;r1pos=++_i){r1=_ref1[r1pos];if(r1.type==="relation"&&((_ref2=r1.val[0])==="g"||_ref2==="l")){_ref3=o.target.objs;for(r2pos=_j=0,_len1=_ref3.length;_j<_len1;r2pos=++_j){r2=_ref3[r2pos];if(!(r2pos!==r1pos&&r2.type==="relation"&&((_ref4=r2.val[0])==="g"||_ref4==="l"))){continue}infrel=o.deps.findInferredComp(r1,r2,o.deps);if(infrel){_ref5=o.target.objs;for(r3pos=_k=0,_len2=_ref5.length;_k<_len2;r3pos=++_k){r3=_ref5[r3pos];if(r3pos!==r1pos&&r3pos!==r2pos){if(o.deps.isKindredSpirits({obj1:infrel,obj2:r3,deps:o.deps}).result){return{selection:[[r1pos,r2pos],[r3pos]]}}}}}}}}return Err("AUTOnoinfmatch")},perform:function(o){var c,n;return{result:And(function(){var _i,_len,_ref1,_results;_ref1=o.target.objs;_results=[];for(n=_i=0,_len=_ref1.length;_i<_len;n=++_i){c=_ref1[n];if(n!==o.selection[1][0]){_results.push(c)}}return _results}()),beforemarks:[o.selection[1]]}}};undefinedChildToFalseInLogic={info:{name:"undefinedChildToFalseInLogic",effect:"simplifying",example:{str:"x=undefined and y=z",selection:[[0]],hunt:[[1]]},tags:["logic","undefinedval","logicor","logicand","ifelse","logicfalse"],lesson:"logic102"},target:{type:"all",validate:function(o){var _ref1;if((_ref1=o.target.type)==="AND"||_ref1==="OR"||_ref1==="ifelse"){return OK}else{return Err("TARmustbelogic")}}},auto:function(o){var child,path,pos,_i,_len,_ref1;_ref1=o.target.objs;for(pos=_i=0,_len=_ref1.length;_i<_len;pos=++_i){child=_ref1[pos];path=o.deps.findPathTo(child,UNDEFINED);if(path){return{selection:[[pos]],hunt:[path]}}}return Err("AUTOnoundef")},perform:function(o){var childpos,path;childpos=o.selection[0][0];path=o.hunt[0];return{beforemarks:[[childpos].concat(path)],aftermarks:[[childpos]],result:o.deps.exchangeChild(o.target,FALSE,[childpos])}}};unravelEqOfPowAndOne={info:{name:"unravelEqOfPowAndOne",effect:"simplifying",example:"x^p=1",tags:["number1","number0","power","logic","relation"],lesson:"relspec"},target:{type:"relation",validate:function(_arg){var deps,left,right,val,_ref1,_ref2;
deps=_arg.deps,_ref1=_arg.target,val=_ref1.val,_ref2=_ref1.objs,left=_ref2[0],right=_ref2[1];if(val==="eq"&&(left.type==="power"&&deps.equal(right,one))||right.type==="power"&&deps.equal(left,one)){return OK}else{return Err("TARnopoweq1")}}},perform:function(o){var power;power=o.target.objs[0].type==="power"?o.target.objs[0]:o.target.objs[1];return{result:Or(Eq(power.objs[0],one),And(Eq(power.objs[1],zero),Neq(power.objs[0],zero)))}}};exploreForbiddenEqWith1Or0={info:{name:"exploreForbiddenEqWith1Or0",effect:"simplifying",example:"x^y!=0",tags:["number1","number0","equality","forbiddenequality","logicnot"],uses:["expandRelToNot","collapseNotAnd","collapseNotOr","collapseNotRel","unravelEqOfPowAndOne","zeroProdMethod","collapseRootInZeroRel","collapseRootInOneRel","collapseFracInOneRel","collapseFracInZeroRel","collapsePowInZeroRel"],lesson:"relspec"},target:{type:"relation",validate:function(_arg){var deps,left,op,result,right,test,val,_i,_len,_ref1,_ref2,_ref3;deps=_arg.deps,_ref1=_arg.target,val=_ref1.val,_ref2=_ref1.objs,left=_ref2[0],right=_ref2[1];if(val!=="neq"){return Err("TARmustbeneq")}else{test=Eq(left,right);_ref3=["unravelEqOfPowAndOne","zeroProdMethod","collapseRootInZeroRel","collapseRootInOneRel","collapseFracInOneRel","collapseFracInZeroRel","collapsePowInZeroRel"];for(_i=0,_len=_ref3.length;_i<_len;_i++){op=_ref3[_i];result=deps.generateOpInputForTarget({deps:deps,tool:deps[op],target:test});if(!isErr(result)){return OK}}return Err("TARcannotsimplify")}}},perform:function(o){var child,n,op,_i,_j,_len,_len1,_ref1,_ref2,_ref3;o["do"]("expandRelToNot","firstexpand");o.report("WOOP");_ref1=["unravelEqOfPowAndOne","zeroProdMethod","collapseRootInZeroRel","collapseRootInOneRel","collapseFracInOneRel","collapseFracInZeroRel","collapsePowInZeroRel"];for(_i=0,_len=_ref1.length;_i<_len;_i++){op=_ref1[_i];o.report("Gonna try "+op);o["try"](op,"nowsimpl",[0])}o.report("Finished! :)");o.doIf("collapseNotRel","negaterel",{});o.doIf("collapseNotAnd","negateconj",{});o.doIf("collapseNotOr","negatedis",{});if((_ref2=o.target.type)==="AND"||_ref2==="OR"){_ref3=o.target.objs;for(n=_j=0,_len1=_ref3.length;_j<_len1;n=++_j){child=_ref3[n];o.doIf("collapseNotRel","negatestatement",{aim:[n]})}o.doIf("collapseNotAnd","negateconj",{aim:[1]});o.doIf("collapseNotRel","negatestatement",{aim:[1,0]});o.doIf("collapseNotRel","negatestatement",{aim:[1,1]})}return o.beforemark([0])}};if(typeof exports==="undefined"){exportTo=this.CATS.math}else{exportTo=exports}funcs={exploreForbiddenEqWith1Or0:exploreForbiddenEqWith1Or0,evalNumericDivTest:evalNumericDivTest,writeDivTestAsIntTest:writeDivTestAsIntTest,unravelEqOfPowAndOne:unravelEqOfPowAndOne,removeSuperfluousCompsInAnd:removeSuperfluousCompsInAnd,shaveCompWithEqInAnd:shaveCompWithEqInAnd,undefinedChildToFalseInLogic:undefinedChildToFalseInLogic,disjunctionWithHiddenOppsToTrue:disjunctionWithHiddenOppsToTrue,conjunctionWithHiddenOppsToFalse:conjunctionWithHiddenOppsToFalse,expandRelToNot:expandRelToNot,disjunctionWithOppsToTrue:disjunctionWithOppsToTrue,conjunctionWithOppsToFalse:conjunctionWithOppsToFalse,removeInferredComp:removeInferredComp,findInferredComp:findInferredComp,removeSuperfluousCompsInOrWithNeq:removeSuperfluousCompsInOrWithNeq,disjunctionWithNeqInCompToTrue:disjunctionWithNeqInCompToTrue,removeSuperfluousEqsInOr:removeSuperfluousEqsInOr,swallowContainedComparisonsInOr:swallowContainedComparisonsInOr,combineOppositeStrictCombsInOr:combineOppositeStrictCombsInOr,purgeSpiritDuplicatesFromLogic:purgeSpiritDuplicatesFromLogic,flipRelation:flipRelation,findRelCouple:findRelCouple,compareRelations:compareRelations,complexComparisonToBool:complexComparisonToBool,swallowContainedComparisons:swallowContainedComparisons,combineOppositeOrEqsToEqInAnd:combineOppositeOrEqsToEqInAnd,andWithIncompatiblePartsToFalse:andWithIncompatiblePartsToFalse,removeSuperfluousNeqsInAnd:removeSuperfluousNeqsInAnd,shaveRelsInAnd:shaveRelsInAnd,collapseNotOr:collapseNotOr,collapseNotAnd:collapseNotAnd,collapseNotRel:collapseNotRel,unrollIfElse:unrollIfElse,absorbOrsInAnd:absorbOrsInAnd,collapseIfElseWithSameBranches:collapseIfElseWithSameBranches,evalIfElse:evalIfElse,collapseDecFracIntegerTest:collapseDecFracIntegerTest,collapseNegIntegerTest:collapseNegIntegerTest,evalNumIntegerTest:evalNumIntegerTest,addNewVar:addNewVar,substitute:substitute,absorbSubAnds:absorbSubAnds,absorbSubOrs:absorbSubOrs,purgeDuplicatesFromLogic:purgeDuplicatesFromLogic,numericRelToBool:numericRelToBool,isLogic:isLogic,isLogicContainer:isLogicContainer,evalNumericRelation:evalNumericRelation,collapseDoubleNot:collapseDoubleNot,purgeFalseFromOr:purgeFalseFromOr,purgeTrueFromAnd:purgeTrueFromAnd,orWithTrueIsTrue:orWithTrueIsTrue,andWithFalseIsFalse:andWithFalseIsFalse,notFalseIsTrue:notFalseIsTrue,notTrueIsFalse:notTrueIsFalse};for(k in funcs){v=funcs[k];exportTo[k]=v}}).call(this);
(function(){var Abs,And,Cbrt,Cube,DivTest,E,Eq,Err,FALSE,Frac,Fraction,Geq,Gt,I,IfElse,IntTest,Leq,Log,Lt,Neg,Neq,Not,Num,OK,Or,PERCENT,PI,PlusMinus,Pow,Power,Prod,Product,Root,Sqrt,Square,Sum,TRUE,UNDEFINED,absToPlusMinusInEq,arrsplit,collapseAbsFrac,collapseAbsNeg,collapseAbsNum,collapseAbsPow,collapseAbsPowWithNumBase,collapseAbsProd,deepcopy,expandAbsInComb,expandAbsPartInRelAndFix,expandAbsToIfElse,expandPlusMinusDirectlyInRel,expandPlusMinusInOr,expandPlusMinusInRel,exportTo,extractPosTermsFromAbsSum,five,flipRel,four,funcs,intersection,isErr,isOK,k,killAbsInPlusMinus,makeCheck,mixin,one,plusMinusZeroToZero,posNegOrToPlusMinus,printObj,three,two,v,x,y,z,zero,_ref,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};_ref=typeof require==="undefined"?this.CATS.math.toolhelpers:require("./toolhelpers"),flipRel=_ref.flipRel,IfElse=_ref.IfElse,DivTest=_ref.DivTest,IntTest=_ref.IntTest,Square=_ref.Square,Cube=_ref.Cube,PlusMinus=_ref.PlusMinus,Log=_ref.Log,Abs=_ref.Abs,PI=_ref.PI,Root=_ref.Root,Sqrt=_ref.Sqrt,Cbrt=_ref.Cbrt,arrsplit=_ref.arrsplit,E=_ref.E,I=_ref.I,PERCENT=_ref.PERCENT,intersection=_ref.intersection,UNDEFINED=_ref.UNDEFINED,deepcopy=_ref.deepcopy,isErr=_ref.isErr,isOK=_ref.isOK,mixin=_ref.mixin,Prod=_ref.Prod,Frac=_ref.Frac,Pow=_ref.Pow,Eq=_ref.Eq,Leq=_ref.Leq,Gt=_ref.Gt,Geq=_ref.Geq,Lt=_ref.Lt,Neq=_ref.Neq,four=_ref.four,five=_ref.five,And=_ref.And,Or=_ref.Or,Not=_ref.Not,TRUE=_ref.TRUE,FALSE=_ref.FALSE,makeCheck=_ref.makeCheck,x=_ref.x,y=_ref.y,z=_ref.z,Neg=_ref.Neg,Product=_ref.Product,Sum=_ref.Sum,Power=_ref.Power,Fraction=_ref.Fraction,Num=_ref.Num,zero=_ref.zero,one=_ref.one,two=_ref.two,three=_ref.three,Err=_ref.Err,OK=_ref.OK,printObj=_ref.printObj;killAbsInPlusMinus={info:{name:"killAbsInPlusMinus",effect:"simplifying",example:{str:"+-(x*|y|)",selection:[[1]],choices:["facs"]},tags:["absolute","plusminus"],uses:["expandPlusMinusInRel","expandAbsToIfElse","negToNegOneFacProd","absorbProductFacs","extractFacsFromExpression","negOneFacBiProdToNeg","collapseDoubleNeg","rearrange","collapseIfElseWithSameBranches","posNegOrToPlusMinus"]},target:"plusminus",choices:{options:function(o){return o.deps.getFacOptions(o.target.objs[0])}},selection:{filter:"absolute",from:function(o){return o.deps.getFacs(o.target.objs[0],o.choices[0])}},auto:function(o){var analysis,choice,fac,possibility,residue,sels,_i,_len;analysis=o.deps.getFacPossibilities(mixin({oneatatime:true,allowdenom:false,obj:o.target.objs[0]},o));for(_i=0,_len=analysis.length;_i<_len;_i++){possibility=analysis[_i];choice=possibility[0],sels=possibility[1],fac=possibility[2],residue=possibility[3];if(fac.type==="absolute"){return{choices:[choice],selection:[sels]}}}return Err("AUTOnoabsinplusminus")},perform:function(o){var abspath,facchoice,facsel,prodchoice;facchoice=o.choices[0];facsel=o.selection[0][0];abspath=o.deps.facPath(facchoice,facsel);o.report("OK",abspath);printObj(o.deps.lookUp(o.target,[0].concat(abspath)));o["do"]("expandAbsToIfElse","expandabs",{hunt:[[0].concat(abspath)]});o["do"]("expandPlusMinusInRel","expandfirstplusminus",{aim:[1],hunt:[[]]});o["do"]("expandPlusMinusInRel","expandsecondplusminus",{aim:[2],hunt:[[]]});prodchoice=o.deps.toProdPath(facchoice);if(facchoice!=="self"){o["do"]("negToNegOneFacProd","expandfirstneg",{aim:[1,0].concat(abspath),direction:"left"});o.doIf("absorbProductFacs","flattenfirst",{aim:[1,0].concat(abspath).slice(0,-1),selection:[[facsel]]});o["do"]("extractFacsFromExpression","extractfirstneg",{aim:[1,0],choices:[prodchoice],selection:[[facsel]],direction:"left"});o["do"]("negOneFacBiProdToNeg","makefirstneg",{aim:[1,0],selection:[[0]]});o["do"]("negToNegOneFacProd","expandsecondneg",{aim:[1,1,0].concat(abspath),direction:"left"});o.doIf("absorbProductFacs","flattensecond",{aim:[1,1,0].concat(abspath).slice(0,-1),selection:[[facsel]]});o["do"]("extractFacsFromExpression","extractsecondneg",{aim:[1,1,0],choices:[prodchoice],selection:[[facsel]],direction:"left"});o["do"]("negOneFacBiProdToNeg","makesecondneg",{aim:[1,1,0],selection:[[0]]})}o["do"]("collapseDoubleNeg","collapsedouble",{aim:[1,1]});o["do"]("rearrange","nowmovearound",{aim:[1],rearrange:[o.target.objs[1].objs[1],o.target.objs[1].objs[0]]});o["do"]("collapseIfElseWithSameBranches","nowcollapseifelse");return o["do"]("posNegOrToPlusMinus","andplusminusify",{selection:[[1],[0]]})}};expandAbsToIfElse={info:{name:"expandAbsToIfElse",effect:"simplifying",example:{str:"|x|",hunt:[[]]},tags:["absolute","ifelse"]},target:"all",auto:function(o){var abspaths,exps,lookfor,varname,varpaths,_ref1;varpaths={};_ref1=o.deps.varDependency(o.target);for(varname in _ref1){exps=_ref1[varname];lookfor=Abs({type:"variable",val:varname});abspaths=o.deps.findAllPathsTo(o.target,lookfor);if(abspaths.length){return{hunt:abspaths}}}return Err("AUTOnoabs")},hunt:{instruction:"HUNTtheabs",type:"absolute",multiple:true},perform:function(o){var abschild,aftermarks,negversion,obj,path,posversion,_i,_len,_ref1;path=o.hunt[0];if(o.hunt.length===1&&o.hunt[0].length===0){obj=o.target.objs[0];return{result:IfElse(Lt(obj,zero),Neg(obj),obj)}}else{abschild=o.deps.lookUp(o.target,o.hunt[0]).objs[0];negversion=deepcopy(o.target);posversion=deepcopy(o.target);aftermarks=[];_ref1=o.hunt;for(_i=0,_len=_ref1.length;_i<_len;_i++){path=_ref1[_i];negversion=o.deps.exchangeChild(negversion,Neg(abschild),path);posversion=o.deps.exchangeChild(posversion,abschild,path);aftermarks.push([1].concat(path));aftermarks.push([2].concat(path))}return{result:IfElse(Lt(abschild,zero),negversion,posversion),beforemarks:o.hunt,aftermarks:aftermarks}}}};posNegOrToPlusMinus={info:{name:"posNegOrToPlusMinus",effect:"rephrasing",example:{str:"x or -x",selection:[[1],[0]]},tags:["plusminus"]},target:"OR",selection:{max:1,makefirstunique:true,questions:[{filter:"negation"},{}]},validate:function(o){if(o.deps.equal(o.target.objs[o.selection[0][0]].objs[0],o.target.objs[o.selection[1][0]])){return OK}else{return Err("VALmustbeposneg")}},perform:function(o){return{beforemarks:[[0],[1]],result:PlusMinus(o.target.objs[o.selection[1][0]])}}};collapseAbsNeg={info:{name:"collapseAbsNeg",effect:"simplifying",example:"|-x|",tags:["absolute","negation"]},prints:{errors:["TARmustbeabsneg"]},target:{type:"absolute",validate:function(_arg){var n;n=_arg.target.objs[0];if(n.type==="negation"){return OK}else{return Err("TARmustbeabsnum",[0])}}},perform:function(_arg){var inner;inner=_arg.target.objs[0].objs[0];return{beforemarks:[[0,0]],aftermarks:[[0]],result:Abs(inner)}}};collapseAbsNum={info:{name:"collapseAbsNum",effect:"simplifying",example:"|7|",tags:["absolute","number"]},prints:{errors:["TARmustbeabsnum"]},target:{type:"absolute",validate:function(_arg){var n,_ref1;n=_arg.target.objs[0];if(n.type==="number"||(_ref1=n.val)==="pi"||_ref1==="i"){return OK}else{return Err("TARmustbeabsnum")}}},perform:function(_arg){var n;n=_arg.target.objs[0];return{beforemarks:[[0]],result:n}}};collapseAbsPow={info:{name:"collapseAbsPow",effect:"simplifying",example:"|x^y|",tags:["absolute","power"]},prints:{errors:["TARmustbeabspow"]},target:{type:"absolute",validate:function(_arg){var n;n=_arg.target.objs[0];if(n.type==="power"){return OK}else{return Err("TARmustbeabspow")}}},perform:function(_arg){var base,exp,_ref1;_ref1=_arg.target.objs[0].objs,base=_ref1[0],exp=_ref1[1];return{result:Pow(Abs(base),exp)}}};extractPosTermsFromAbsSum={info:{name:"extractPosTermsFromAbsSum",effect:"simplifying",example:{str:"|2+x+pi|",selection:[[0,2]]},tags:["absolute","sum"]},prints:{errors:["SELmustbepositive","TARmustbeabssum"],instructions:["SELpickpostermstoextract","DIRseltermside"]},target:{type:"absolute",validate:function(o){if(o.target.objs[0].type==="sum"){return OK}else{return Err("TARmustbeabssum")}}},selection:{instruction:"SELpickpostermstoextract",filter:function(o){if(o.deps.isPositive(o.item)){return OK}else{return Err("SELmustbepositive")}},from:[0],minleft:1},direction:"DIRseltermside",perform:function(_arg){var abs,deps,direction,extracted,item,list,n,objs,remaining,terms,_ref1,_ref2,_ref3,_ref4;direction=_arg.direction,deps=_arg.deps,_ref1=_arg.target,_ref2=_ref1.objs,_ref3=_ref2[0],objs=_ref3.objs,_ref4=_arg.selection,list=_ref4[0];remaining=function(){var _i,_len,_results;_results=[];for(n=_i=0,_len=objs.length;_i<_len;n=++_i){item=objs[n];if(!(__indexOf.call(list,n)>=0)){_results.push(item)}}return _results}();extracted=function(){var _i,_len,_results;_results=[];for(n=_i=0,_len=objs.length;_i<_len;n=++_i){item=objs[n];if(__indexOf.call(list,n)>=0){_results.push(item)}}return _results}();abs=Abs(deps.collapseStubList(Sum(remaining)));terms=direction==="right"?[abs].concat(extracted):extracted.concat(abs);return{result:Sum(terms),beforemarks:function(){var _i,_len,_results;_results=[];for(_i=0,_len=list.length;_i<_len;_i++){n=list[_i];_results.push([0,n])}return _results}(),aftermarks:function(){var _i,_ref5,_results;_results=[];for(n=_i=0,_ref5=list.length;0<=_ref5?_i<_ref5:_i>_ref5;n=0<=_ref5?++_i:--_i){_results.push([(direction==="right"?1:0)+n])}return _results}()}}};collapseAbsFrac={info:{name:"collapseAbsFrac",effect:"simplifying",example:"|x/y|",tags:["absolute","fraction"]},prints:{errors:["TARmustbeabsfrac"]},target:{type:"absolute",validate:function(_arg){var n;n=_arg.target.objs[0];if(n.type==="fraction"){return OK}else{return Err("TARmustbeabsfrac")}}},perform:function(_arg){var denom,numer,_ref1;_ref1=_arg.target.objs[0].objs,numer=_ref1[0],denom=_ref1[1];return{result:Frac(Abs(numer),Abs(denom))}}};collapseAbsPowWithNumBase={info:{name:"collapseAbsPowWithNumBase",effect:"simplifying",example:"|(-3)^x|",uses:["collapseAbsPow","collapseAbsNum","collapseAbsNeg"],tags:["absolute","power","number"]},prints:{errors:["TARmustbeabspow","TARmustbeabspownumbase"]},target:{type:"absolute",validate:function(_arg){var pow;pow=_arg.target.objs[0];if(pow.type!=="power"){return Err("TARmustbeabspow")}else if(!(pow.objs[0].type==="number"||pow.objs[0].type==="negation"&&pow.objs[0].objs[0].type==="number")){return Err("TARmustbeabspownumbase")}else{return OK}}},perform:function(o){o["do"]("collapseAbsPow","firstcollapseabspow");o.doIf("collapseAbsNeg","ifnegthendrop",{aim:[0]});return o["do"]("collapseAbsNum","thencollapseabsnumbase",{aim:[0]})}};collapseAbsProd={info:{name:"collapseAbsProd",effect:"simplifying",example:"|xyx|",tags:["product","absolute"]},prints:{errors:["TARmustbeabsprod"]},target:{type:"absolute",validate:function(_arg){var n;n=_arg.target.objs[0];if(n.type==="product"){return OK}else{return Err("TARmustbeabsprod")}}},perform:function(_arg){var fac,facs;facs=_arg.target.objs[0].objs;return{result:Prod(function(){var _i,_len,_results;_results=[];for(_i=0,_len=facs.length;_i<_len;_i++){fac=facs[_i];_results.push(Abs(fac))}return _results}())}}};plusMinusZeroToZero={info:{name:"plusMinusZeroToZero",effect:"simplifying",example:"+-0",tags:["number0","plusminus"],uses:["expandPlusMinusInRel","zeroFacExprToZero","purgeDuplicatesFromLogic"]},prints:{errors:["TARpartmustbezero"]},target:{type:"plusminus",validate:function(o){if(o.deps.equal(o.target.objs[0],zero)){return OK}else{return Err("TARpartmustbezero")}}},perform:function(o){o["do"]("expandPlusMinusInRel","firstexpand",{hunt:[[]]});o["do"]("zeroFacExprToZero","thennegzerotozero",{aim:[1],selection:[[0]],choices:["negchild"]});return o["do"]("purgeDuplicatesFromLogic","removedouble",{selection:[[0,1]]})}};expandPlusMinusInRel={info:{name:"expandPlusMinusInRel",effect:"simplifying",example:{str:"x=y+(+-7)",hunt:[[1,1]]},tags:["logic","logicor","relation","plusminus"]},auto:function(o){var findplusminus,whereisit;findplusminus=function(obj,path){var child,n,test,_i,_len,_ref1;if(obj.type==="plusminus"){return path}else if(obj.objs){_ref1=obj.objs;for(n=_i=0,_len=_ref1.length;_i<_len;n=++_i){child=_ref1[n];test=findplusminus(child,path.concat(n));if(test){return test}}return false}else{return false}};whereisit=findplusminus(o.target,[]);if(whereisit){return{hunt:[whereisit]}}else{return Err("AUTOnoplusminus")}},hunt:{filter:"plusminus"},perform:function(o){var path,plusminusobj;path=o.hunt[0];plusminusobj=o.deps.lookUp(o.target,path).objs[0];return{result:Or(o.deps.exchangeChild(o.target,plusminusobj,path),o.deps.exchangeChild(o.target,Neg(plusminusobj),path)),beforemarks:[o.hunt],aftermarks:[[0].concat(o.hunt),[1].concat(o.hunt)]}}};expandPlusMinusInOr={info:{name:"expandPlusMinusInRel",effect:"simplifying",example:{str:"a=b or x=y+(+-7)",selection:[[1]],hunt:[[1,1]]},tags:["logic","logicor","relation","plusminus"],uses:["expandPlusMinusInRel","absorbSubOrs"]},target:"OR",selection:{max:1},auto:function(o){var findplusminus,part,partpos,whereisit,_i,_len,_ref1;_ref1=o.target.objs;for(partpos=_i=0,_len=_ref1.length;_i<_len;partpos=++_i){part=_ref1[partpos];findplusminus=function(obj,path){var child,n,test,_j,_len1,_ref2;if(obj.type==="plusminus"){return path}else if(obj.objs){_ref2=obj.objs;for(n=_j=0,_len1=_ref2.length;_j<_len1;n=++_j){child=_ref2[n];test=findplusminus(child,path.concat(n));if(test){return test}}return false}else{return false}};whereisit=findplusminus(part,[]);if(whereisit){return{selection:[[partpos]],hunt:[whereisit]}}}return Err("AUTOnoplusminus")},hunt:{filter:"plusminus"},perform:function(o){var huntpath,pos;pos=o.selection[0][0];huntpath=o.hunt;o["do"]("expandPlusMinusInRel","okexpandit",{aim:[pos],hunt:huntpath});o["do"]("absorbSubOrs","andswallow",{selection:[[pos]]});o.beforemark([pos].concat(huntpath));return o.aftermark([[pos].concat(huntpath),[pos+1].concat(huntpath)])}};expandPlusMinusDirectlyInRel={info:{name:"expandPlusMinusDirectlyInRel",effect:"simplifying",example:{str:"x=(+-7)",selection:[[1]]},tags:["logic","logicor","relation","plusminus"]},target:{type:"relation"},selection:{instruction:"SELplusminus",filter:"plusminus",max:1},perform:function(o){var path,plusminusobj,r;path=o.selection[0];plusminusobj=o.deps.lookUp(o.target,path).objs[0];r=Or(o.deps.exchangeChild(o.target,plusminusobj,path),o.deps.exchangeChild(o.target,Neg(plusminusobj),path));return{result:r,beforemarks:[o.hunt],aftermarks:[[0].concat(o.hunt),[1].concat(o.hunt)]}}};absToPlusMinusInEq={info:{name:"absToPlusMinusInEq",effect:"simplifying",example:{str:"|x|=4",selection:[[0]]},tags:["relation","plusminus","absolute"]},target:{type:"relation",validate:function(o){var _ref1;if((_ref1=o.target.val)==="eq"||_ref1==="neq"){return OK}else{return Err("TARmustnenoncomb")}}},selection:{max:1,filter:"absolute"},perform:function(_arg){var left,right,side,val,_ref1,_ref2,_ref3,_ref4;_ref1=_arg.selection,_ref2=_ref1[0],side=_ref2[0],_ref3=_arg.target,val=_ref3.val,_ref4=_ref3.objs,left=_ref4[0],right=_ref4[1];return{result:side?{type:"relation",val:val,objs:[PlusMinus(left),right.objs[0]]}:{type:"relation",val:val,objs:[left.objs[0],PlusMinus(right)]},beforemarks:[[side,0]],aftermarks:[[side]]}}};expandAbsInComb={info:{name:"expandAbsInComb",effect:"simplifying",example:{str:"|x|<4",selection:[[0]]},tags:["relation","absolute"]},target:{type:"relation",validate:function(o){var _ref1;if((_ref1=o.target.val)==="lt"||_ref1==="leq"||_ref1==="gt"||_ref1==="geq"){return OK}else{return Err("TARmustbecomp")}}},selection:{max:1,filter:"absolute"},perform:function(_arg){var deps,left,r,right,side,val,_ref1,_ref2,_ref3,_ref4;deps=_arg.deps,_ref1=_arg.selection,_ref2=_ref1[0],side=_ref2[0],_ref3=_arg.target,val=_ref3.val,_ref4=_ref3.objs,left=_ref4[0],right=_ref4[1];r=side===0?val==="lt"||val==="leq"?And({type:"relation",val:val,objs:[left.objs[0],right]},flipRel({type:"relation",val:val,objs:[left.objs[0],Neg(right)]}),{type:"relation",val:val,objs:[zero,right]}):Or({type:"relation",val:val,objs:[left.objs[0],right]},flipRel({type:"relation",val:val,objs:[left.objs[0],Neg(right)]})):val==="gt"||val==="geq"?And({type:"relation",val:val,objs:[left,right.objs[0]]},flipRel({type:"relation",val:val,objs:[Neg(left),right.objs[0]]}),{type:"relation",val:val,objs:[left,zero]}):Or({type:"relation",val:val,objs:[left,right.objs[0]]},flipRel({type:"relation",val:val,objs:[Neg(left),right.objs[0]]}));return{result:r,beforemarks:[[side,0]],aftermarks:[[0,side],[1,side],[2,1]]}}};expandAbsPartInRelAndFix={info:{name:"expandAbsPartInRelAndFix",effect:"simplifying",example:{str:"|x|<4",selection:[[0]]},tags:["relation","absolute"],uses:["expandAbsInComb","absToPlusMinusInEq","numericRelToBool","purgeTrueFromAnd"]},target:"relation",selection:{max:1,filter:"absolute"},perform:function(o){var sel;sel=o.selection;o.doIf("absToPlusMinusInEq","expandabsineq",{selection:sel});o.doIf("expandAbsInComb","expandabsincomb",{selection:sel});o["try"]("numericRelToBool","fixzerocond",{aim:[2]});o.doIf("purgeTrueFromAnd","cleanfromzerocond",{selection:[[2]]});return o.doIf("andWithFalseIsFalse","thiswenttoshit",{selection:[[2]]})}};if(typeof exports==="undefined"){exportTo=this.CATS.math}else{exportTo=exports}funcs={expandPlusMinusInOr:expandPlusMinusInOr,expandAbsPartInRelAndFix:expandAbsPartInRelAndFix,expandAbsInComb:expandAbsInComb,expandPlusMinusDirectlyInRel:expandPlusMinusDirectlyInRel,absToPlusMinusInEq:absToPlusMinusInEq,killAbsInPlusMinus:killAbsInPlusMinus,posNegOrToPlusMinus:posNegOrToPlusMinus,extractPosTermsFromAbsSum:extractPosTermsFromAbsSum,collapseAbsNeg:collapseAbsNeg,expandPlusMinusInRel:expandPlusMinusInRel,expandAbsToIfElse:expandAbsToIfElse,plusMinusZeroToZero:plusMinusZeroToZero,collapseAbsFrac:collapseAbsFrac,collapseAbsPowWithNumBase:collapseAbsPowWithNumBase,collapseAbsPow:collapseAbsPow,collapseAbsProd:collapseAbsProd,collapseAbsNum:collapseAbsNum};for(k in funcs){v=funcs[k];exportTo[k]=v}}).call(this);
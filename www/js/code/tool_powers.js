(function(){var And,Eq,Err,FALSE,Frac,Fraction,Geq,Gt,Leq,Lt,Neg,Neq,Not,Num,OK,Or,Pow,Power,Prod,Product,Sum,TRUE,UNDEFINED,approxDecNumPow,approxNumPowFracWithSameExps,biProdBasePowToProd,biSumExpPowToProd,collapseSameInnerBaseFacNumerDenomPows,collapseSumBasePow,deepcopy,exportTo,extractBaseFraction,extractPartFromPow,five,flattenPow,four,fracOfPowsToPowOfFrac,funcs,getBase,getExp,getNumExp,isErr,k,makeCheck,mergeBiSameBasePowFacs,mergeSameBaseFacs,mergeSameBaseNumerDenomFacs,mixin,movePowInFrac,negExpFacProdToFrac,negOneBaseEvenFacExpPowToOne,negOneBaseOddFacExpPowToNegOne,negOneBaseTwoExpPowToOne,numericPowToNum,one,oneBasePowToOne,oneExpPowerToBase,oneNumerFracToNegExpPow,oneToZeroExpPower,powBasePowToFlatNiceExp,powBasePowToProdExp,printObj,prodExpPowToPowBase,prodExpPowToSelectPowBase,raiseByOne,sameBasePairer,sameExpFacProdToPow,splitNegBasePow,splitSumExpPow,three,transformPowOfFracAndSimplify,turnNumToPow,two,v,x,y,z,zero,zeroBaseExpPowToUndefined,zeroBasePowerToZero,zeroExpPowerToOne,zeroToPow,_ref,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};_ref=typeof require==="undefined"?this.CATS.math.toolhelpers:require("./toolhelpers"),isErr=_ref.isErr,UNDEFINED=_ref.UNDEFINED,deepcopy=_ref.deepcopy,mixin=_ref.mixin,Prod=_ref.Prod,Frac=_ref.Frac,Pow=_ref.Pow,Eq=_ref.Eq,Leq=_ref.Leq,Gt=_ref.Gt,Geq=_ref.Geq,Lt=_ref.Lt,Neq=_ref.Neq,four=_ref.four,five=_ref.five,And=_ref.And,Or=_ref.Or,Not=_ref.Not,TRUE=_ref.TRUE,FALSE=_ref.FALSE,makeCheck=_ref.makeCheck,x=_ref.x,y=_ref.y,z=_ref.z,Neg=_ref.Neg,Product=_ref.Product,Sum=_ref.Sum,Power=_ref.Power,Fraction=_ref.Fraction,Num=_ref.Num,zero=_ref.zero,one=_ref.one,two=_ref.two,three=_ref.three,Err=_ref.Err,OK=_ref.OK,printObj=_ref.printObj;getBase=function(obj){if(obj.type==="power"){return obj.objs[0]}else{return obj}};getExp=function(obj){if(obj.type==="power"){return obj.objs[1]}else{return one}};getNumExp=function(obj){if(obj.type==="power"&&obj.objs[1].type==="number"){return obj.objs[1]}else{return one}};sameBasePairer=function(_arg){var equal,getBase,getExp,obj1,obj2,_ref1;obj1=_arg.obj1,obj2=_arg.obj2,_ref1=_arg.deps,equal=_ref1.equal,getBase=_ref1.getBase,getExp=_ref1.getExp;if(!equal(getBase(obj1),one)&&equal(getBase(obj1),getBase(obj2))){return[obj1.type==="power"&&obj2.type==="power"?"samebase":"nonpowsamebase",[getExp(obj1),getExp(obj2)]]}else{return false}};approxNumPowFracWithSameExps={info:{name:"approxNumPowFracWithSameExps",effect:"decimalifying",example:"(1.4^3)/(2.04^3)",tags:["decimal","approximate","power","fraction"]},target:{type:"fraction",validate:function(_arg){var denom,deps,frac,numer,_ref1,_ref2;deps=_arg.deps,_ref1=_arg.target,_ref2=_ref1.objs,numer=_ref2[0],denom=_ref2[1];if(numer.type!=="power"){return Err("TARnumermustbepower",[0])}else if(denom.type!=="power"){return Err("TARdenommustbepower",[1])}else if(!deps.equal(numer.objs[1],denom.objs[1])){return Err("TARdiffexps")}else if(!(numer.objs[0].type==="number"&&numer.objs[1].type==="number")){return Err("TARnumerisntnumeric",[0])}else if(!(denom.objs[0].type==="number"&&denom.objs[1].type==="number")){return Err("TARdenomisntnumeric",[0])}else{frac=parseFloat(numer.objs[0])/parseFloat(denom.objs[0]);if(Math.pow(frac,parseFloat(numer.objs[1]>1e8))){return Err("TARvaltoohigh")}else{return OK}}}},perform:function(o){o["do"]("fracOfPowsToPowOfFrac","makepow");o["do"]("fracToDecNum","basetodec",{aim:[0]});return o["do"]("approxDecNumPow","nowdecwhole")}};approxDecNumPow={info:{name:"approxDecNumPow",effect:"decimalifying",example:"2.4^4.01",tags:["approximate","decimal","power"],lesson:"decimalnums"},target:{type:"power",validate:function(o){var base,basedec,baseval,exp,expdec,expval,_ref1;_ref1=o.target.objs,base=_ref1[0],exp=_ref1[1];if(!(base.type==="number")){return Err("TARbasemustbenum",[0])}else if(!(exp.type==="number")){return Err("TARexpmustbenum",[1])}else{baseval=parseFloat(base.val);expval=parseFloat(exp.val);basedec=base.type==="number"&&baseval!==Math.floor(baseval);expdec=exp.type==="number"&&expval!==Math.floor(expval);if(!(basedec||expdec)){return Err("TARbaseorexpmustbedec")}else{if(Math.pow(baseval,expval)>1e8){return Err("TARvaltoohigh")}else{return OK}}}}},perform:function(_arg){var b,baseval,e,expval,res,_ref1,_ref2,_ref3;_ref1=_arg.target.objs,_ref2=_ref1[0],baseval=_ref2.val,_ref3=_ref1[1],expval=_ref3.val;b=parseFloat(baseval);e=parseFloat(expval);res=Math.pow(b,e);return{result:Num(res),approx:((""+res).split(".")[1]||"").length>10}}};oneExpPowerToBase={info:{name:"oneExpPowerToBase",effect:"simplifying",opposite:"raiseByOne",example:"x^1",tags:["power","number1","remove"],lesson:"power101"},prints:{errors:["expmustbeone"]},target:{type:"power",validate:function(_arg){var base,deps,exp,_ref1,_ref2;deps=_arg.deps,_ref1=_arg.target,_ref2=_ref1.objs,base=_ref2[0],exp=_ref2[1];if(!deps.equal(exp,one)){return Err("expmustbeone",[1])}else{return OK}}},perform:function(_arg){var target;target=_arg.target;return{result:target.objs[0],beforemarks:[[1]]}}};powBasePowToProdExp={info:{name:"powBasePowToProdExp",effect:"simplifying",example:"(x^y)^z",tags:["power","powerbase","productexponent"],lesson:"power101",opposite:"prodExpPowToPowBase"},prints:{errors:["basemustbepow"]},target:{type:"power",validate:function(_arg){var base;base=_arg.target.objs[0];if(base.type==="power"){return OK}else{return Err("basemustbepow",[0])}}},perform:function(_arg){var basebase,baseexp,exp,_ref1,_ref2,_ref3;_ref1=_arg.target.objs,_ref2=_ref1[0],_ref3=_ref2.objs,basebase=_ref3[0],baseexp=_ref3[1],exp=_ref1[1];return{result:Power(basebase,Product(baseexp,exp)),beforemarks:[[0,1],[1]],aftermarks:[[1,0],[1,1]]}}};mergeBiSameBasePowFacs={info:{name:"mergeBiSameBasePowFacs",effect:"simplifying",example:"(x^2)*x^3",tags:["power","product"],lesson:"power101",opposite:"biSumExpPowToProd"},prints:{errors:["mustbebiprod","facsmustbesamebasepows"]},target:{type:"product",validate:function(o){var deps,first,second,third,_ref1,_ref2;deps=o.deps,_ref1=o.target,_ref2=_ref1.objs,first=_ref2[0],second=_ref2[1],third=_ref2[2];if(third){return Err("mustbebiprod")}else if(first.type!=="power"||second.type!=="power"){return Err("facsmustbesamebasepows")}else if(!deps.equal(first.objs[0],second.objs[0])){return Err("facsmustbesamebasepows")}else{return OK}}},perform:function(_arg){var firstbase,firstexp,secondbase,secondexp,_ref1,_ref2,_ref3,_ref4,_ref5;_ref1=_arg.target.objs,_ref2=_ref1[0],_ref3=_ref2.objs,firstbase=_ref3[0],firstexp=_ref3[1],_ref4=_ref1[1],_ref5=_ref4.objs,secondbase=_ref5[0],secondexp=_ref5[1];return{result:Power(firstbase,Sum(firstexp,secondexp)),beforemarks:[[0,1],[1,1]],aftermarks:[[1,0],[1,1]]}}};biProdBasePowToProd={info:{name:"biProdBasePowToProd",effect:"simplifying",example:"(x*y)^z",tags:["power","productbase"],lesson:"power101",opposite:"sameExpFacProdToPow"},prints:{errors:["basemustbebiprod"]},target:{type:"power",validate:function(_arg){var base,deps,exp,_ref1,_ref2;deps=_arg.deps,_ref1=_arg.target,_ref2=_ref1.objs,base=_ref2[0],exp=_ref2[1];if(!(base.type==="product")){return Err("basemustbebiprod",[0])}else{return OK}}},perform:function(_arg){var exp,fac,facs,_ref1,_ref2;_ref1=_arg.target.objs,_ref2=_ref1[0],facs=_ref2.objs,exp=_ref1[1];return{result:Prod(function(){var _i,_len,_results;_results=[];for(_i=0,_len=facs.length;_i<_len;_i++){fac=facs[_i];_results.push(Pow(fac,exp))}return _results}()),beforemarks:[[0,0],[0,1]],aftermarks:[[0,0],[1,0]]}}};oneBasePowToOne={info:{name:"oneBasePowToOne",effect:"simplifying",example:"1^x",tags:["power","number1","remove"],lesson:"power101"},prints:{errors:["basemustbeone"]},target:{type:"power",validate:function(_arg){var base,deps,exp,_ref1,_ref2;deps=_arg.deps,_ref1=_arg.target,_ref2=_ref1.objs,base=_ref2[0],exp=_ref2[1];if(!deps.equal(base,one)){return Err("basemustbeone",[0])}else{return OK}}},perform:function(o){return{result:one,beforemarks:[[0]]}}};sameExpFacProdToPow={info:{name:"sameExpFacProdToPow",effect:"complicating",opposite:"biProdBasePowToProd",example:"(x^z)*(y^z)",lesson:"power101",tags:["power"]},target:{type:"product",validate:function(_arg){var compto,deps,fac,facs,n,_i,_len,_ref1;deps=_arg.deps,_ref1=_arg.target,facs=_ref1.objs;compto=null;for(n=_i=0,_len=facs.length;_i<_len;n=++_i){fac=facs[n];if(fac.type!=="power"){return Err("TARmustbepowfacs")}if(!n){compto=fac.objs[1]}else if(!deps.equal(compto,fac.objs[1])){return Err("TARnotallexpssame")}}return OK}},perform:function(o){var fac;return{result:Pow(Prod(function(){var _i,_len,_ref1,_results;_ref1=o.target.objs;_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){fac=_ref1[_i];_results.push(fac.objs[0])}return _results}()),o.target.objs[0].objs[1])}}};raiseByOne={info:{name:"raiseByOne",effect:"complicating",opposite:"oneExpPowerToBase",example:"x",tags:["power","number1","introduce"],lesson:"power101"},target:"math",perform:function(_arg){var target;target=_arg.target;return{result:Power(target,Num(1)),aftermarks:[[1]]}}};biSumExpPowToProd={info:{name:"biSumExpPowToProd",effect:"complicating",example:"x^(y+z)",tags:["power","sumexponent"],lesson:"power101",opposite:"mergeBiSameBasePowFacs"},prints:{errors:["expmustbebisum"]},target:{type:"power",validate:function(_arg){var base,exp,_ref1;_ref1=_arg.target.objs,base=_ref1[0],exp=_ref1[1];if(exp.type!=="sum"||exp.objs.length!==2){return Err("expmustbebisum",[1])}else{return OK}}},perform:function(_arg){var base,target,term1,term2,_ref1,_ref2,_ref3;target=_arg.target;_ref1=target.objs,base=_ref1[0],_ref2=_ref1[1],_ref3=_ref2.objs,term1=_ref3[0],term2=_ref3[1];return{result:Product(Power(base,term1),Power(base,term2)),beforemarks:[[1,0],[1,1]],aftermarks:[[0,1],[1,1]]}}};prodExpPowToPowBase={info:{name:"prodExpPowToPowBase",effect:"complicating",example:{str:"x^(y*z)",selection:[[1]]},opposite:"powBasePowToProdExp",tags:["power","productexponent"],lesson:"power101"},prints:{errors:["expmustbebiprod"],instructions:["selecttopexp"]},target:{type:"power",validate:function(_arg){var base,exp,_ref1;_ref1=_arg.target.objs,base=_ref1[0],exp=_ref1[1];if(exp.type!=="product"||exp.objs.length!==2){return Err("expmustbebiprod",[1])}else{return OK}}},selection:{from:[1],max:1,instruction:"selecttopexp"},perform:function(_arg){var base,firstexpfac,pos,secondexpfac,target,_ref1,_ref2,_ref3,_ref4,_ref5;_ref1=_arg.selection,_ref2=_ref1[0],pos=_ref2[0],target=_arg.target;_ref3=target.objs,base=_ref3[0],_ref4=_ref3[1],_ref5=_ref4.objs,firstexpfac=_ref5[0],secondexpfac=_ref5[1];return{result:Power(Power(base,pos===0?secondexpfac:firstexpfac),pos===1?secondexpfac:firstexpfac),beforemarks:[[1,pos]],aftermarks:[[1]]}}};splitSumExpPow={info:{name:"splitSumExpPow",effect:"complicating",example:{str:"x^(a+b+c+d",selection:[[0,2]]},uses:["rearrangeTerms","splitTermsToSum","biSumExpPowToProd"],tags:["power","sumexponent"],lesson:"power102"},prints:{errors:["expmustbesum"],steps:["groupselexpterms","groupothers","rearrangefordir","splitpower"],instructions:["choosesideforpow"]},target:{type:"power",validate:function(_arg){var base,exp,_ref1;_ref1=_arg.target.objs,base=_ref1[0],exp=_ref1[1];if(exp.type==="sum"){return OK}else{return Err("expmustbesum",[1])}}},selection:{minleft:1,from:[1]},direction:"choosesideforpow",perform:function(o){var s,sel,_i,_ref1,_results;sel=o.selection[0];if(sel.length>1){o["do"]("splitTermsToSum","groupselexpterms",{aim:[1]})}if(o.target.objs[1].objs.length>2){o["do"]("splitTermsToSum","groupothers",{aim:[1],selection:[function(){_results=[];for(var _i=0,_ref1=o.target.objs[1].objs.length;0<=_ref1?_i<_ref1:_i>_ref1;0<=_ref1?_i++:_i--){_results.push(_i)}return _results}.apply(this).filter(function(n){return n!==sel[0]})]})}if(sel[0]===0&&o.direction==="right"||sel[0]===1&&o.direction!=="right"){o["do"]("rearrangeTerms","rearrangefordir",{aim:[1],rearrange:[o.target.objs[1].objs[1],o.target.objs[1].objs[0]]})}o["do"]("biSumExpPowToProd","splitpower");o.beforemark(function(){var _j,_len,_results1;_results1=[];for(_j=0,_len=sel.length;_j<_len;_j++){s=sel[_j];_results1.push([1,s])}return _results1}());return o.aftermark([[o.dirnum()]])}};mergeSameBaseFacs={info:{name:"mergeSameBaseFacs",effect:"simplifying",example:{str:"x*y*x2",selection:[[0,2]]},uses:["collapseTwoNegFacs","expandNegFacs","raiseByOne","splitFacsToProduct","mergeBiSameBasePowFacs","absorbSumTerms","collapseNegOneFac","mergeAllIntegerTerms"],tags:["product","powerfactor","power"],lesson:"power102"},prints:{errors:["musthavesamebasefacs"],steps:["fixdoubleneg","freefacfromnegation","turnfactopow","groupfacpair","mergefacpair","mergefacpaircollapseprod","flattensumexp","putnegationback","mergeallnumericexps"]},target:"product",selection:{min:2},auto:function(o){var compbase,compfac,comppos,otherfac,otherpos,same,_i,_j,_len,_len1,_ref1,_ref2;_ref1=o.target.objs;for(comppos=_i=0,_len=_ref1.length;_i<_len;comppos=++_i){compfac=_ref1[comppos];same=[comppos];compbase=o.deps.getBase(compfac.type==="negation"?compfac.objs[0]:compfac);_ref2=o.target.objs;for(otherpos=_j=0,_len1=_ref2.length;_j<_len1;otherpos=++_j){otherfac=_ref2[otherpos];if(otherpos!==comppos){if(o.deps.equal(compbase,o.deps.getBase(otherfac.type==="negation"?otherfac.objs[0]:otherfac))){same.push(otherpos)}}}if(same.length>1){return{selection:[same.sort(function(a,b){if(a>b){return 1}else{return-1}})]}}}return Err("musthavesamebasefacs")},perform:function(o){var exppath,firstpos,firstwasneg,n,objpath,pos,pospath,prepath,s,secondpos,secondwasneg,sel,times,_i,_j,_k,_len,_len1,_ref1,_ref2;sel=o.selection[0].sort(function(a,b){if(a>b){return 1}else{return-1}});for(_i=0,_len=sel.length;_i<_len;_i++){s=sel[_i];o.beforemark([s])}times=0;for(n=_j=_ref1=sel.length-1;_ref1<=1?_j<=1:_j>=1;n=_ref1<=1?++_j:--_j){firstpos=sel[n-1];secondpos=sel[n];firstwasneg=secondwasneg=false;o.doIf("collapseTwoNegFacs","fixdoubleneg",{selection:[[firstpos,secondpos]]});if(o.target.objs[firstpos].type==="negation"){o["do"]("expandNegFacs","freefacfromnegation",{selection:[[firstpos]],direction:"right"});secondpos++;firstwasneg=true}if(o.target.objs[secondpos].type==="negation"){o["do"]("expandNegFacs","freefacfromnegation",{selection:[[secondpos]],direction:"right"});secondwasneg=true}_ref2=[firstpos,secondpos];for(_k=0,_len1=_ref2.length;_k<_len1;_k++){pos=_ref2[_k];if(o.target.objs[pos].type!=="power"){o["do"]("raiseByOne","turnfactopow",{aim:[pos]})}}if(o.target.objs.length>2){o["do"]("splitFacsToProduct","groupfacpair",{selection:[[firstpos,secondpos]]});o["do"]("mergeBiSameBasePowFacs","mergefacpair",{aim:[firstpos]})}else{o["do"]("mergeBiSameBasePowFacs","mergefacpaircollapseprod")}if(times++){o["do"]("absorbSumTerms","flattensumexp",{selection:[[1]],aim:(o.target.type==="product"?[firstpos]:[]).concat(1)})}if(secondwasneg){o["do"]("collapseNegOneFac","putnegationback",{selection:firstwasneg?[[secondpos+1],[firstpos]]:[[secondpos],[firstpos]]})}if(firstwasneg){o["do"]("collapseNegOneFac","putnegationback",{selection:[[firstpos+1],[firstpos]]})}}prepath=o.target.type==="negation"?[0]:[];if(o.deps.lookUp(o.target,prepath).type==="product"){pospath=[firstpos];o.aftermark(prepath.concat(pospath))}else{pospath=[]}objpath=o.deps.lookUp(o.target,prepath.concat(pospath)).type==="negation"?[0]:[];exppath=prepath.concat(pospath.concat(objpath.concat([1])));return o["try"]("mergeAllIntegerTerms","mergeallnumericexps",exppath)}};prodExpPowToSelectPowBase={info:{name:"prodExpPowToSelectPowBase",effect:"complicating",example:{str:"x^(a*b*c*d)",selection:[[1,3]]},uses:["splitFacsToProduct","prodExpPowToPowBase"],tags:["power","productexponent"],lesson:"power101"},prints:{errors:["expmustbeprod"],instructions:["selecttopexpfacs"],steps:["groupselectedfacs","groupresiduefacs","nowwemakepowbase"]},target:{type:"power",validate:function(_arg){var base,exp,_ref1;_ref1=_arg.target.objs,base=_ref1[0],exp=_ref1[1];if(exp.type!=="product"){return Err("expmustbeprod",[1])}else{return OK}}},selection:{from:[1],minleft:1,instruction:"selecttopexpfacs"},perform:function(o){var numexpfacs,s,sels,_i,_j,_len,_results;sels=o.selection[0];for(_i=0,_len=sels.length;_i<_len;_i++){s=sels[_i];o.beforemark([1,s])}if(sels.length>1){o["do"]("splitFacsToProduct","groupselectedfacs",{aim:[1],selection:[sels]})}numexpfacs=o.target.objs[1].objs.length;if(numexpfacs>2){o["do"]("splitFacsToProduct","groupresiduefacs",{aim:[1],selection:[function(){_results=[];for(var _j=0;0<=numexpfacs?_j<numexpfacs:_j>numexpfacs;0<=numexpfacs?_j++:_j--){_results.push(_j)}return _results}.apply(this).filter(function(i){return __indexOf.call(sels,i)<0})]})}o["do"]("prodExpPowToPowBase","nowwemakepowbase",{selection:[[sels[0]]]});return o.aftermark([[1]])}};transformPowOfFracAndSimplify={info:{name:"transformPowOfFracAndSimplify",effect:"simplifying",example:"(3/x)2",uses:["extractBaseFraction","oneBasePowToOne","numericPowToNum","powBasePowToFlatNiceExp","splitNegBasePow"],tags:["power","fractionbase"],lesson:"power103"},target:{type:"power",validate:function(_arg){var deps,exp,frac,op,pow,rad,result,_i,_j,_len,_len1,_ref1,_ref2,_ref3,_ref4;deps=_arg.deps,_ref1=_arg.target,_ref2=_ref1.objs,frac=_ref2[0],exp=_ref2[1];if(frac.type!=="fraction"){return Err("TARmustbepowoffrac")}else{_ref3=frac.objs;for(_i=0,_len=_ref3.length;_i<_len;_i++){rad=_ref3[_i];pow=Pow(rad,exp);_ref4=["oneBasePowToOne","numericPowToNum","powBasePowToFlatNiceExp","splitNegBasePow"];for(_j=0,_len1=_ref4.length;_j<_len1;_j++){op=_ref4[_j];result=deps.generateOpInputForTarget({deps:deps,tool:deps[op],target:pow});if(!isErr(result)){return OK}}}return Err("TARcannotsimplify")}}},perform:function(o){var floor,n,op,_i,_j,_len,_len1,_ref1,_ref2;o["do"]("extractBaseFraction","firstmakeintofrac");_ref1=["numer","denom"];for(n=_i=0,_len=_ref1.length;_i<_len;n=++_i){floor=_ref1[n];_ref2=["oneBasePowToOne","splitNegBasePow","numericPowToNum","powBasePowToFlatNiceExp"];for(_j=0,_len1=_ref2.length;_j<_len1;_j++){op=_ref2[_j];o["try"](op,"nowwesimplify"+floor,{aim:[n]})}}return o}};zeroExpPowerToOne={info:{name:"zeroExpPowerToOne",effect:"simplifying",example:"x^0",uses:["numToSum","biSumExpPowToProd","negExpFacProdToFrac","sameNumerDenomFracToOne"],tags:["number1","number0","power","collapse","exponent"],opposite:"oneToZeroExpPower",lesson:"power103"},prints:{errors:["expmustbezero"]},target:{type:"power",validate:function(_arg){var base,deps,exp,_ref1,_ref2;deps=_arg.deps,_ref1=_arg.target,_ref2=_ref1.objs,base=_ref2[0],exp=_ref2[1];if(!deps.equal(exp,zero)){return Err("expmustbezero",[1])}else{return OK}}},perform:function(o){o["do"]("numToSum","turnzeroexpto1minus1",{aim:[1],argument:Sum(one,Neg(one))});o["do"]("biSumExpPowToProd","splitpow");o["do"]("oneExpPowerToBase","dropexp1",{aim:[0]});o["do"]("negExpFacProdToFrac","movetodenom",{selection:[[1]]});o["do"]("sameNumerDenomFracToOne","andcollapsefracto1");return o.beforemark([[1]])}};zeroBaseExpPowToUndefined={info:{name:"zeroBaseExpPowToUndefined",effect:"integrity",example:"0^0",uses:["divideByOne","oneToZeroExpPower","zeroBasePowerToZero","zeroDenomFracToUndef"],tags:["power","undefinedval","number0"],lesson:"power103"},prints:{errors:["basemustbezero","expmustbezero"],steps:["introducedenom1","turn1tozerobaseexppow","andthatpowtozero","fracisnowundef"]},target:{type:"power",validate:function(_arg){var base,deps,exp,_ref1,_ref2;deps=_arg.deps,_ref1=_arg.target,_ref2=_ref1.objs,base=_ref2[0],exp=_ref2[1];if(!deps.equal(base,zero)){return Err("basemustbezero",[0])}else if(!deps.equal(exp,zero)){return Err("expmustbezero",[1])}else{return OK}}},perform:function(o){o["do"]("divideByOne","introducedenom1");o["do"]("oneToZeroExpPower","turn1tozerobaseexppow",{aim:[1],argument:zero});o["do"]("zeroBasePowerToZero","andthatpowtozero",{aim:[1]});o["do"]("zeroDenomFracToUndef","fracisnowundef");o.beforemark([[0],[1]]);return o}};numericPowToNum={info:{name:"numericPowToNum",effect:"simplifying",example:"3^4",uses:["flattenPow","multiplyNumFacs"],tags:["power","multiplication","naturalnum","factorise","split"],opposite:"turnNumToPow",lesson:"power102"},prints:{errors:["TARbasemustbeintegerover1","TARexpmustbeinteger2_15","TARvaluetoohigh"],steps:["firstflattenpowtoprod","thenmultiplyall"]},target:{type:"power",validate:function(o){var base,exp,_ref1;_ref1=o.target.objs,base=_ref1[0],exp=_ref1[1];if(base.type!=="number"){return Err("TARbasemustbeintegerover1",[0])}else if(exp.type!=="number"||parseFloat(exp.val)!==parseInt(exp.val)||2>parseInt(exp.val)||15<parseInt(exp.val)){return Err("TARexpmustbeinteger2_15",[1])}else if(Math.pow(parseInt(base.val),parseInt(exp.val))>1e8){return Err("TARvaluetoohigh")}else{return OK}}},perform:function(o){o["do"]("flattenPow","firstflattenpowtoprod");return o["try"]("multiplyNumFacs","thenmultiplyall")}};zeroBasePowerToZero={info:{name:"zeroBasePowerToZero",effect:"simplifying",example:"0^x",uses:["extractPartFromPow","zeroFacProdToZero"],tags:["number0","power","remove"],opposite:"zeroToPow",lesson:"power102"},prints:{errors:["basemustbezero"],steps:["extractazero","prodtozero"]},target:{type:"power",validate:function(_arg){var base,deps,_ref1,_ref2;deps=_arg.deps,_ref1=_arg.target,_ref2=_ref1.objs,base=_ref2[0];if(!deps.equal(base,zero)){return Err("basemustbezero",[0])}else{return OK}}},perform:function(o){o["do"]("extractPartFromPow","extractazero",{argument:one,direction:"left"});return o["do"]("zeroFacProdToZero","prodtozero",{selection:[[0]]})}};mergeSameBaseNumerDenomFacs={info:{name:"mergeSameBaseNumerDenomFacs",effect:"simplifying",example:{str:"(2*x^3)/(x^2",selection:[[1],[0]],choices:["facs","self","numer"]},uses:["numToSum","biSumExpPowToProd","raiseByOne","zeroToMirroredExpression","addMirroredNumber","addMirroredExpression","splitSumExpPow","absorbProductFacs","eliminateFromFrac","oneExpPowerToBase"],tags:["power","fraction","merge"],lesson:"power103"},prints:{errors:["mustcontainsamebasefacs","mustselectsamebase"],instructions:["mergetowhichfloor","choosenumerfactactic","choosedenomfactactic"],steps:["maketopower","splitkeeppowexp","splitkeeppow","absorbsplitpow","eliminatesamepows","smoothoverexponent","collapseexpone"]},target:"fraction",choices:[{instruction:"choosenumerfactactic",options:function(o){return o.deps.getFacOptions(o.target.objs[0])}},{instruction:"choosedenomfactactic",options:function(o){return o.deps.getFacOptions(o.target.objs[1])}},{instruction:"mergetowhichfloor",options:["numer","denom"]}],selection:{max:1,questions:function(o){return[{options:o.deps.getFacs(o.target.objs[0],o.choices[0])},{options:o.deps.getFacs(o.target.objs[1],o.choices[1])}]}},validate:function(o){var firstbase,secondbase;firstbase=o.deps.getBase(o.deps.getFacs(o.target.objs[0],o.choices[0])[o.selection[0][0]]);secondbase=o.deps.getBase(o.deps.getFacs(o.target.objs[1],o.choices[1])[o.selection[1][0]]);if(!o.deps.equal(firstbase,secondbase)){return Err("mustselectsamebase")}else{return OK}},auto:function(o){var chosen,denomexp,keep,numerexp,res,_ref1,_ref2,_ref3;res=o.deps.findFracFacPairs(mixin({pairer:o.deps.sameBasePairer},o));chosen=((_ref1=res.samebase)!=null?_ref1[0]:void 0)||((_ref2=res.nonpowsamebase)!=null?_ref2[0]:void 0);if(chosen){_ref3=chosen[3],numerexp=_ref3[0],denomexp=_ref3[1];keep=o.deps.isNumeric(numerexp)&&o.deps.isNumeric(denomexp)&&o.deps.numberValue(denomexp)>o.deps.numberValue(numerexp)?"denom":"numer";return{selection:[[chosen[1]],[chosen[2]]],choices:chosen[0].concat(keep)}}else{return Err("mustcontainsamebasefacs")}},perform:function(o){var choice,choices,destroy,destroyisnumber,floor,info,keep,keepisnumber,keepiszero,newval,path,respath,respow,sel,sels,tool,_i,_len,_ref1,_ref2;info=[{},{}];sels=o.selection;choices=o.choices;_ref1=choices[2]==="denom"?[1,0]:[0,1],keep=_ref1[0],destroy=_ref1[1];_ref2=[0,1];for(_i=0,_len=_ref2.length;_i<_len;_i++){floor=_ref2[_i];choice=choices[floor];sel=sels[floor][0];path=[floor].concat(o.deps.facPath(choice,sel));o.beforemark(path);if(floor===keep){if(choice==="self"){choices[floor]="facs"}if(choice==="negchild"){choices[floor]="negchildfacs"}}if(o.deps.lookUp(o.target,path).type!=="power"){o["do"]("raiseByOne","maketopower",{aim:path})}info[floor]={sel:sel,path:path,exp:deepcopy(o.deps.lookUp(o.target,path).objs[1]),wasprod:o.deps.lookUp(o.target,path.slice(0,-1)).type==="product"}}destroyisnumber=o.deps.isNumeric(info[destroy].exp);keepiszero=o.deps.equal(info[keep].exp,zero);keepisnumber=o.deps.isNumeric(info[keep].exp);if(keepisnumber&&destroyisnumber){newval=o.deps.numberValue(info[keep].exp)-o.deps.numberValue(info[destroy].exp);o["do"]("numToSum","splitkeeppowexp",{aim:info[keep].path.concat([1]),argument:Sum(info[destroy].exp,newval<0?Neg(Num(-1*newval)):Num(newval))});o["do"]("biSumExpPowToProd","splitkeeppow",{aim:info[keep].path})}else{tool=keepiszero?"zeroToMirroredExpression":destroyisnumber?"addMirroredNumber":"addMirroredExpression";o["do"](tool,"splitkeeppowexp",{aim:info[keep].path.concat([1]),argument:info[destroy].exp,direction:"right"});if(keepiszero){o["do"]("biSumExpPowToProd","splitkeeppow",{aim:info[keep].path})}else{o["do"]("splitSumExpPow","splitkeeppow",{aim:info[keep].path,selection:[[1]],direction:"left"})}}if(info[keep].wasprod){o["do"]("absorbProductFacs","absorbsplitpow",{aim:info[keep].path.slice(0,-1),selection:[[info[keep].sel]]})}o["do"]("eliminateFromFrac","eliminatesamepows",{selection:[[info[0].sel],[info[1].sel]],choices:choices.slice(0,2)});if(o.target.type==="fraction"){respath=info[keep].path;o.aftermark(respath)}else if(o.target.type==="product"){respath=info[keep].path.slice(1);o.aftermark(respath)}else{respath=[]}respow=o.deps.lookUp(o.target,respath);o["try"]("oneExpPowerToBase","collapseexpone",{aim:respath});return o}};movePowInFrac={info:{name:"movePowInFrac",effect:"condsimpl",example:{str:"y/(x^-2)",selection:[[0]],choices:["denom","self"]},tags:["power","fraction"],uses:["multiplyByOne","oneToZeroExpPower","absorbProductFacs","mergeSameBaseNumerDenomFacs"],lesson:"power103"},target:"fraction",prints:{errors:["SELmustbepow","AUTOnonegexppows"],instructions:["CHOfloorfactactic","CHOfloor","SELpowtomove"],steps:[]},choices:{questions:[{instruction:"CHOfloor",options:["numer","denom"]},{instruction:"CHOfloorfactactic",options:function(o){return o.deps.getFacOptions(o.target.objs[o.choices[0]==="numer"?0:1])}}]},selection:{instruction:"SELpowtomove",max:1,from:function(o){return o.deps.getFacs(o.target.objs[o.choices[0]==="numer"?0:1],o.choices[1])},filter:function(o){if(o.item.type!=="power"){return Err("SELmustbepow")}else{return OK}}},auto:function(o){var f,fac,floor,opt,pos,_i,_j,_k,_len,_len1,_len2,_ref1,_ref2,_ref3;_ref1=o.target.objs;for(f=_i=0,_len=_ref1.length;_i<_len;f=++_i){floor=_ref1[f];_ref2=o.deps.getFacOptions(floor);for(_j=0,_len1=_ref2.length;_j<_len1;_j++){opt=_ref2[_j];_ref3=o.deps.getFacs(floor,opt);for(pos=_k=0,_len2=_ref3.length;_k<_len2;pos=++_k){fac=_ref3[pos];if(fac.type==="power"&&fac.objs[1].type==="negation"){return{selection:[[pos]],choices:[["numer","denom"][f],opt]}}}}}return Err("AUTOnonegexppows")},direction:{instruction:"DIRsidetomoveto"},perform:function(o){var choices,dir,factactic,floor,newpath,path,pow,sel,selection,sourcefloor,targetfloor,targetpos,targetwasone,wasprod,_ref1,_ref2;wasprod=[o.target.objs[0].type==="product",o.target.objs[1].type==="product"];sel=o.selection[0][0];_ref1=o.choices,floor=_ref1[0],factactic=_ref1[1];dir=o.direction;_ref2=floor==="numer"?[0,1]:[1,0],sourcefloor=_ref2[0],targetfloor=_ref2[1];path=[sourcefloor].concat(o.deps.facPath(factactic,sel));o.beforemark(path);pow=o.deps.lookUp(o.target,path);if(!o.deps.equal(o.target.objs[targetfloor],one)){o["do"]("multiplyByOne","multonetoform",{aim:[targetfloor],direction:dir});if(wasprod[targetfloor]){o["do"]("absorbProductFacs","flatten",{aim:[targetfloor],selection:[[dir==="right"?0:1]]})}targetpos=dir==="right"?o.target[targetfloor].objs.length-1:0;newpath=[targetfloor,targetpos]}else{newpath=[targetfloor];targetpos=0;targetwasone=true}o["do"]("oneToZeroExpPower","expandonetopow"+(targetwasone?"existing":""),{aim:newpath,argument:pow.objs[0]});choices=sourcefloor===1?[targetwasone?"self":"facs",factactic]:[factactic,targetwasone?"self":"facs"];choices=choices.concat(floor==="denom"?"numer":"denom");selection=sourcefloor===1?[[targetpos],[sel]]:[[sel],[targetpos]];o.report("what up now?!",choices,targetpos,selection);o["do"]("mergeSameBaseNumerDenomFacs","mergepows",{selection:selection,choices:choices});switch(o.target.type){case"fraction":o.aftermark([newpath]);break;case"product":o.aftermark([targetpos])}return o}};negOneBaseTwoExpPowToOne={info:{name:"negOneBaseTwoExpPowToOne",effect:"simplifying",example:"(-1)^2",tags:["number1","neg1","exponent2","power"],uses:["extractPartFromPow","twoNegOneFacProdToOne"],lesson:"power102"},prints:{errors:["basemustbenegone","expmustbetwo"],steps:["splittoprod","collapsefreednegonebases"]},target:{type:"power",validate:function(o){if(!o.deps.equal(o.target.objs[0],Neg(one))){return Err("basemustbenegone",[0])}else if(!o.deps.equal(o.target.objs[1],two)){return Err("expmustbetwo",[1])}else{return OK}}},perform:function(o){o["do"]("extractPartFromPow","splittoprod",{argument:one});return o["do"]("twoNegOneFacProdToOne","collapsefreednegonebases")}};collapseSameInnerBaseFacNumerDenomPows={info:{name:"collapseSameInnerBaseFacNumerDenomPows",effect:"simplifying",example:{str:"24^3/8^2",argument:two,choices:["self","self","numer"],selection:[[0],[0]]},uses:["numToProd","mergeSameBaseFacs","biProdBasePowToProd","powBasePowToFlatNiceExp","absorbProductFacs","eliminateFromFrac","mergeSameBaseNumerDenomFacs"],tags:["power","fraction"],lesson:"power103"},prints:{errors:["mustbenumbase","nopowswithcommoninnernumfac","mustselectwithcommoninnerbasefacs"],instructions:["enterinnerfactoeliminate","choosenumerfactactic","choosedenomfactactic"],steps:["mergefoundfacsintopower","factorisingbasetoexposearg","splittingpowertofreearg","collapsefreedfacpowerexp","includingsplitpowinprod","nowwemergethepowers"]},target:"fraction",auto:function(o){var arg,argfacs,chosen,denom,denomexp,keep,numer,numerexp,res,_ref1,_ref2;res=o.deps.findFracFacPairs(mixin({pairer:o.deps.commonPosBaseNumFacPairer},o));chosen=((_ref1=res.contained)!=null?_ref1[0]:void 0)||((_ref2=res.inner)!=null?_ref2[0]:void 0);if(chosen){numer=o.deps.lookUp(o.target,[0].concat(o.deps.facPath(chosen[0][0],chosen[1])));denom=o.deps.lookUp(o.target,[1].concat(o.deps.facPath(chosen[0][1],chosen[2])));numerexp=numer.type==="power"?numer.objs[1]:one;denomexp=denom.type==="power"?denom.objs[1]:one;keep=o.deps.isNumeric(numerexp)&&o.deps.isNumeric(denomexp)&&o.deps.numberValue(numerexp)<o.deps.numberValue(denomexp)?"denom":"numer";arg=chosen[3];argfacs=o.deps.factoriseNumber(arg);if(argfacs.slice(1).filter(function(i){return!o.deps.equal(i,argfacs[0])}).length===0){arg=argfacs[0]}return{argument:arg,selection:[[chosen[1]],[chosen[2]]],choices:chosen[0].concat([keep])}}else{return Err("nopowswithcommoninnernumfac")}},choices:[{instruction:"choosenumerfactactic",options:function(o){return o.deps.getFacOptions(o.target.objs[0])}},{instruction:"choosedenomfactactic",options:function(o){return o.deps.getFacOptions(o.target.objs[1])}},{instruction:"mergetowhichfloor",options:["numer","denom"]}],selection:{max:1,filter:function(o){if(o.item.type!=="power"){if(o.item.type==="number"){return OK}else{return Err("mustbenumbase")}}else{if(o.item.objs[0].type==="number"){return OK}else{return Err("mustbenumbase",[0])}}},questions:function(_arg){var choices,deps,floor,floornum,target,_i,_len,_ref1,_results;deps=_arg.deps,target=_arg.target,choices=_arg.choices;_ref1=target.objs;_results=[];for(floornum=_i=0,_len=_ref1.length;_i<_len;floornum=++_i){floor=_ref1[floornum];_results.push({options:deps.getFacs(floor,choices!=null?choices[floornum]:void 0)})}return _results}},validate:function(o){var first,result,second;first=o.deps.getFacs(o.target.objs[0],o.choices[0])[o.selection[0][0]];second=o.deps.getFacs(o.target.objs[1],o.choices[1])[o.selection[1][0]];
result=o.deps.commonBaseNumFacPairer({obj1:first,obj2:second,deps:o.deps});if(!o.deps.commonBaseNumFacPairer({obj1:first,obj2:second,deps:o.deps})){console.log("WHAT THE HECK, FOOOOOOOOL",first,second,result);return Err("mustselectwithcommoninnerbasefacs")}else{return OK}},argument:{instruction:"enterinnerfactoeliminate"},perform:function(o){var analyse,arg,base,basepath,choice,choices,data,firstpow,floor,ispower,me,newfacs,path,pos,rest,secondpow,sel,sels,tool,wasalone,_i,_j,_len,_ref1,_ref2,_results;sels=o.selection;choices=o.choices||[];arg=o.argument;data=[{},{}];_ref1=[0,1];for(_i=0,_len=_ref1.length;_i<_len;_i++){floor=_ref1[_i];sel=sels[floor][0];choice=choices[floor];path=[floor].concat(o.deps.facPath(choice,sel));o.beforemark(path);wasalone=o.deps.lookUp(o.target,path.slice(0,-1)).type!=="product";me=o.deps.lookUp(o.target,path);ispower=me.type==="power";basepath=ispower?path.concat([0]):path;base=ispower?me.objs[0]:me;if(!o.deps.equal(arg,base)){rest=Num(o.deps.numberValue(base)/o.deps.numberValue(arg));analyse=o.deps.divideCheck({obj1:base,obj2:arg,deps:o.deps});newfacs=function(){var _j,_ref2,_results;_results=[];for(pos=_j=0,_ref2=analyse.found;0<=_ref2?_j<_ref2:_j>_ref2;pos=0<=_ref2?++_j:--_j){_results.push(arg)}return _results}().concat(analyse.maxrest.val!=="1"?[analyse.maxrest]:[]);o["do"]("numToProd","factorisingbasetoexposearg",{aim:basepath,argument:Product(newfacs)});if(analyse.found>1){o["do"]("mergeSameBaseFacs","mergefoundfacsintopower",{aim:basepath,selection:[function(){_results=[];for(var _j=0,_ref2=analyse.found;0<=_ref2?_j<_ref2:_j>_ref2;0<=_ref2?_j++:_j--){_results.push(_j)}return _results}.apply(this)]})}if(ispower){if(analyse.maxrest.val!=="1"){o["do"]("biProdBasePowToProd","splittingpowertofreearg",{aim:path})}if(analyse.found>1){o["do"]("powBasePowToFlatNiceExp","collapsefreedfacpowerexp",{aim:path.concat(analyse.maxrest.val!=="1"?[0]:[])})}if(!wasalone&&analyse.maxrest.val!=="1"){o["do"]("absorbProductFacs","includingsplitpowinprod",{aim:path.slice(0,-1),selection:[[sel]]})}else{path=path.concat([0]);basepath=basepath.concat([0])}}else{if(wasalone){path=path.concat([0]);basepath=basepath.concat([0])}else if(analyse.maxrest.val!=="1"){o["do"]("absorbProductFacs","includingsplitpowinprod",{aim:path.slice(0,-1),selection:[[sel]]})}}if(choice==="self"){choice="facs"}if(choice==="negchild"){choice="negchildfacs"}}if(o.target.objs[floor].type!=="product"&&choice==="facs"){choice="self"}data[floor].path=path;data[floor].choice=choice}firstpow=o.deps.lookUp(o.target.objs[0],o.deps.facPath(data[0].choice,sels[0][0]));secondpow=o.deps.lookUp(o.target.objs[1],o.deps.facPath(data[1].choice,sels[1][0]));tool=firstpow.type!=="power"&&secondpow.type!=="power"?"eliminateFromFrac":"mergeSameBaseNumerDenomFacs";o["do"](tool,"nowwemergethepowers",{selection:sels,choices:[data[0].choice,data[1].choice].concat(tool!=="eliminateFromFrac"?choices[2]:[])});return o}};powBasePowToFlatNiceExp={info:{name:"powBasePowToFlatNiceExp",effect:"simplifying",example:"(a^2)^3",uses:["powBasePowToProdExp","absorbProductFacs","collapseTwoNegFacs","multiplyNumFacs","multiplyPosNegNum","collapseNegOneFac"],tags:["powerbase","power"],lesson:"power101"},prints:{errors:["basemustbepow"],steps:["firstweflattenintoonepower","flattenexpprod","wedenegtheexpfactors","multiplynumericfacs","multposandnegexp","collapsenegonefac"]},target:{type:"power",validate:function(_arg){var base;base=_arg.target.objs[0];if(base.type==="power"){return OK}else{return Err("basemustbepow",[0])}}},perform:function(o){var basebase,baseexp,exp,_ref1,_ref2,_ref3;_ref1=o.target.objs,_ref2=_ref1[0],_ref3=_ref2.objs,basebase=_ref3[0],baseexp=_ref3[1],exp=_ref1[1];o["do"]("powBasePowToProdExp","firstweflattenintoonepower");o["try"]("collapseNegOneFac","collapsenegonefac",[1]);o["try"]("absorbProductFacs","flattenexpprod",[1]);o["try"]("collapseTwoNegFacs","wedenegtheexpfactors",[1]);o["try"]("multiplyNumFacs","multiplynumericfacs",[1]);o["try"]("multiplyPosNegNum","multposandnegexp",[1]);o.beforemark([[0,1],[1]]);return o.aftermark([[1]])}};negOneBaseEvenFacExpPowToOne={info:{name:"negOneBaseEvenFacExpPowToOne",effect:"simplifying",example:{str:"(-1)^-(4^x)",choices:["negchild"],selection:[[0]]},uses:["negToNegOneFacProd","absorbProductFacs","expandNegFacs","negToNegOneFacProd","negOneBaseTwoExpPowToOne","oneBasePowToOne"],tags:["neg1","power","number1","even"],lesson:"power102"},prints:{errors:["basemustbenegone","mustbeevennum","noevenexpfacs"],instructions:["chooseexpfactactic"],steps:["freetheexpfromneg","freechosenfacfromneg","collapsenegonebaseexptwo","collapsenegonebaseexptwo","collapsechosenfac","nowsplitthepow","hackatexp","flattenexpprod","buildpowwithexptwo","collapsenegonebaseexptwo","collapsewholepowertoone"]},target:{type:"power",validate:function(o){if(o.deps.equal(o.target.objs[0],Neg(one))){return OK}else{return Err("basemustbenegone")}}},choices:{instruction:"chooseexpfactactic",options:function(o){return o.deps.getFacOptions(o.target.objs[1])}},selection:{max:1,from:function(o){return o.deps.getFacs(o.target.objs[1],o.choices[0])},filter:function(o){var analysis,tocheck;tocheck=o.item||o.target;if(tocheck.type==="negation"){tocheck=tocheck.objs[0]}if(tocheck.type==="power"){tocheck=tocheck.objs[0]}if(tocheck.type==="number"){analysis=o.deps.divideCheck({obj1:tocheck,obj2:two,deps:o.deps});if(analysis.found){return OK}else{return Err("mustbeevennum")}}else{return Err("mustbeevennum")}}},auto:function(o){var analysis,choice,pos,tocheck,_i,_j,_len,_len1,_ref1,_ref2;_ref1=o.deps.getFacOptions(o.target.objs[1]);for(_i=0,_len=_ref1.length;_i<_len;_i++){choice=_ref1[_i];_ref2=o.deps.getFacs(o.target.objs[1],choice);for(pos=_j=0,_len1=_ref2.length;_j<_len1;pos=++_j){tocheck=_ref2[pos];if(tocheck.type==="negation"){tocheck=tocheck.objs[0]}if(tocheck.type==="power"){tocheck=tocheck.objs[0]}if(tocheck.type==="number"){analysis=o.deps.divideCheck({obj1:tocheck,obj2:two,deps:o.deps});if(analysis.found){return{choices:[choice],selection:[[pos]]}}}}}return Err("noevenexpfacs")},perform:function(o){var analysis,choice,path,rest,sel,_i,_ref1,_results;sel=o.selection[0][0];choice=o.choices[0];o.beforemark([1].concat(o.deps.facPath(choice,sel)));if(o.deps.equal(o.target.objs[1],two)){return o["do"]("negOneBaseTwoExpPowToOne","collapsenegonebaseexptwo")}else{if(o.target.objs[1].type==="negation"){o["do"]("negToNegOneFacProd","freetheexpfromneg",{aim:[1],direction:"right"});o["try"]("absorbProductFacs","flattenexpprod",{aim:[1]})}path=o.target.objs[1].type==="product"?[1,sel]:[1];if(o.deps.lookUp(o.target,path).type==="negation"){if(o.target.objs[1].type==="product"){o["do"]("expandNegFacs","freechosenfacfromneg",{aim:[1],selection:[[sel]],direction:"right"})}else{o["do"]("negToNegOneFacProd","freechosenfacfromneg",{aim:[1],direction:"right"})}}path=o.target.objs[1].type==="product"?[1,sel]:[1];if(o.deps.lookUp(o.target,path).type==="power"){o["do"]("extractPartFromPow","extractchosenfac",{aim:path,argument:one,direction:"left"});o["try"]("absorbProductFacs","flattenexpprod",{aim:[1]})}path=o.target.objs[1].type==="product"?[1,sel]:[1];analysis=o.deps.divideCheck({obj1:o.deps.lookUp(o.target,path),obj2:two,deps:o.deps});if(!o.deps.equal(analysis.divided,two)){o["do"]("numToProd","factorisetofreetwo",{aim:path,argument:Prod(two,analysis.minrest)});o["try"]("absorbProductFacs","flattenexpprod",{aim:[1]})}rest=function(){_results=[];for(var _i=0,_ref1=o.target.objs[1].objs.length;0<=_ref1?_i<_ref1:_i>_ref1;0<=_ref1?_i++:_i--){_results.push(_i)}return _results}.apply(this).filter(function(i){return i!==sel});o["do"]("prodExpPowToSelectPowBase","buildpowwithexptwo",{selection:[rest]});o["do"]("negOneBaseTwoExpPowToOne","collapsenegonebaseexptwo",{aim:[0]});return o["do"]("oneBasePowToOne","collapsewholepowertoone")}}};negOneBaseOddFacExpPowToNegOne={info:{name:"negOneBaseOddFacExpPowToNegOne",effect:"simplifying",example:{str:"(-1)^-(5x)",choices:["negchildfacs"],selection:[[0]]},uses:["negToNegOneFacProd","absorbProductFacs","expandNegFacs","prodExpPowToSelectPowBase","numToSum","biSumExpPowToProd","oneExpPowerToBase","negOneBaseEvenFacExpPowToOne","purgeOneFacs","collapseNegOneFac"],tags:["neg1","power","odd"],lesson:"power102"},prints:{errors:["basemustbenegone","mustbeoddnum","nooddexpfacs"],instructions:["chooseexpfactactic"],steps:["freetheexpfromneg","freechosenfacfromneg","collapsenegonebaseexptwo","collapsenegonebaseexptwo","collapsechosenfac","nowsplitthepow","hackatexp","flattenexpprod","buildpowwithoddexp","splitexp","splitpow","freenegone","collapsenewevenfacpow","collapsebasetonegone"]},target:{type:"power",validate:function(o){if(o.deps.equal(o.target.objs[0],Neg(one))){return OK}else{return Err("basemustbenegone")}}},choices:{instruction:"chooseexpfactactic",options:function(o){return o.deps.getFacOptions(o.target.objs[1])}},selection:{max:1,from:function(o){return o.deps.getFacs(o.target.objs[1],o.choices[0])},filter:function(o){var analysis,tocheck;tocheck=o.item||o.target;if(tocheck.type==="negation"){tocheck=tocheck.objs[0]}if(tocheck.type==="number"&&o.deps.isWholeNumber(tocheck)){analysis=o.deps.divideCheck({obj1:tocheck,obj2:two,deps:o.deps});if(analysis.found){return Err("mustbeoddnum")}else{return OK}}else{return Err("mustbeoddnum")}}},auto:function(o){var analysis,choice,pos,tocheck,_i,_j,_len,_len1,_ref1,_ref2;_ref1=o.deps.getFacOptions(o.target.objs[1]);for(_i=0,_len=_ref1.length;_i<_len;_i++){choice=_ref1[_i];_ref2=o.deps.getFacs(o.target.objs[1],choice);for(pos=_j=0,_len1=_ref2.length;_j<_len1;pos=++_j){tocheck=_ref2[pos];if(tocheck.type==="negation"){tocheck=tocheck.objs[0]}if(tocheck.type==="number"&&o.deps.isWholeNumber(tocheck)){analysis=o.deps.divideCheck({obj1:tocheck,obj2:two,deps:o.deps});if(analysis.found===0){return{choices:[choice],selection:[[pos]]}}}}}return Err("nooddexpfacs")},perform:function(o){var path,rest,sel,_i,_ref1,_results;sel=o.selection[0][0];o.beforemark([1].concat(o.deps.facPath(o.choices[0],sel)));if(o.target.objs[1].type==="negation"){o["do"]("negToNegOneFacProd","freetheexpfromneg",{aim:[1],direction:"right"});o["try"]("absorbProductFacs","flattenexpprod",{aim:[1]})}path=o.target.objs[1].type==="product"?[1,sel]:[1];if(o.deps.lookUp(o.target,path).type==="negation"){if(o.target.objs[1].type==="product"){o["do"]("expandNegFacs","freechosenfacfromneg",{aim:[1],selection:[[sel]],direction:"right"})}else{o["do"]("negToNegOneFacProd","freechosenfacfromneg",{aim:[1],direction:"right"})}}if(o.target.objs[1].type==="product"){rest=function(){_results=[];for(var _i=0,_ref1=o.target.objs[1].objs.length;0<=_ref1?_i<_ref1:_i>_ref1;0<=_ref1?_i++:_i--){_results.push(_i)}return _results}.apply(this).filter(function(i){return i!==sel});o["do"]("prodExpPowToSelectPowBase","buildpowwithoddexp",{selection:[rest]});path=[0]}else{path=[]}rest=o.deps.numberValue(o.deps.lookUp(o.target,path.concat([1])))-1;o["do"]("numToSum","splitexp",{aim:path.concat([1]),argument:Sum(one,Num(rest))});o["do"]("biSumExpPowToProd","splitpow",{aim:path});o["do"]("oneExpPowerToBase","freenegone",{aim:path.concat([0])});o["do"]("negOneBaseEvenFacExpPowToOne","collapsenewevenfacpow",{aim:path.concat([1]),choices:["self"],selection:[[0]]});o["try"]("collapseNegOneFac","puttingnegationback",{aim:[1]});return o["do"]("purgeOneFacs","collapsebasetonegone",{aim:path,selection:[[1]]})}};splitNegBasePow={info:{name:"splitNegBasePow",effect:"simplifying",example:"(-x)^3",uses:["negToNegOneFacProd","biProdBasePowToProd","negOneBaseEvenFacExpPowToOne","negOneBaseOddFacExpPowToNegOne","purgeOneFacs","negOneFacBiProdToNeg"],tags:["negativebase","power"],lesson:"power102"},prints:{errors:["basemustnotbenegone","basemustbeneg"],steps:["freeneginsidebase","splittoprodofpows","collapsefreednegonebasepow","removetheoneresidue","collapsefreedneg"]},target:{type:"power",validate:function(o){var fac;if(o.deps.equal(o.target.objs[0],Neg(one))){return Err("basemustnotbenegone",[0])}else if(o.target.objs[0].type!=="negation"){return Err("basemustbeneg",[0])}else if(function(){var _i,_len,_ref1,_results;_ref1=o.deps.getFacs(o.target.objs[1]);_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){fac=_ref1[_i];if(fac.type==="number"&&parseInt(fac.val)===parseFloat(fac.val)){_results.push(fac)}}return _results}().length===0){return Err("expmusthavenumfac",[1])}else{return OK}}},perform:function(o){o["do"]("negToNegOneFacProd","freeneginsidebase",{aim:[0],direction:"left"});o["do"]("biProdBasePowToProd","splittoprodofpows");o["try"]("negOneBaseEvenFacExpPowToOne","collapsefreednegonebasepow",{aim:[0]});o["try"]("negOneBaseOddFacExpPowToNegOne","collapsefreednegonebasepow",{aim:[0]});o["try"]("purgeOneFacs","removetheoneresidue");return o["try"]("negOneFacBiProdToNeg","collapsefreedneg")}};extractBaseFraction={info:{name:"extractBaseFraction",effect:"simplifying",example:"(x/y)^z",uses:["multiplyByOne","raiseByOne","oneToZeroExpPower","mergeSameBaseNumerDenomFacs","biProdBasePowToProd","powBasePowToFlatNiceExp","negExpFacProdToFrac"],tags:["fractionbase","fraction","power"],opposite:"fracOfPowsToPowOfFrac",lesson:"power103"},prints:{errors:["basemustbefrac"],steps:["containbasepow","addfactoturntopow","turnfactopow","movepowtonumer","splittotwopows","flattentheexp","makepowtodenom"]},target:{type:"power",validate:function(_arg){var base;base=_arg.target.objs[0];if(base.type==="fraction"){return OK}else{return Err("basemustbefrac",[0])}}},perform:function(o){o["do"]("multiplyByOne","addfactoturntopow",{aim:[0,0],direction:"right"});if(o.target.objs[0].objs[1].type==="power"){o["do"]("raiseByOne","containbasepow",{aim:[0,1]})}o["do"]("oneToZeroExpPower","turnfactopow",{aim:[0,0,1],argument:o.deps.getBase(o.target.objs[0].objs[1])});o["do"]("mergeSameBaseNumerDenomFacs","movepowtonumer",{aim:[0],choices:["facs","self","numer"],selection:[[1],[0]]});o["do"]("biProdBasePowToProd","splittotwopows");o["do"]("powBasePowToFlatNiceExp","flattentheexp",{aim:[1]});o["do"]("negExpFacProdToFrac","makepowtodenom",{selection:[[1]]});o.beforemark([0,0]);o.beforemark([0,1]);o.aftermark([0,0]);return o.aftermark([1,0])}};fracOfPowsToPowOfFrac={info:{name:"fracOfPowsToPowOfFrac",effect:"complicating",example:"x^z/y^z",tags:["power","fraction"],uses:["extractFacsFromFrac","movePowInFrac","negToNegOneFacProd","prodExpPowToPowBase","negExpFacProdToFrac","sameExpFacProdToPow","multFacsIntoFrac"],opposite:"extractBaseFraction",lesson:"power103"},target:{type:"fraction",validate:function(_arg){var denom,deps,numer,_ref1,_ref2;deps=_arg.deps,_ref1=_arg.target,_ref2=_ref1.objs,numer=_ref2[0],denom=_ref2[1];if(numer.type!=="power"){return Err("TARnumermustbepower",[0])}else if(denom.type!=="power"){return Err("TARdenommustbepower",[1])}else if(!deps.equal(numer.objs[1],denom.objs[1])){return Err("TARdiffpowerexp")}else{return OK}}},perform:function(o){o["do"]("extractFacsFromFrac","extractdenom",{selection:[[],[0]],choices:["self","self"],direction:"right"});o["do"]("movePowInFrac","movetonumer",{aim:[1],choices:["denom","self"],selection:[[0]]});o["do"]("negToNegOneFacProd","splitnegexp",{aim:[1,1],direction:"left"});o["do"]("prodExpPowToPowBase","buildtower",{aim:[1],selection:[[1]]});o["do"]("negExpFacProdToFrac","nowbacktofrac",{aim:[1,0],selection:[[0]]});o["do"]("sameExpFacProdToPow","mergeit");o["do"]("multFacsIntoFrac","multintofrac",{aim:[0],selection:[[1],[0]]});o.aftermark([0,0]);o.aftermark([0,1]);o.beforemark([0,0]);return o.beforemark([1,0])}};negExpFacProdToFrac={info:{name:"negExpFacProdToFrac",effect:"simplifying",example:{str:"x*(y^-3)*z",selection:[[1]]},uses:["divideByOne","movePowInFrac"],tags:["negativeexponent","power","product","powerfactor"],lesson:"power103"},prints:{errors:["mustbenegexppow"],steps:["turnselpowstofracs","groupallpowsturnedfracs","moveremainfacsintofrac"]},target:"math",selection:{max:1,from:function(o){if(o.target.type==="product"){return o.target.objs}else{return[o.target]}},filter:function(_arg){var item;item=_arg.item;if(item.type==="power"&&item.objs[1].type==="negation"){return OK}else{return Err("mustbenegexppow")}}},perform:function(o){var pos,wasprod;pos=o.selection[0][0];wasprod=o.target.type==="product";o["do"]("divideByOne","divbyone");o["do"]("movePowInFrac","thenmove",{choices:["numer",wasprod?"facs":"self"],selection:[[pos]]});if(wasprod){o.beforemark([pos])}return o.aftermark([1])}};collapseSumBasePow={info:{name:"collapseSumBasePow",effect:"simplifying",example:"(x+y)^2",uses:["flattenPow","mergeSumFacs"],tags:["sumbase","power","productterm"],lesson:"power102"},prints:{errors:["TARbasemustbesum","TARexpmustbeinteger2_5"],steps:["firstflattenpow","thenmergeallsumfacs"]},target:{type:"power",validate:function(o){var base,exp,ret,_ref1;_ref1=o.target.objs,base=_ref1[0],exp=_ref1[1];ret=base.type!=="sum"?Err("TARbasemustbesum",[0]):exp.type!=="number"?Err("TARexpmustbeinteger2_5",[1]):parseFloat(exp.val)!==Math.floor(parseFloat(exp.val))?Err("TARexpmustbeinteger2_5",[1]):parseInt(exp.val)<2||5<parseInt(exp.val)?Err("TARexpmustbeinteger2_5",[1]):OK;return ret}},perform:function(o){var lift,orig,times,_i,_ref1,_results;times=orig=lift=parseInt(o.target.objs[1].val);o["do"]("flattenPow","firstflattenpow");return o["do"]("mergeSumFacs","thenmergeallsumfacs",{selection:[function(){_results=[];for(var _i=0,_ref1=o.target.objs.length;0<=_ref1?_i<_ref1:_i>_ref1;0<=_ref1?_i++:_i--){_results.push(_i)}return _results}.apply(this)]})}};turnNumToPow={info:{name:"turnNumToPow",effect:"complicating",opposite:"numericPowToNum",example:{str:"125",argument:Pow(Num(5),three)},uses:["numToProd","mergeSameBaseFacs"],tags:["power","naturalnum"],lesson:"power102"},prints:{errors:["ARGmustbesamevaluepow","TARmustbeintegerover1"],instructions:["ARGentertargetpow"]},target:{type:"integer",validate:function(o){if(1<parseFloat(o.target.val)){return OK}else{return Err("TARmustbeintegerover1")}}},argument:{instruction:"ARGentertargetpow",type:"power",validate:function(o){var powval;powval=Math.pow(parseFloat(o.argument.objs[0].val),parseFloat(o.argument.objs[1].val));if(parseFloat(o.target.val)===powval){return OK}else{return Err("ARGmustbesamevaluepow")}}},perform:function(o){var expval,n;expval=parseFloat(o.argument.objs[1].val);o["do"]("numToProd","factorisenum",{argument:Prod(function(){var _i,_results;_results=[];for(n=_i=0;0<=expval?_i<expval:_i>expval;n=0<=expval?++_i:--_i){_results.push(o.argument.objs[0])}return _results}())});return o["do"]("mergeSameBaseFacs","nowmergetopow",{selection:[function(){var _i,_results;_results=[];for(n=_i=0;0<=expval?_i<expval:_i>expval;n=0<=expval?++_i:--_i){_results.push(n)}return _results}()]})}};oneNumerFracToNegExpPow={info:{name:"oneNumerFracToNegExpPow",effect:"complicating",example:"1/x",uses:["raiseByOne","movePowInFrac"],tags:["power","number1","neg1"],lesson:"power103"},prints:{steps:["firstmakenumertodenomzeroexppow","mergetonumer"],errors:["TARnumermustbeone"]},target:{type:"fraction",validate:function(o){if(o.deps.equal(o.target.objs[0],one)){return OK}else{return Err("TARnumermustbeone",[0])}}},perform:function(o){o["do"]("raiseByOne","turntopow",{aim:[1]});o["do"]("movePowInFrac","thenmove",{selection:[[0]],choices:["denom","self"]});o.beforemark([1]);return o.aftermark([0])}};oneToZeroExpPower={info:{name:"oneToZeroExpPower",effect:"complicating",example:{str:"1",argument:x},uses:["oneToSameNumerDenomFrac","mergeSameBaseNumerDenomFacs"],tags:["power","number1","number0","exponent"],opposite:"zeroExpPowerToOne",lesson:"power103"},prints:{instructions:["enternonzerobase"],steps:["splitonetofrac","mergetoone"]},target:"one",argument:{instruction:"enternonzerobase"},perform:function(o){o["do"]("oneToSameNumerDenomFrac","splitonetofrac",{argument:Pow(o.argument,one)});o["do"]("mergeSameBaseNumerDenomFacs","mergetoone",{choices:["self","self","numer"],selection:[[0],[0]]});return o.aftermark([0])}};extractPartFromPow={info:{name:"extractPartFromPow",effect:"complicating",example:{str:"x^3",argument:two},uses:["raiseByOne","numToSum","biSumExpPowToProd","oneExpPowerToBase","addMirroredNumber","addMirroredExpression","splitSumExpPow"],tags:["power","factorise"],lesson:"power102"},prints:{instructions:["enterexponenttoextract","choosesideforextractedpow"],steps:["turnnonpowtargettopow","splitexponentsowecansplitpow","splitpower","cleanupremainingexponent","removeoneexpinnew"]},target:"math",argument:{instruction:"enterexponenttoextract"},direction:"choosesideforextractedpow",perform:function(o){var arg,dir,keepobj,keepval,newisnumeric,newobj,newside,newval,oldisnumeric,oldside,oldval,tool,_ref1;dir=o.direction;_ref1=dir==="right"?[1,0]:[0,1],newside=_ref1[0],oldside=_ref1[1];arg=o.argument;newisnumeric=o.deps.isNumeric(arg);if(o.target.type!=="power"){o["do"]("raiseByOne","turnnonpowtargettopow")}oldisnumeric=o.deps.isNumeric(o.target.objs[1]);if(newisnumeric&&oldisnumeric){newval=o.deps.numberValue(arg);oldval=o.deps.numberValue(o.target.objs[1]);newobj=newval<0?Neg(Num(newval*-1)):Num(newval);keepval=oldval-newval;keepobj=keepval<0?Neg(Num(keepval*-1)):Num(keepval);o["do"]("numToSum","splitexponentsowecansplitpow",{aim:[1],argument:newside===0?Sum(newobj,keepobj):Sum(keepobj,newobj)});o["do"]("biSumExpPowToProd","splitpower");o["try"]("oneExpPowerToBase","cleanupremainingexponent",{aim:[oldside]})}else{tool=newisnumeric?"addMirroredNumber":"addMirroredExpression";o["do"](tool,"splitexponentsowecansplitpow",{aim:[1],argument:arg,direction:"right"});o["do"]("splitSumExpPow","splitpower",{selection:[[1]],direction:dir})}o["try"]("oneExpPowerToBase","removeoneexpinnew",{aim:[newside]});return o.aftermark([newside])}};zeroToPow={info:{name:"zeroToPow",effect:"complicating",example:{str:"0",argument:x},uses:["raiseByOne","addMirroredExpression","splitSumExpPow","absorbSumTerms","zeroBasePowerToZero","mergeSameBaseFacs","mergeAllIntegerTerms","purgeZeroTerms"],tags:["number0","power"],opposite:"zeroBasePowerToZero",lesson:"power102"},prints:{instructions:["ARGexponent"]},target:"zero",argument:{instruction:"ARGexponent"},perform:function(o){o["do"]("raiseByOne","createexp");o["do"]("addMirroredExpression","addtheexprwithnegtwo",{aim:[1],direction:"right",argument:Sum(o.argument,Neg(two))});o["do"]("splitSumExpPow","splittheexp",{direction:"right",selection:[[2]]});o["do"]("absorbSumTerms","flattenorigexp",{aim:[0,1],selection:[[1]]});o["do"]("zeroBasePowerToZero","dropzeroexp",{aim:[1]});o["do"]("mergeSameBaseFacs","mergethemback",{selection:[[0,1]]});o["do"]("absorbSumTerms","flattenmergedexp",{aim:[1],selection:[[0]]});o["do"]("mergeAllIntegerTerms","addallnums",{aim:[1],selection:[[0,2,3]]});return o.doIf("purgeZeroTerms","removezero",{aim:[1],selection:[[0]]})}};flattenPow={info:{name:"flattenPow",effect:"complicating",example:"x3",tags:["power"],uses:["splitSumExpPow","absorbProductFacs","oneExpPowerToBase"],lesson:"power102"},prints:{errors:["TARexpmustbeinteger2_15"],steps:["splitoutone","flattenthisbit","droponeexp"]},target:{type:"power",validate:function(o){var base,exp,_ref1;_ref1=o.target.objs,base=_ref1[0],exp=_ref1[1];if(exp.type!=="number"){return Err("TARexpmustbeinteger2_15",[1])}else if(parseFloat(exp.val)!==Math.floor(parseFloat(exp.val))){return Err("TARexpmustbeinteger2_15",[1])}else if(parseInt(exp.val)<2||15<parseInt(exp.val)){return Err("TARexpmustbeinteger2_15",[1])}else{return OK}}},perform:function(o){var i,val;val=parseInt(o.target.objs[1].val);o["do"]("numToSum","oneifyexp",{aim:[1],argument:Sum(function(){var _i,_results;_results=[];for(i=_i=0;0<=val?_i<val:_i>val;i=0<=val?++_i:--_i){_results.push(one)}return _results}())});while(val-->1){o["do"]("splitSumExpPow","splitoutone",{aim:o.target.type==="product"?[0]:[],selection:[[0]],direction:"right"});o.doIf("absorbProductFacs","flattenthisbit",{selection:[[0]]});o["do"]("oneExpPowerToBase","droponeexp",{aim:[[1]]})}return o["do"]("oneExpPowerToBase","droponeexpfinal",{aim:[[0]]})}};if(typeof exports==="undefined"){exportTo=this.CATS.math}else{exportTo=exports}funcs={movePowInFrac:movePowInFrac,fracOfPowsToPowOfFrac:fracOfPowsToPowOfFrac,approxDecNumPow:approxDecNumPow,sameExpFacProdToPow:sameExpFacProdToPow,turnNumToPow:turnNumToPow,oneNumerFracToNegExpPow:oneNumerFracToNegExpPow,transformPowOfFracAndSimplify:transformPowOfFracAndSimplify,numericPowToNum:numericPowToNum,flattenPow:flattenPow,collapseSumBasePow:collapseSumBasePow,zeroToPow:zeroToPow,getNumExp:getNumExp,extractPartFromPow:extractPartFromPow,negExpFacProdToFrac:negExpFacProdToFrac,extractBaseFraction:extractBaseFraction,splitNegBasePow:splitNegBasePow,negOneBaseOddFacExpPowToNegOne:negOneBaseOddFacExpPowToNegOne,negOneBaseEvenFacExpPowToOne:negOneBaseEvenFacExpPowToOne,prodExpPowToSelectPowBase:prodExpPowToSelectPowBase,oneBasePowToOne:oneBasePowToOne,powBasePowToFlatNiceExp:powBasePowToFlatNiceExp,collapseSameInnerBaseFacNumerDenomPows:collapseSameInnerBaseFacNumerDenomPows,prodExpPowToPowBase:prodExpPowToPowBase,negOneBaseTwoExpPowToOne:negOneBaseTwoExpPowToOne,biProdBasePowToProd:biProdBasePowToProd,zeroBaseExpPowToUndefined:zeroBaseExpPowToUndefined,mergeSameBaseFacs:mergeSameBaseFacs,mergeBiSameBasePowFacs:mergeBiSameBasePowFacs,getExp:getExp,sameBasePairer:sameBasePairer,mergeSameBaseNumerDenomFacs:mergeSameBaseNumerDenomFacs,getBase:getBase,splitSumExpPow:splitSumExpPow,biSumExpPowToProd:biSumExpPowToProd,oneExpPowerToBase:oneExpPowerToBase,raiseByOne:raiseByOne,zeroExpPowerToOne:zeroExpPowerToOne,oneToZeroExpPower:oneToZeroExpPower,zeroBasePowerToZero:zeroBasePowerToZero,powBasePowToProdExp:powBasePowToProdExp};for(k in funcs){v=funcs[k];exportTo[k]=v}}).call(this);
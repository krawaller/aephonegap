(function(){var And,Eq,Err,FALSE,Frac,Fraction,Geq,Gt,IfElse,Leq,Log,Lt,Neg,Neq,Not,Num,OK,Or,PlusMinus,Pow,Power,Prod,Product,Root,Sqrt,Sum,TRUE,UNDEFINED,addToRelationSides,arrsplit,backwardsQuadrify,collapseNegationsInSumsInRelation,collapsePowInZeroRel,collapseRootInZeroRel,containsType,containsTypeWithVal,deepcopy,divEquality,divInequality,divRelSidesAndFix,eliminateCommonInnerFacsInRel,eliminateSameFacsFromRelationSides,exportTo,five,flipRel,four,funcs,k,liftVarFromDenomInRel,logifyRelationSides,makeCheck,mergeNumFracFacOnOppRelSides,mixin,moveTermsBetweenSidesInRel,multEquality,multInequality,multRelSidesAndFix,newEvalNumVal,one,powerifyRelationSides,printObj,purgeEqualTermsFromRelation,relTermAnalysis,rootifyRelationSides,solveEqWithNoConstant,solveExpEq,solveLinearEq,solveLogEq,solvePowEq,solveQuadHiddenInHigher,solveQuadHiddenInRoot,solveQuadraticEquation,solveRootEq,three,two,v,varDependency,x,y,z,zero,zeroProdMethod,_ref,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};_ref=typeof require==="undefined"?this.CATS.math.toolhelpers:require("./toolhelpers"),flipRel=_ref.flipRel,IfElse=_ref.IfElse,PlusMinus=_ref.PlusMinus,Log=_ref.Log,Sqrt=_ref.Sqrt,Root=_ref.Root,arrsplit=_ref.arrsplit,UNDEFINED=_ref.UNDEFINED,deepcopy=_ref.deepcopy,mixin=_ref.mixin,Prod=_ref.Prod,Frac=_ref.Frac,Pow=_ref.Pow,Eq=_ref.Eq,Leq=_ref.Leq,Gt=_ref.Gt,Geq=_ref.Geq,Lt=_ref.Lt,Neq=_ref.Neq,four=_ref.four,five=_ref.five,And=_ref.And,Or=_ref.Or,Not=_ref.Not,TRUE=_ref.TRUE,FALSE=_ref.FALSE,makeCheck=_ref.makeCheck,x=_ref.x,y=_ref.y,z=_ref.z,Neg=_ref.Neg,Product=_ref.Product,Sum=_ref.Sum,Power=_ref.Power,Fraction=_ref.Fraction,Num=_ref.Num,zero=_ref.zero,one=_ref.one,two=_ref.two,three=_ref.three,Err=_ref.Err,OK=_ref.OK,printObj=_ref.printObj;newEvalNumVal=function(o){var base,childval,denom,exp,fac,facval,grade,logee,numer,radicand,term,termval,val,_i,_j,_len,_len1,_ref1,_ref2;switch(o.type){case"number":return parseFloat(o.val);case"negation":childval=newEvalNumVal(o.objs[0]);if(childval!==false){return-1*childval}else{return false}break;case"fraction":numer=newEvalNumVal(o.objs[0]);denom=newEvalNumVal(o.objs[1]);if(numer===false||denom===false){return false}else{return numer/denom}break;case"power":base=newEvalNumVal(o.objs[0]);exp=newEvalNumVal(o.objs[1]);if(base===false||exp===false){return false}else{return Math.pow(base,exp)}break;case"root":radicand=newEvalNumVal(o.objs[0]);grade=newEvalNumVal(o.objs[1]);if(radicand===false||radicand<0||grade===false){return false}else{return Math.pow(radicand,1/grade)}break;case"log":logee=newEvalNumVal(o.objs[0]);grade=newEvalNumVal(o.objs[1]);if(logee===false||grade===false){return false}else{return Math.log(logee)/Math.log(grade)}break;case"const":case"constant":switch(o.val){case"percent":return 1/100;case"pi":return Math.PI;case"e":return Math.E;default:return false}break;case"product":val=1;_ref1=o.objs;for(_i=0,_len=_ref1.length;_i<_len;_i++){fac=_ref1[_i];facval=newEvalNumVal(fac);if(facval===false){return false}else{val*=facval}}return val;case"sum":val=0;_ref2=o.objs;for(_j=0,_len1=_ref2.length;_j<_len1;_j++){term=_ref2[_j];termval=newEvalNumVal(term);if(termval===false){return false}else{val+=termval}}return val;case"absolute":childval=newEvalNumVal(o.objs[0]);if(childval!==false){return Math.abs(childval)}else{return false}break;default:return false}};containsType=function(o,type){var obj,_i,_len,_ref1;if(o.type===type){return true}if(o.objs){_ref1=o.objs;for(_i=0,_len=_ref1.length;_i<_len;_i++){obj=_ref1[_i];if(containsType(obj,type)){return true}}}return false};containsTypeWithVal=function(o,type,val){var obj,_i,_len,_ref1;if(o.type===type&&o.val===val){return true}if(o.objs){_ref1=o.objs;for(_i=0,_len=_ref1.length;_i<_len;_i++){obj=_ref1[_i];if(containsTypeWithVal(obj,type,val)){return true}}}return false};relTermAnalysis=function(o){var left,myside,n,ret,right,term,tinfo,_i,_j,_k,_l,_len,_ref1,_ref2,_ref3,_ref4,_ref5,_results,_results1,_results2;left=o.deps.getTerms(o.target.objs[0]);right=o.deps.getTerms(o.target.objs[1]);ret={total:left.length+right.length,sides:[{has:left.length,terms:[]},{has:right.length,terms:[]}],terms:[],nonlonezeroterms:[]};_ref1=left.concat(right);for(n=_i=0,_len=_ref1.length;_i<_len;n=++_i){term=_ref1[n];myside=n<left.length?0:1;tinfo={num:n,sidenum:myside?n-left.length:n,side:myside,otherside:myside===1?0:1,othersidelength:ret.sides[myside===1?0:1].has,term:term,sidelength:ret.sides[myside].has,path:ret.sides[myside].has===1?[myside]:[myside,myside?n-left.length:n],sideword:myside?"right":"left"};if(o.deps.equal(term,zero)&&ret.sides[tinfo.side].has===1){tinfo.islonezero=true;ret.sides[tinfo.side].islonezero=true}else{ret.nonlonezeroterms.push(tinfo)}ret.terms.push(tinfo);ret.sides[tinfo.side].terms.push(tinfo)}ret.sides[0].range=ret.sides[0].islonezero?[]:function(){_results=[];for(var _j=0,_ref2=left.length;0<=_ref2?_j<_ref2:_j>_ref2;0<=_ref2?_j++:_j--){_results.push(_j)}return _results}.apply(this);ret.sides[1].range=ret.sides[1].islonezero?[]:ret.sides[0].islonezero?function(){_results1=[];for(var _k=0,_ref3=right.length;0<=_ref3?_k<_ref3:_k>_ref3;0<=_ref3?_k++:_k--){_results1.push(_k)}return _results1}.apply(this):function(){_results2=[];for(var _l=_ref4=left.length,_ref5=left.length+right.length;_ref4<=_ref5?_l<_ref5:_l>_ref5;_ref4<=_ref5?_l++:_l--){_results2.push(_l)}return _results2}.apply(this);return ret};varDependency=function(obj,coll){var child,name,_i,_len,_ref1;if(coll==null){coll={}}if(obj.type==="power"&&obj.objs[0].type==="variable"){name=obj.objs[0].val;coll[name]=(coll[name]||[]).concat(obj.objs[1]);return varDependency(obj.objs[1],coll)}else if(obj.type==="variable"){name=obj.val;coll[name]=(coll[name]||[]).concat(one);return coll}else if(obj.objs){_ref1=obj.objs;for(_i=0,_len=_ref1.length;_i<_len;_i++){child=_ref1[_i];coll=varDependency(child,coll)}return coll}else{return coll}};zeroProdMethod={info:{name:"zeroProdMethod",effect:"simplifying",example:"(x2)*(x+3)=0",tags:["relation"],lesson:"equationsolve"},prints:{errors:["mustbeprodandzero"]},target:{type:"equality",validate:function(_arg){var deps,left,right,_ref1,_ref2;deps=_arg.deps,_ref1=_arg.target,_ref2=_ref1.objs,left=_ref2[0],right=_ref2[1];if(!(right.type==="product"&&deps.equal(left,zero)||left.type==="product"&&deps.equal(right,zero))){return Err("mustbeprodandzero")}else{return OK}}},perform:function(_arg){var deps,fac,left,n,prodfacs,prodside,right,_ref1,_ref2;deps=_arg.deps,_ref1=_arg.target,_ref2=_ref1.objs,left=_ref2[0],right=_ref2[1];prodside=left.type==="product"?0:1;prodfacs=prodside===0?left.objs:right.objs;return{result:Or(function(){var _i,_len,_results;_results=[];for(_i=0,_len=prodfacs.length;_i<_len;_i++){fac=prodfacs[_i];_results.push(Eq(fac,zero))}return _results}()),beforemarks:function(){var _i,_len,_results;_results=[];for(n=_i=0,_len=prodfacs.length;_i<_len;n=++_i){fac=prodfacs[n];_results.push([prodside,n])}return _results}(),aftermarks:function(){var _i,_len,_results;_results=[];for(n=_i=0,_len=prodfacs.length;_i<_len;n=++_i){fac=prodfacs[n];_results.push([n,0])}return _results}()}}};collapsePowInZeroRel={info:{name:"collapsePowInZeroRel",effect:"simplifying",example:"x2=0",tags:["equality","relation","power","number0"],lesson:"relationmanip"},prints:{errors:["TARrelmustbeeq","TARmustbepowandzero"]},target:{type:"relation",validate:function(_arg){var deps,left,right,val,_ref1,_ref2;deps=_arg.deps,_ref1=_arg.target,val=_ref1.val,_ref2=_ref1.objs,left=_ref2[0],right=_ref2[1];if(val!=="eq"){return Err("TARrelmustbeeq")}else if(!(right.type==="power"&&deps.equal(left,zero)||left.type==="power"&&deps.equal(right,zero))){return Err("TARmustbepowandzero")}else{return OK}}},perform:function(_arg){var deps,left,res,right,side,val,_ref1,_ref2;deps=_arg.deps,_ref1=_arg.target,val=_ref1.val,_ref2=_ref1.objs,left=_ref2[0],right=_ref2[1];side=left.type==="power"?0:1;res=And(side===0?Eq(left.objs[0],zero):Eq(zero,right.objs[0]),side===0?Neq(left.objs[1],zero):Neq(zero,right.objs[1]));printObj(res);return{result:res,beforemarks:[side,0],aftermarks:[0,side]}}};collapseRootInZeroRel={info:{name:"collapseRootInZeroRel",effect:"simplifying",example:"(sqrt x)=0",tags:["equality","relation","root","number0"],uses:["rootToOneNumFracExpPow","collapsePowInZeroRel"],lesson:"relationmanip"},prints:{errors:["TARrelmustbeeq","TARmustberootandzero"]},target:{type:"equality",validate:function(_arg){var deps,left,right,val,_ref1,_ref2;deps=_arg.deps,_ref1=_arg.target,val=_ref1.val,_ref2=_ref1.objs,left=_ref2[0],right=_ref2[1];if(val!=="eq"){return Err("TARrelmustbeeq")}else if(!(right.type==="root"&&deps.equal(left,zero)||left.type==="root"&&deps.equal(right,zero))){return Err("TARmustberootandzero")}else{return OK}}},perform:function(o){var side;side=o.target.objs[0].type==="root"?0:1;o.beforemark([side,0]);o.aftermark([side]);o["do"]("rootToOneNumFracExpPow","firstwriteaspow",{aim:[side]});return o["do"]("collapsePowInZeroRel","thenexplore")}};addToRelationSides={info:{name:"addToRelationSides",effect:"complicating",example:{str:"x=y",argument:z,direction:"left"},tags:["relation","introduce"],lesson:"relationmanip"},prints:{instructions:["DIRchoosesidefornewterminsides","ARGwhattoaddtobothsidesofrel"]},target:"relation",direction:"DIRchoosesidefornewterminsides",argument:{instruction:"ARGwhattoaddtobothsidesofrel"},perform:function(_arg){var aftermarks,argument,direction,left,newleft,newright,right,type,val,_ref1,_ref2;argument=_arg.argument,direction=_arg.direction,_ref1=_arg.target,val=_ref1.val,type=_ref1.type,_ref2=_ref1.objs,left=_ref2[0],right=_ref2[1];if(!direction){direction=["left","left"]}if(typeof direction==="string"){direction=[direction,direction]}if(Array.isArray(direction)&&direction.length===1){direction.push(direction[0])}aftermarks=[];if(direction[0]==="right"){newleft=Sum(left,argument);aftermarks.push([0,1])}else{newleft=Sum(argument,left);aftermarks.push([0,0])}if(direction[1]==="right"){newright=Sum(right,argument);aftermarks.push([1,1])}else{newright=Sum(argument,right);aftermarks.push([1,0])}return{result:{type:type,val:val,objs:[newleft,newright]},aftermarks:aftermarks}}};powerifyRelationSides={info:{name:"powerifyRelationSides",effect:"complicating",example:{str:"x=y",argument:z},tags:["relation","introduce"],lesson:"relationmanip"},prints:{instructions:["ARGwhattopowerbothsidesinrelwith"]},target:"equality",argument:{instruction:"ARGwhattopowerbothsidesinrelwith"},perform:function(_arg){var argument,fixed,target;argument=_arg.argument,target=_arg.target;fixed=deepcopy(target);fixed.objs[0]=Pow(fixed.objs[0],argument);fixed.objs[1]=Pow(fixed.objs[1],argument);return{result:fixed,aftermarks:[[0,1],[1,1]]}}};logifyRelationSides={info:{name:"logifyRelationSides",effect:"complicating",example:{str:"x=y",argument:z},tags:["relation","introduce","log"],lesson:"relationmanip"},prints:{instructions:["ARGlogbase"]},target:"relation",argument:{instruction:"ARGlogbase"},perform:function(_arg){var argument,fixed,target;argument=_arg.argument,target=_arg.target;fixed=deepcopy(target);fixed.objs[0]=Log(fixed.objs[0],argument);fixed.objs[1]=Log(fixed.objs[1],argument);return{result:fixed,aftermarks:[[0,1],[1,1]]}}};rootifyRelationSides={info:{name:"rootifyRelationSides",effect:"complicating",example:{str:"x=y",argument:z},tags:["relation","introduce","root"]},prints:{instructions:["ARGlogbase"]},target:"relation",argument:{instruction:"ARGrootgrade"},perform:function(_arg){var argument,fixed,target;argument=_arg.argument,target=_arg.target;fixed=deepcopy(target);fixed.objs[0]=Root(fixed.objs[0],argument);fixed.objs[1]=Root(fixed.objs[1],argument);return{result:fixed,aftermarks:[[0,1],[1,1]]}}};purgeEqualTermsFromRelation={info:{name:"purgeEqualTermsFromRelation",effect:"simplifying",example:{str:"(x+(3*-y)/2)=((3y)/-2)",selection:[[1],[0]]},uses:["addToRelationSides","absorbSumTerms","addExpressions","purgeZeroTerms"],tags:["relation","remove"],lesson:"relationmanip"},target:"relation",prints:{errors:["SELmustchoosesimilarterms","AUTOnosimilartermsonbothsidesinrel"],instructions:["SELleftsideequaltermtodelete","SELrightsideequaltermtodelete"],steps:[]},selection:{max:1,questions:[{instruction:"SELleftsideequaltermtodelete",from:function(o){return o.deps.getTerms(o.target.objs[0])}},{instruction:"SELrightsideequaltermtodelete",from:function(o){return o.deps.getTerms(o.target.objs[1])}}]},validate:function(o){var deps,left,obj1,obj2,pos1,pos2,right,_ref1,_ref2,_ref3,_ref4,_ref5;deps=o.deps,_ref1=o.target,_ref2=_ref1.objs,left=_ref2[0],right=_ref2[1],_ref3=o.selection,_ref4=_ref3[0],pos1=_ref4[0],_ref5=_ref3[1],pos2=_ref5[0];obj1=deps.getTerms(left)[pos1];obj2=deps.getTerms(right)[pos2];if(!deps.isKindredSpirits({obj1:obj1,obj2:obj2,deps:deps}).result){return Err("SELmustchoosesimilarterms")}else{return OK}},auto:function(_arg){var deps,leftterms,lt,obj1,obj2,rightterms,rt,target,_i,_j,_len,_len1;deps=_arg.deps,target=_arg.target;leftterms=deps.getTerms(target.objs[0]);rightterms=deps.getTerms(target.objs[1]);for(lt=_i=0,_len=leftterms.length;_i<_len;lt=++_i){obj1=leftterms[lt];if(!deps.equal(obj1,zero)){for(rt=_j=0,_len1=rightterms.length;_j<_len1;rt=++_j){obj2=rightterms[rt];if(deps.isKindredSpirits({obj1:obj1,obj2:obj2,deps:deps}).result){return{selection:[[lt],[rt]]}}}}}return Err("AUTOnosimilartermsonbothsidesinrel")},perform:function(o){var addchoices,addsel,n,newpos,sels,side,term,todel,_i,_len,_ref1;sels=o.selection;todel=o.deps.getTerms(o.target.objs[0])[sels[0][0]];o.beforemark(o.target.objs[0].type==="sum"?[0,sels[0][0]]:[0]);o.beforemark(o.target.objs[1].type==="sum"?[1,sels[1][0]]:[1]);o["do"]("addToRelationSides","addmirroroftermtodelete",{direction:"right",argument:Prod(Neg(one),todel)});_ref1=[0,1];for(_i=0,_len=_ref1.length;_i<_len;_i++){side=_ref1[_i];o["try"]("absorbSumTerms","flattenrelsidesum"+side,{aim:[side]});term=sels[side][0];newpos=o.target.objs[side].objs.length-1;addchoices=function(){var _j,_results;_results=[];for(n=_j=0;0<=newpos?_j<=newpos:_j>=newpos;n=0<=newpos?++_j:--_j){_results.push(n===term?"self":n===newpos?"facs":"none")}return _results}();addsel=function(){var _j,_results;_results=[];for(n=_j=0;0<=newpos?_j<=newpos:_j>=newpos;n=0<=newpos?++_j:--_j){_results.push(n===term?[0]:n===newpos?[1]:[])}return _results}();o["do"]("addExpressions","collapsemirrors"+side,{aim:[side],selection:addsel,choices:addchoices});o["try"]("purgeZeroTerms","clearzero",{aim:[side]})}return o}};eliminateSameFacsFromRelationSides={info:{name:"eliminateSameFacsFromRelationSides",effect:"simplifying",example:{str:"(pi)yz=3(pi)",choices:["facs","facs"],selection:[[0],[1]]},uses:["divRelSidesAndFix","eliminateFromFrac"],tags:["remove","relation"]},prints:{errors:["VALmustselectsimilarfacs","AUTOrelationsideshavenocommonfacs"],instructions:["SELleftsidefacs","SELrightsidefacs","CHOfactactforleftside","CHOfactactforrightside"],steps:[]},target:"relation",selection:{questions:[{instruction:"SELleftsidefacs",from:function(o){return o.deps.getFacs(o.target.objs[0],o.choices[0])}},{instruction:"SELrightsidefacs",from:function(o){return o.deps.getFacs(o.target.objs[1],o.choices[1])}}]},choices:{questions:[{instruction:"CHOfactactforleftside",options:function(o){return o.deps.getFacOptions(o.target.objs[0])}},{instruction:"CHOfactactforrightside",options:function(o){return o.deps.getFacOptions(o.target.objs[1])}}]},validate:function(o){var obj1,obj2,_ref1,_ref2;obj1=o.deps.collapseStubList(Prod(o.deps.getFacs(o.target.objs[0],(_ref1=o.choices)!=null?_ref1[0]:void 0).filter(function(i,p){return __indexOf.call(o.selection[0],p)>=0})));obj2=o.deps.collapseStubList(Prod(o.deps.getFacs(o.target.objs[1],(_ref2=o.choices)!=null?_ref2[1]:void 0).filter(function(i,p){return __indexOf.call(o.selection[1],p)>=0})));if(!o.deps.isKindredSpirits(mixin({obj1:obj1,obj2:obj2},o)).result){return Err("VALmustselectsimilarfacs")}else{return OK}},auto:function(o){var choices,denomfac,denomfacpos,denomfacs,denomsel,numerfac,numerfacpos,numerfacs,numersel,used,_i,_j,_k,_len,_len1,_len2,_ref1,_ref2;_ref1=o.deps.fracFacCombos(o);for(_i=0,_len=_ref1.length;_i<_len;_i++){_ref2=_ref1[_i],choices=_ref2[0],numerfacs=_ref2[1],denomfacs=_ref2[2];numersel=[];denomsel=[];for(numerfacpos=_j=0,_len1=numerfacs.length;_j<_len1;numerfacpos=++_j){numerfac=numerfacs[numerfacpos];if(!(!o.deps.equal(numerfac,one)&&!o.deps.equal(numerfac,zero)&&o.deps.newEvalNumVal(numerfac)!==false)){continue}used=false;for(denomfacpos=_k=0,_len2=denomfacs.length;_k<_len2;denomfacpos=++_k){denomfac=denomfacs[denomfacpos];if(!(used||__indexOf.call(denomsel,denomfacpos)>=0)){if(o.deps.isKindredSpirits(mixin({obj1:numerfac,obj2:denomfac},o)).result===true){used=true;numersel.push(numerfacpos);denomsel.push(denomfacpos)}}}}if(numersel.length){return{choices:choices,selection:[numersel,denomsel.sort()]}}}return Err("AUTOrelationsideshavenocommonfacs")},perform:function(o){var choices,sel,sels,side,todestroy,_i,_j,_len,_len1,_ref1,_ref2;choices=o.choices;sels=o.selection;_ref1=[0,1];for(_i=0,_len=_ref1.length;_i<_len;_i++){side=_ref1[_i];_ref2=sels[side];for(_j=0,_len1=_ref2.length;_j<_len1;_j++){sel=_ref2[_j];o.beforemark([side].concat(o.deps.facPath(choices[side]||"facs",sel)))}}todestroy=o.deps.collapseStubList(Prod(o.deps.getFacs(o.target.objs[0],choices[0]).filter(function(fac,n){return __indexOf.call(sels[0],n)>=0})));o["do"]("divRelSidesAndFix","dividerelwithfacstoremove",{argument:todestroy,cheat:true});o["do"]("eliminateFromFrac","eliminateonleftside",{aim:[0],choices:[choices[0],"self"],selection:[sels[0],[0]]});return o["do"]("eliminateFromFrac","eliminateonrightside",{aim:[1],choices:[choices[1],"self"],selection:[sels[1],[0]]})}};eliminateCommonInnerFacsInRel={info:{name:"eliminateCommonInnerFacsInRel",effect:"simplifying",example:{str:"24x=8p",argument:Num(8),choices:["facs","facs"],selection:[[0],[0]]},uses:["divRelSidesAndFix","zeroFacExprToZero","eliminateInnerNumFacsInSumsInFrac"],tags:["relation","remove"]},prints:{errors:["VALnotallchosenfacsdividesbyargument","ARGfacnotcommonnumfacforselections","AUTOrelationsideshavenocommoninnernumfacs"],instructions:["SELnumerfactoshorten","CHOfactacticinleftterm","CHOfactacticinrightterm","ARGentercommoninnerfac"],steps:["dividewithinnerfactoelim","lonezerodividesawayanything","collapseinnerfacsinsidefrac"]},target:"relation",choices:{questions:function(o){var allterms,q,tinfo,_i,_len;allterms=relTermAnalysis(o).nonlonezeroterms;q=[];for(_i=0,_len=allterms.length;_i<_len;_i++){tinfo=allterms[_i];q.push({options:o.deps.getFacOptions(tinfo.term),instruction:"CHOfactacticin"+tinfo.sideword+"term",about:tinfo.path})}return q}},selection:{min:1,filter:"numeric",questions:function(o){var allterms,n,q,qbuilder,_i,_ref1;allterms=relTermAnalysis(o).nonlonezeroterms;qbuilder=function(o){var mychoice,myterm,_ref1;myterm=allterms[o.qnum].term;mychoice=(_ref1=o.choices)!=null?_ref1[o.qnum]:void 0;if(mychoice!=="none"){return o.deps.getFacs(myterm,mychoice)}else{return[]}};q=[];for(n=_i=0,_ref1=allterms.length;0<=_ref1?_i<_ref1:_i>_ref1;n=0<=_ref1?++_i:--_i){q.push({instruction:"SELnumerfactoshorten",from:qbuilder})}return q}},argument:{instruction:"ARGentercommoninnerfac",type:"number"},validate:function(o){var fac,n,term,terms,tinfo,_i,_len;terms=function(){var _i,_len,_ref1,_results;_ref1=relTermAnalysis(o).nonlonezeroterms;_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){tinfo=_ref1[_i];_results.push(tinfo.term)}return _results}();for(n=_i=0,_len=terms.length;_i<_len;n=++_i){term=terms[n];fac=o.deps.lookUp(term,o.deps.facPath(o.choices[n],o.selection[n][0]));if(o.deps.equal(one,o.deps.findLargestCommonDivisor(fac,o.argument))){return Err("VALnotallchosenfacsdividesbyargument")}}return OK},auto:function(o){var analysis,chain,divisor,founddivs,foundhere,matchall,matches,n,ret,sourcechoice,sourcefac,sourceposs,sourcepossid,sourceresidue,sourcesels,stillhoping,targetchoice,targetfac,targetposs,targetpossid,targetremains,targetsels,targetterm,termnums,terms,testagainst,tinfo,used,_i,_j,_k,_l,_len,_len1,_len2,_ref1,_ref2;terms=function(){var _i,_len,_ref1,_results;_ref1=relTermAnalysis(o).nonlonezeroterms;_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){tinfo=_ref1[_i];_results.push(tinfo.term)}return _results}();termnums=terms.length;analysis=function(){var _i,_results;_results=[];for(n=_i=0;0<=termnums?_i<termnums:_i>termnums;n=0<=termnums?++_i:--_i){_results.push(o.deps.getFacPossibilities(mixin({oneatatime:true,obj:terms[n]},o)))}return _results}();used={};matches=[];founddivs=[];if(termnums>1){_ref1=analysis[0];for(sourcepossid=_i=0,_len=_ref1.length;_i<_len;sourcepossid=++_i){sourceposs=_ref1[sourcepossid];sourcechoice=sourceposs[0],sourcesels=sourceposs[1],sourcefac=sourceposs[2],sourceresidue=sourceposs[3];if(sourcefac.type==="number"||sourceresidue.length&&o.deps.isNumeric(sourcefac)){sourcefac=o.deps.digIfNeg(sourcefac);chain=[sourcefac];stillhoping=true;founddivs=[];ret={selection:[sourcesels],choices:[sourcechoice]};for(targetterm=_j=1;1<=termnums?_j<termnums:_j>termnums;targetterm=1<=termnums?++_j:--_j){if(!stillhoping){continue}foundhere=0;_ref2=analysis[targetterm];for(targetpossid=_k=0,_len1=_ref2.length;_k<_len1;targetpossid=++_k){targetposs=_ref2[targetpossid];if(!!foundhere){continue}targetchoice=targetposs[0],targetsels=targetposs[1],targetfac=targetposs[2],targetremains=targetposs[3];if(targetfac.type==="number"||targetremains.length&&o.deps.isNumeric(targetfac)){matchall=true;for(_l=0,_len2=chain.length;_l<_len2;_l++){testagainst=chain[_l];if(!matchall){continue}divisor=o.deps.findLargestCommonDivisor(testagainst,o.deps.digIfNeg(targetfac));if(o.deps.equal(divisor,one)){matchall=false}}if(matchall){chain.push(targetfac);foundhere=1;ret.selection.push(targetsels);ret.choices.push(targetchoice);founddivs.push(divisor)}}}if(!foundhere){stillhoping=false}}if(stillhoping){ret.argument=founddivs.sort(function(o1,o2){if(parseFloat(o1.val)<parseFloat(o2.val)){return-1}else{return 1}})[0];return ret}}}}return Err("AUTOrelationsideshavenocommoninnernumfacs")},perform:function(o){var arg,basepath,choices,fac,mychoices,mysels,n,path,reltermsanalysis,sel,sels,side,tinfo,_i,_j,_len,_ref1,_ref2;sels=o.selection;choices=o.choices;arg=o.argument;reltermsanalysis=o.deps.relTermAnalysis(o);for(n=_i=0,_ref1=sels.length;0<=_ref1?_i<_ref1:_i>_ref1;n=0<=_ref1?++_i:--_i){tinfo=reltermsanalysis.nonlonezeroterms[n];sel=sels[n][0];basepath=tinfo.path;path=basepath.concat(o.deps.facPath(choices[n],sel));fac=o.deps.lookUp(o.target,path);o.beforemark(path);if(!o.deps.equal(fac,arg)){o.aftermark(path)}}o["do"]("divRelSidesAndFix","dividewithinnerfactoelim",{argument:arg,cheat:true});_ref2=[0,1];for(_j=0,_len=_ref2.length;_j<_len;_j++){side=_ref2[_j];if(reltermsanalysis.sides[side].islonezero){o["do"]("zeroFacExprToZero","lonezerodividesawayanything",{aim:[side],choices:["numerself"],selection:[[0]]})}else{mysels=function(){var _k,_len1,_ref3,_results;_ref3=reltermsanalysis.sides[side].range;_results=[];for(_k=0,_len1=_ref3.length;_k<_len1;_k++){n=_ref3[_k];_results.push(sels[n])}return _results}();mychoices=function(){var _k,_len1,_ref3,_results;_ref3=reltermsanalysis.sides[side].range;_results=[];for(_k=0,_len1=_ref3.length;_k<_len1;_k++){n=_ref3[_k];_results.push(choices[n])}return _results}();o["do"]("eliminateInnerNumFacsInSumsInFrac","collapseinnerfacsinsidefrac",{aim:[side],argument:arg,selection:mysels.concat([[0]]),choices:mychoices.concat(["self"])})}}return o}};collapseNegationsInSumsInRelation={info:{name:"collapseNegationsInSumsInRelation",effect:"simplifying",example:{str:"((y*-x-p)=-x)",choices:["facs","self","self"],selection:[[1],[0],[0]]},uses:["divRelSidesAndFix","zeroFacExprToZero","collapseNegationsInSumsInFrac"],tags:["relation","negation"],lesson:"relationmanip"},prints:{errors:["AUTOnotalltermsinrelationsideshavenegs"],steps:["dividewithnegonetoelim","lonezerodividesawayanything","collapsenegsinsidefrac"],instructions:["CHOfactacticinleftterm","CHOfactacticinrightterm","SELnegfactocollapse"]},target:{type:"relation"},choices:{questions:function(o){var allterms,q,tinfo,_i,_len;allterms=relTermAnalysis(o).nonlonezeroterms;q=[];for(_i=0,_len=allterms.length;_i<_len;_i++){tinfo=allterms[_i];q.push({options:o.deps.getFacOptions(tinfo.term,true,true),instruction:"CHOfactacticin"+tinfo.sideword+"term",about:tinfo.path})}return q}},selection:{min:1,filter:"negation",questions:function(o){var allterms,n,q,qbuilder,_i,_ref1;allterms=relTermAnalysis(o).nonlonezeroterms;qbuilder=function(o){var mychoice,myterm,_ref1;myterm=allterms[o.qnum].term;mychoice=(_ref1=o.choices)!=null?_ref1[o.qnum]:void 0;if(mychoice!=="none"){return o.deps.getFacs(myterm,mychoice)}else{return[]}};q=[];for(n=_i=0,_ref1=allterms.length;0<=_ref1?_i<_ref1:_i>_ref1;n=0<=_ref1?++_i:--_i){q.push({instruction:"SELnegfactocollapse",from:qbuilder})}return q}},auto:function(o){var analysis,n,negposs,ret,termnums,terms,tinfo,_i;terms=function(){var _i,_len,_ref1,_results;_ref1=relTermAnalysis(o).nonlonezeroterms;_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){tinfo=_ref1[_i];_results.push(tinfo.term)}return _results}();termnums=terms.length;analysis=function(){var _i,_results;_results=[];for(n=_i=0;0<=termnums?_i<termnums:_i>termnums;n=0<=termnums?++_i:--_i){_results.push(o.deps.getFacPossibilities(mixin({oneatatime:true,nonegdig:true,allowdenom:true,obj:terms[n]},o)))}return _results}();ret={selection:[],choices:[]};for(n=_i=0;0<=termnums?_i<termnums:_i>termnums;n=0<=termnums?++_i:--_i){negposs=analysis[n].filter(function(poss){return poss[2].type==="negation"});if(negposs.length){ret.selection.push(negposs[0][1]);ret.choices.push(negposs[0][0])}else{return Err("AUTOnotalltermsinrelationsideshavenegs")}}return ret},perform:function(o){var basepath,choices,mychoices,mysels,n,path,reltermsanalysis,sel,sels,side,tinfo,_i,_j,_len,_ref1,_ref2;sels=o.selection;choices=o.choices;reltermsanalysis=o.deps.relTermAnalysis(o);for(n=_i=0,_ref1=sels.length;0<=_ref1?_i<_ref1:_i>_ref1;n=0<=_ref1?++_i:--_i){tinfo=reltermsanalysis.nonlonezeroterms[n];sel=sels[n][0];basepath=tinfo.path;path=basepath.concat(o.deps.facPath(choices[n],sel));o.beforemark(path);o.aftermark(path)}o["do"]("divRelSidesAndFix","dividewithnegonetoelim",{argument:Neg(one)});_ref2=[0,1];for(_j=0,_len=_ref2.length;_j<_len;_j++){side=_ref2[_j];if(reltermsanalysis.sides[side].islonezero){o["do"]("zeroFacExprToZero","lonezerodividesawayanything"+side,{aim:[side],choices:["numerself"],selection:[[0]],assuming:"relation"})}else{mysels=function(){var _k,_len1,_ref3,_results;_ref3=reltermsanalysis.sides[side].range;_results=[];for(_k=0,_len1=_ref3.length;_k<_len1;_k++){n=_ref3[_k];_results.push(sels[n])}return _results}();mychoices=function(){var _k,_len1,_ref3,_results;_ref3=reltermsanalysis.sides[side].range;_results=[];for(_k=0,_len1=_ref3.length;_k<_len1;_k++){n=_ref3[_k];_results.push(choices[n])}return _results}();o["do"]("collapseNegationsInSumsInFrac","collapsenegsinsidefrac"+side,{aim:[side],assuming:"relation",selection:mysels.concat([[0]]),choices:mychoices.concat(["self"])})}}return o}};mergeNumFracFacOnOppRelSides={info:{name:"mergeNumFracFacOnOppRelSides",effect:"simplifying",example:{str:"4x=p/3",choices:["facs","denomself"],direction:"right",selection:[[0],[0]]},tags:["relation","merge","fraction","denominator"],uses:["extractFacsFromExpression","moveNegFromFracToFloorFac","multRelSidesAndFix","absorbProductFacs","multiplyAllNumFacs","multFacsIntoFrac","eliminateFromFrac"]},prints:{instructions:["DIRchoosedenomside","SELleftsidenumfac","SELrightsidenumfac"],errors:["TARonesidemustbefrac","AUTOnosidedividednumfracpair"]},direction:{instruction:"DIRchoosedenomside"},target:{type:"relation",validate:function(o){if(o.deps.digIfNeg(o.target.objs[0]).type!=="fraction"&&o.deps.digIfNeg(o.target.objs[1]).type!=="fraction"){return Err("TARonesidemustbefrac")}else{return OK}}},choices:{questions:[{options:function(o){return o.deps.getUnitFacOpts(o.target.objs[0],o.direction!=="right")}},{options:function(o){return o.deps.getUnitFacOpts(o.target.objs[1],o.direction==="right")}}]},selection:{filter:"numeric",questions:[{instruction:"SELleftsidenumfac",from:function(o){return o.deps.getFacs(o.target.objs[0],o.choices[0])}},{instruction:"SELrightsidenumfac",from:function(o){return o.deps.getFacs(o.target.objs[1],o.choices[1])}}]},auto:function(o){var fracside,leftchoice,leftnumpos,leftsidefacs,rightchoice,rightnumpos,rightsidefacs,_i,_j,_k,_len,_ref1,_ref2,_ref3,_results,_results1;_ref1=[0,1];for(_i=0,_len=_ref1.length;_i<_len;_i++){fracside=_ref1[_i];if(o.deps.digIfNeg(o.target.objs[fracside]).type==="fraction"){leftchoice=o.deps.getUnitFacOpts(o.target.objs[0],fracside===0)[0];leftsidefacs=o.deps.getFacs(o.target.objs[0],leftchoice);leftnumpos=function(){_results=[];for(var _j=0,_ref2=leftsidefacs.length;0<=_ref2?_j<_ref2:_j>_ref2;0<=_ref2?_j++:_j--){_results.push(_j)}return _results}.apply(this).filter(function(n){return o.deps.isNumeric(leftsidefacs[n])});if(leftnumpos.length){rightchoice=o.deps.getUnitFacOpts(o.target.objs[1],fracside===1)[0];rightsidefacs=o.deps.getFacs(o.target.objs[1],rightchoice);rightnumpos=function(){_results1=[];for(var _k=0,_ref3=rightsidefacs.length;0<=_ref3?_k<_ref3:_k>_ref3;0<=_ref3?_k++:_k--){_results1.push(_k)}return _results1}.apply(this).filter(function(n){return o.deps.isNumeric(rightsidefacs[n])});if(rightnumpos.length){return{direction:fracside===0?"left":"right",choices:[leftchoice,rightchoice],selection:[[leftnumpos[0]],[rightnumpos[0]]]}}}}}return Err("AUTOnosidedividednumfracpair")},perform:function(o){var choices,denomchoice,denomside,numerchoice,otherside,sels,side,toremove,_i,_len,_ref1;sels=o.selection;choices=o.choices;denomside=o.dirnum();otherside=o.oppdirnum();toremove=o.deps.getFacs(o.target.objs[denomside],choices[denomside])[sels[denomside][0]];denomchoice=choices[denomside].replace(/denom/,"");_ref1=[0,1];for(_i=0,_len=_ref1.length;_i<_len;_i++){side=_ref1[_i];o.beforemark([side].concat(o.deps.facPath(choices[side],sels[side][0])))}if(choices[otherside]!=="self"){o["do"]("extractFacsFromExpression","digoutnum",{aim:[otherside],choices:[choices[otherside]],selection:[sels[otherside]],direction:"right"})}if(o.target.objs[denomside].type==="negation"){denomchoice=denomchoice.replace(/negchild/,"");o["do"]("moveNegFromFracToFloorFac","movenegtonum",{aim:[denomside],choices:["denom",denomchoice],selection:[sels[denomside]]});toremove=Neg(toremove)}o["do"]("multRelSidesAndFix","multwithnumtorid",{argument:toremove,direction:"left",cheat:true});if(choices[otherside]!=="self"){o["do"]("absorbProductFacs","flattenrelsideprod",{aim:[otherside],selection:[[1]]})}o["try"]("multiplyAllNumFacs","multnumsonnondenomside",{aim:[otherside]});o["do"]("multFacsIntoFrac","multnumintofrac",{aim:[denomside],selection:[[1],[0]]});numerchoice=o.target.objs[denomside].objs[0].type==="product"?"facs":"self";return o["do"]("eliminateFromFrac","killnumondenomside",{aim:[denomside],selection:[[0],sels[denomside]],choices:[numerchoice,denomchoice]})}};solveEqWithNoConstant={info:{name:"solveEqWithNoConstant",effect:"simplifying",example:{str:"px+x2=0",choices:["facs","self","none"],selection:[[1],[0],[]],argument:[x,one]},uses:["extractPartFromPow","absorbProductFacs","extractFacsFromExpression","moveTermsBetweenSidesInRel","extractFacsFromTerms","zeroProdMethod"],tags:["relation"],lesson:"equationsolve"},prints:{errors:["TARmustbezeroeqsum","VALnotallchosenfacssharebase","AUTOmustcontainsamebasefacs"],instructions:["ARGexptoremovefromcommonbases","SELcommonbasetoextract","CHOfactactic"],steps:["extractthecommonpartfrompow","flattentermprod","extractcommonfac","turntozeroprod"]},target:"equality",argument:{instruction:"ARGexptoremovefromcommonbases"},choices:{questions:function(o){var leftterms,n,okzero,path,rightterms,term,terms,_i,_len,_results;leftterms=o.deps.getTerms(o.target.objs[0]);rightterms=o.deps.getTerms(o.target.objs[1]);
terms=leftterms.concat(rightterms);if(o.deps.equal(o.target.objs[0],zero)){okzero=0}else if(o.deps.equal(o.target.objs[1],zero)){okzero=leftterms.length}_results=[];for(n=_i=0,_len=terms.length;_i<_len;n=++_i){term=terms[n];path=n===0&&leftterms.length===1?[0]:n<leftterms.length?[0,n]:rightterms.length===1?[1]:[1,n-leftterms.length];_results.push({options:n===okzero?["none"]:o.deps.getFacOptions(term,true),instruction:"CHOfactactic",about:path})}return _results}},selection:{max:1,questions:function(o){var leftterms,n,okzero,rightterms,term,terms,_i,_len,_results;leftterms=o.deps.getTerms(o.target.objs[0]);rightterms=o.deps.getTerms(o.target.objs[1]);terms=leftterms.concat(rightterms);if(o.deps.equal(o.target.objs[0],zero)){okzero=0}else if(o.deps.equal(o.target.objs[1],zero)){okzero=leftterms.length}_results=[];for(n=_i=0,_len=terms.length;_i<_len;n=++_i){term=terms[n];if(n===okzero){_results.push({options:[],or0:true})}else{_results.push({instruction:"SELcommonbasetoextract",from:function(t,num){return function(i){return o.deps.getFacs(t,i.choices[num])}}(term,n)})}}return _results}},validate:function(o){var fac,facs,n,term,terms,_i,_len;terms=o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]));facs=function(){var _i,_len,_results;_results=[];for(n=_i=0,_len=terms.length;_i<_len;n=++_i){term=terms[n];if(!o.deps.equal(term,zero)){_results.push(o.deps.lookUp(term,o.deps.facPath(o.choices[n],o.selection[n][0])))}}return _results}();for(n=_i=0,_len=facs.length;_i<_len;n=++_i){fac=facs[n];if(!o.deps.equal(o.argument[0],o.deps.getBase(fac))){return Err("VALnotallchosenfacssharebase")}}return OK},auto:function(o){var foundexps,foundhere,leftterms,lookat,n,okzero,ret,rightterms,sourceanalysis,sourcebase,sourcechoice,sourceexp,sourcefac,sourceposition,sourceposs,sourcepossid,sourceresidue,sourcesels,stillhoping,targetanalysis,targetbase,targetchoice,targetexp,targetfac,targetposition,targetposs,targetpossid,targetremains,targetsels,terms,_i,_j,_k,_len,_len1,_len2,_ref1,_ref2,_ref3;leftterms=o.deps.getTerms(o.target.objs[0]);rightterms=o.deps.getTerms(o.target.objs[1]);terms=leftterms.concat(rightterms);if(o.deps.equal(o.target.objs[0],zero)){okzero=0}else if(o.deps.equal(o.target.objs[1],zero)){okzero=leftterms.length}lookat=function(){var _i,_ref1,_results;_results=[];for(n=_i=0,_ref1=terms.length;0<=_ref1?_i<_ref1:_i>_ref1;n=0<=_ref1?++_i:--_i){if(n!==okzero){_results.push(n)}}return _results}();foundexps=[];if(lookat.length>1){sourceposition=lookat[0];sourceanalysis=o.deps.getFacPossibilities(mixin({oneatatime:true,allowdenom:false,obj:terms[sourceposition]},o));for(sourcepossid=_i=0,_len=sourceanalysis.length;_i<_len;sourcepossid=++_i){sourceposs=sourceanalysis[sourcepossid];sourcechoice=sourceposs[0],sourcesels=sourceposs[1],sourcefac=sourceposs[2],sourceresidue=sourceposs[3];_ref1=sourcefac.type==="power"?sourcefac.objs:[sourcefac,one],sourcebase=_ref1[0],sourceexp=_ref1[1];if(Object.keys(o.deps.varDependency(sourcebase)).length){foundexps=[sourceexp];ret={argument:[sourcebase],selection:[sourcesels],choices:[sourcechoice]};stillhoping=true;_ref2=lookat.slice(1);for(_j=0,_len1=_ref2.length;_j<_len1;_j++){targetposition=_ref2[_j];if(!stillhoping){continue}foundhere=0;targetanalysis=o.deps.getFacPossibilities(mixin({oneatatime:true,allowdenom:false,obj:terms[targetposition]},o));for(targetpossid=_k=0,_len2=targetanalysis.length;_k<_len2;targetpossid=++_k){targetposs=targetanalysis[targetpossid];if(!!foundhere){continue}targetchoice=targetposs[0],targetsels=targetposs[1],targetfac=targetposs[2],targetremains=targetposs[3];_ref3=targetfac.type==="power"?targetfac.objs:[targetfac,one],targetbase=_ref3[0],targetexp=_ref3[1];if(o.deps.equal(sourcebase,targetbase)){foundhere=1;ret.selection.push(targetsels);ret.choices.push(targetchoice);foundexps.push(targetexp)}}if(!foundhere){stillhoping=false}}if(stillhoping){ret.argument.push(foundexps.sort(function(o1,o2){if(!o1.val){return 1}else if(!o2.val){return-1}else if(parseFloat(o1.val)<parseFloat(o2.val)){return-1}else{return 1}})[0]);if(okzero===0){ret.selection=[[]].concat(ret.selection);ret.choices=["none"].concat(ret.choices)}else if(okzero){ret.selection.push([]);ret.choices.push("none")}return ret}}}}return Err("AUTOmustcontainsamebasefacs")},perform:function(o){var alldata,base,choices,d,denom,exp,fac,facpath,iamneg,leftterms,me,movefrom,movefromdata,moveto,movetodata,n,negonleft,negonright,onleft,onright,rightterms,sels,side,term,termpath,terms,tnum,want,_i,_j,_k,_l,_len,_len1,_ref1,_ref2,_ref3,_ref4,_ref5,_results;_ref1=o.argument,base=_ref1[0],exp=_ref1[1];sels=o.selection;choices=o.choices;leftterms=o.deps.getTerms(o.target.objs[0]);rightterms=o.deps.getTerms(o.target.objs[1]);terms=leftterms.concat(rightterms);onleft=[];onright=[];negonleft=0;negonright=0;tnum=-1;for(n=_i=0,_len=terms.length;_i<_len;n=++_i){term=terms[n];if(!(choices[n]!=="none")){continue}tnum++;termpath=n===0&&leftterms.length===1?[0]:n<leftterms.length?[0,n]:rightterms.length===1?[1]:[1,n-leftterms.length];facpath=o.deps.facPath(choices[n],sels[n][0]);fac=o.deps.lookUp(term,facpath);o.beforemark(termpath.concat(facpath.concat(fac.type==="power"?[0]:[])));if(choices[n].slice(0,5)==="denom"||choices[n].slice(0,13)==="negchilddenom"){denom=true;want=Neg(exp)}else{want=exp}if(!o.deps.equal(want,o.deps.getExp(fac))){o["do"]("extractPartFromPow","extractthecommonpartfrompow",{aim:termpath.concat(facpath),argument:want,direction:"left"});o["try"]("absorbProductFacs","flattentermprod",{aim:termpath.concat(facpath.slice(0,-1))});choices[n]=o.deps.toProdPath(choices[n])}o.doIf("extractFacsFromExpression","pickoutvar",{aim:termpath,choices:[choices[n]],selection:[sels[n]],direction:"left"});o["try"]("oneExpPowerToBase","flatten",{aim:termpath.concat([0])});choices[n]="facs";sels[n]=[0];iamneg=choices[n].slice(0,3)==="neg";me={num:tnum,sidetermnum:termpath.length===1?0:termpath[1],side:termpath[0],sel:[0],choice:choices[n],isneg:iamneg};if(termpath[0]===0){onleft.push(me);if(iamneg){negonleft++}}else{onright.push(me);if(iamneg){negonright++}}}if(onleft.length&&onright.length){_ref2=negonleft>negonright||onleft.length<onright.length?[0,1]:[1,0],movefrom=_ref2[0],moveto=_ref2[1];_ref3=movefrom===0?[onleft,onright]:[onright,onleft],movefromdata=_ref3[0],movetodata=_ref3[1];o["do"]("moveTermsBetweenSidesInRel","movetosame",{selection:[[movefrom],function(){_results=[];for(var _j=0,_ref4=o.deps.getTerms(o.target.objs[movefrom]).length;0<=_ref4?_j<_ref4:_j>_ref4;0<=_ref4?_j++:_j--){_results.push(_j)}return _results}.apply(this)],direction:"right"});for(_k=0,_len1=movefromdata.length;_k<_len1;_k++){d=movefromdata[_k];d.choice=d.isneg?o.deps.toPosPath(d.choice):o.deps.toNegPath(d.choice)}alldata=movetodata.concat(movefromdata);side=moveto}else{side=onleft.length?0:1;alldata=onleft.concat(onright)}sels=function(){var _l,_len2,_results1;_results1=[];for(_l=0,_len2=alldata.length;_l<_len2;_l++){d=alldata[_l];_results1.push(d.sel)}return _results1}();choices=function(){var _l,_len2,_results1;_results1=[];for(_l=0,_len2=alldata.length;_l<_len2;_l++){d=alldata[_l];_results1.push(d.choice)}return _results1}();o["do"]("extractFacsFromTerms","extractcommonfac",{aim:[side],selection:sels,choices:choices});o["do"]("zeroProdMethod","turntozeroprod");for(n=_l=0,_ref5=o.target.objs[1].objs[0].objs.length;0<=_ref5?_l<_ref5:_l>_ref5;n=0<=_ref5?++_l:--_l){o["try"]("collapseDoubleNeg","cleanup",{aim:[1,0,n]})}return o}};solveQuadHiddenInHigher={info:{name:"solveQuadHiddenInHigher",effect:"simplifying",example:{str:"x4-2=3x2",selection:[[0],[0],[0],[1],[0],[1]],choices:["self","facs"],argument:x},uses:["substitute","solveQuadraticEquation","addNewVar","numToProd","prodExpPowToPowBase"]},prints:{errors:["ARGnottwodeps","ARGnotnumexps","ARGnotdoubleexps"],instructions:[]},target:"relation",argument:{type:"variable",instruction:"ARGvartosolvefor",validate:function(o){var exps,first,second;exps=o.deps.varDependency(o.target)[o.argument.val];if(exps.length!==2){return Err("ARGnottwodeps")}else if(exps[0].type!=="number"||exps[1].type!=="number"){return Err("ARGnotnumexps")}else{first=parseFloat(exps[0].val);second=parseFloat(exps[1].val);if(first!==Math.floor(first)||second!==Math.floor(second)||first<=1||second<=1){return Err("ARGexpsmustbeintegersabove1")}else if(!(first===2*second||second===2*first)){return Err("ARGnotdoubleexps")}else{return OK}}}},selection:{max:1,questions:[{instruction:"SELpowside"},{instruction:"SELpowpos",from:function(o){return o.deps.getTerms(o.target.objs[o.selection[0][0]])},filter:function(o){var exps;exps=o.deps.varDependency(o.item)[o.argument.val]||[];if(exps.length!==1||exps[0].type!=="number"){return Err("SELnotcorrectvardep")}else{return OK}}},{instruction:"SELpowfac",filter:function(o){if(o.item.type==="power"&&o.deps.equal(o.item.objs[0],o.argument)&&o.item.objs[1].type==="number"){return OK}else{return Err("SELnotvar")}},from:function(o){var term,terms;terms=o.deps.getTerms(o.target.objs[o.selection[0][0]]);term=terms[o.selection[1][0]];return o.deps.getFacs(term,o.choices[0])}},{instruction:"SELvarside"},{instruction:"SELvarpos",from:function(o){return o.deps.getTerms(o.target.objs[o.selection[3][0]])},filter:function(o){var exps;exps=o.deps.varDependency(o.item)[o.argument.val]||[];if(exps.length!==1||exps[0].type!=="number"){return Err("SELnotcorrectvardep")}else{return OK}}},{instruction:"SELvarfac",filter:function(o){if(o.item.type==="power"&&o.deps.equal(o.item.objs[0],o.argument)&&o.item.objs[1].type==="number"){return OK}else{return Err("SELnotvar")}},from:function(o){var term,terms;terms=o.deps.getTerms(o.target.objs[o.selection[3][0]]);term=terms[o.selection[4][0]];return o.deps.getFacs(term,o.choices[1])}}]},choices:{questions:[{instruction:"CHOpowfactactic",options:function(o){var term;term=o.deps.getTerms(o.target.objs[o.selection[0][0]])[o.selection[1][0]];return o.deps.getFacOptions(term,false,false,false)}},{instruction:"CHOvarfactactic",options:function(o){var term;term=o.deps.getTerms(o.target.objs[o.selection[3][0]])[o.selection[4][0]];return o.deps.getFacOptions(term,false,false,false)}}]},auto:function(o){var allpowpos,allterms,allvarpos,bigpower,exps,first,left,leftterms,powchoice,powpath,powpos,powside,powterm,rightterms,second,smallpower,solvevar,varchoice,vardeps,varname,varpath,varpos,varside,varterm,_i,_j,_len,_len1,_ref1;leftterms=o.deps.getTerms(o.target.objs[0]);rightterms=o.deps.getTerms(o.target.objs[1]);allterms=o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]));left=leftterms.length;vardeps=o.deps.varDependency(o.target);for(varname in vardeps){exps=vardeps[varname];if(!(exps.length===2&&exps[0].type==="number"&&exps[1].type==="number")){continue}first=parseFloat(exps[0].val);second=parseFloat(exps[1].val);_ref1=first<second?[second,first]:[first,second],first=_ref1[0],second=_ref1[1];if(first===Math.floor(first)&&second===Math.floor(second)&&first===second*2){solvevar={type:"variable",val:varname};bigpower=Pow(solvevar,Num(first));smallpower=Pow(solvevar,Num(second));for(allpowpos=_i=0,_len=allterms.length;_i<_len;allpowpos=++_i){powterm=allterms[allpowpos];powpath=o.deps.findPathTo(powterm,bigpower);if(powpath){powchoice=o.deps.pathToChoice(powterm,powpath,true);if(powchoice){powside=allpowpos>=left?1:0;powpos=allpowpos-(powside?left:0);for(allvarpos=_j=0,_len1=allterms.length;_j<_len1;allvarpos=++_j){varterm=allterms[allvarpos];if(!(allvarpos!==allpowpos)){continue}varpath=o.deps.findPathTo(varterm,smallpower);if(varpath){varchoice=o.deps.pathToChoice(varterm,varpath,true);if(varchoice){varside=allvarpos>=left?1:0;varpos=allvarpos-(varside?left:0);return{argument:solvevar,selection:[[powside],[powpos],powpath.slice(-1).length?powpath.slice(-1):[0],[varside],[varpos],varpath.slice(-1).length?varpath.slice(-1):[0]],choices:[powchoice,varchoice]}}}}}}}}}return Err("AUTOnovarstosolvefor")},perform:function(o){var adder,basename,bigpowpath,choices,deps,exp,newpath,newvar,newvarname,powpos,powsel,powside,smallpowpath,solvevar,varsel,varside,vartermpos,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7;_ref1=o.selection,_ref2=_ref1[0],powside=_ref2[0],_ref3=_ref1[1],powpos=_ref3[0],_ref4=_ref1[2],powsel=_ref4[0],_ref5=_ref1[3],varside=_ref5[0],_ref6=_ref1[4],vartermpos=_ref6[0],_ref7=_ref1[5],varsel=_ref7[0];choices=o.choices;bigpowpath=[powside].concat(o.target.objs[powside].type==="sum"?powpos:[]).concat(o.deps.facPath(o.choices[0],powsel));smallpowpath=[varside].concat(o.target.objs[varside].type==="sum"?vartermpos:[]).concat(o.deps.facPath(o.choices[1],varsel));exp=o.deps.lookUp(o.target,smallpowpath).objs[1];solvevar=o.argument;o["do"]("numToProd","splitbigexp",{aim:bigpowpath.concat(1),argument:Prod(exp,two)});o["do"]("prodExpPowToPowBase","buildsquarepow",{aim:bigpowpath,selection:[[1]]});basename=newvarname="t";deps=o.deps.varDependency(o.before||o.target);adder=0;while(deps[newvarname]){newvarname=basename+adder++}newvar={type:"variable",val:newvarname};o["do"]("addNewVar","introducevar",{direction:"right",argument:[newvar,Pow(solvevar,exp)]});o["do"]("substitute","changebig",{selection:[[1],[0]],direction:"right",hunt:[bigpowpath.concat(0)],choices:["keep"]});o["do"]("substitute","changesmall",{selection:[[1],[0]],direction:"right",hunt:[smallpowpath],choices:["keep"]});o["do"]("solveQuadraticEquation","nowsolve",{aim:[0],choices:choices,selection:[[powside],[powpos],[powsel],[varside],[vartermpos],[varsel]],argument:newvar});newpath=[o.target.objs[0].objs[0].type==="variable"?0:1];return o["do"]("substitute","changeback",{selection:[[1],[0]],direction:"left",hunt:[newpath],choices:["skip"]})}};solveQuadHiddenInRoot={info:{name:"solveQuadHiddenInRoot",effect:"simplifying",example:{str:"x-2=3sqrtx",selection:[[0],[0],[0],[1],[0],[1]],choices:["self","facs"],argument:x},target:"relation",uses:["objToRootProd","mergeSameBaseFacs","addNewVar","substitute","solveQuadraticEquation"]},target:"equality",argument:{type:"variable",instruction:"ARGvartosolvefor",validate:function(o){var exps;exps=o.deps.varDependency(o.target)[o.argument.val];if(exps.length!==2){return Err("ARGnottwodeps")}else if(!(o.deps.equal(exps[0],one)&&o.deps.equal(exps[1],one))){return Err("ARGexpsmustbeintegersabove1")}else{return OK}}},selection:{max:1,questions:[{instruction:"SELpowside"},{instruction:"SELpowpos",from:function(o){return o.deps.getTerms(o.target.objs[o.selection[0][0]])},filter:function(o){var exps;exps=o.deps.varDependency(o.item)[o.argument.val]||[];if(exps.length!==1||!o.deps.equal(exps[0],one)){return Err("SELnotcorrectvardep")}else{return OK}}},{instruction:"SELpowfac",filter:function(o){if(o.deps.equal(o.item,o.argument)){return OK}else{return Err("SELnotvar")}},from:function(o){var term,terms;terms=o.deps.getTerms(o.target.objs[o.selection[0][0]]);term=terms[o.selection[1][0]];return o.deps.getFacs(term,o.choices[0])}},{instruction:"SELvarside"},{instruction:"SELvarpos",from:function(o){return o.deps.getTerms(o.target.objs[o.selection[3][0]])},filter:function(o){var exps;exps=o.deps.varDependency(o.item)[o.argument.val]||[];if(exps.length!==1||!o.deps.equal(exps[0],one)){return Err("SELnotcorrectvardep")}else{return OK}}},{instruction:"SELvarfac",filter:function(o){if(o.deps.equal(o.item,Sqrt(o.argument))){return OK}else{return Err("SELnotrootvar")}},from:function(o){var term,terms;terms=o.deps.getTerms(o.target.objs[o.selection[3][0]]);term=terms[o.selection[4][0]];return o.deps.getFacs(term,o.choices[1])}}]},choices:{questions:[{instruction:"CHOpowfactactic",options:function(o){var term;term=o.deps.getTerms(o.target.objs[o.selection[0][0]])[o.selection[1][0]];return o.deps.getFacOptions(term,false,false,false)}},{instruction:"CHOvarfactactic",options:function(o){var term;term=o.deps.getTerms(o.target.objs[o.selection[3][0]])[o.selection[4][0]];return o.deps.getFacOptions(term,false,false,false)}}]},auto:function(o){var allpowpos,allterms,allvarpos,exps,left,leftterms,powchoice,powpath,powpos,powside,powterm,rightterms,rootvar,solvevar,varchoice,vardeps,varname,varpath,varpos,varside,varterm,_i,_j,_len,_len1;leftterms=o.deps.getTerms(o.target.objs[0]);rightterms=o.deps.getTerms(o.target.objs[1]);allterms=o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]));left=leftterms.length;vardeps=o.deps.varDependency(o.target);one={type:"number",val:"1"};for(varname in vardeps){exps=vardeps[varname];if(!(exps.length===2&&o.deps.equal(exps[0],one)&&o.deps.equal(exps[1],one))){continue}solvevar={type:"variable",val:varname};rootvar=Sqrt(solvevar);for(allpowpos=_i=0,_len=allterms.length;_i<_len;allpowpos=++_i){powterm=allterms[allpowpos];powpath=o.deps.findPathTo(powterm,solvevar);if(powpath){powchoice=o.deps.pathToChoice(powterm,powpath,true);if(powchoice){powside=allpowpos>=left?1:0;powpos=allpowpos-(powside?left:0);for(allvarpos=_j=0,_len1=allterms.length;_j<_len1;allvarpos=++_j){varterm=allterms[allvarpos];if(!(allvarpos!==allpowpos)){continue}varpath=o.deps.findPathTo(varterm,rootvar);if(varpath){varchoice=o.deps.pathToChoice(varterm,varpath,true);if(varchoice){varside=allvarpos>=left?1:0;varpos=allvarpos-(varside?left:0);return{argument:solvevar,selection:[[powside],[powpos],powpath.slice(-1).length?powpath.slice(-1):[0],[varside],[varpos],varpath.slice(-1).length?varpath.slice(-1):[0]],choices:[powchoice,varchoice]}}}}}}}}return Err("AUTOnovarstosolvefor")},perform:function(o){var adder,basename,bigpowpath,choices,deps,exp,newpath,newvar,newvarname,powpos,powsel,powside,smallpowpath,solvevar,varsel,varside,vartermpos,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7;_ref1=o.selection,_ref2=_ref1[0],powside=_ref2[0],_ref3=_ref1[1],powpos=_ref3[0],_ref4=_ref1[2],powsel=_ref4[0],_ref5=_ref1[3],varside=_ref5[0],_ref6=_ref1[4],vartermpos=_ref6[0],_ref7=_ref1[5],varsel=_ref7[0];choices=o.choices;bigpowpath=[powside].concat(o.target.objs[powside].type==="sum"?powpos:[]).concat(o.deps.facPath(o.choices[0],powsel));smallpowpath=[varside].concat(o.target.objs[varside].type==="sum"?vartermpos:[]).concat(o.deps.facPath(o.choices[1],varsel));exp=o.deps.lookUp(o.target,smallpowpath).objs[1];solvevar=o.argument;o["do"]("objToRootProd","bigtorootprod",{aim:bigpowpath,argument:{type:"number",val:"2"}});o["do"]("mergeSameBaseFacs","bigtosquare",{aim:bigpowpath,selection:[[0,1]]});basename=newvarname="t";deps=o.deps.varDependency(o.before||o.target);adder=0;while(deps[newvarname]){newvarname=basename+adder++}newvar={type:"variable",val:newvarname};o["do"]("addNewVar","introducevar",{direction:"right",argument:[newvar,Sqrt(solvevar)]});o["do"]("substitute","changebig",{selection:[[1],[0]],direction:"right",hunt:[bigpowpath.concat(0)],choices:["keep"]});o["do"]("substitute","changesmall",{selection:[[1],[0]],direction:"right",hunt:[smallpowpath],choices:["keep"]});o["do"]("solveQuadraticEquation","nowsolve",{aim:[0],choices:choices,selection:[[powside],[powpos],[powsel],[varside],[vartermpos],[varsel]],argument:newvar});newpath=[o.target.objs[0].objs[0].type==="variable"?0:1];o["do"]("substitute","changeback",{selection:[[1],[0]],direction:"left",hunt:[newpath],choices:["skip"]});return o.report("QUADINROOT DONE")}};solveQuadraticEquation={info:{name:"solveQuadraticEquation",effect:"simplifying",example:{str:"x2+3x=7",selection:[[0],[0],[0],[0],[1],[1]],choices:["self","facs"],argument:x},uses:["extractFacsFromExpression","divRelSidesAndFix","zeroFacExprToZero","sumNumerFracToSum","eliminateFromFrac","extractFacsFromFrac","collapseNegOneDenom","flattenFracNumerDenom","flattenFracDenom","flattenFracNumer","flattenNegProdFac","extractNumFacFromExpression","absorbProductFacs","addToRelationSides","absorbSumTerms","multiplyAllNumFacs","backwardsQuadrify","splitTermsToSum","rootifyRelationSides","purgeZeroTerms","collapseNegNumerDenomFacs","moveNegFromProdToFac","collapseDoubleNeg","collapseNegFacNegFrac","collapseNegProdWithNegFac","absorbOrsInAnd","moveTermsBetweenSidesInRel"],tags:["relation"],desperate:true,lesson:"equationsolve"},target:"relation",argument:{type:"variable",instruction:"ARGvartosolvefor",validate:function(o){var exps;exps=o.deps.varDependency(o.target)[o.argument.val];if(exps.length!==2||!(o.deps.equal(exps[0],two)||o.deps.equal(exps[1],two))&&(o.deps.equal(exps[0],one)||o.deps.equal(exps[1],one))){return Err("ARGnotoneandtwoexp")}else{return OK}}},direction:{instruction:"DIRchoosefromside"},selection:{max:1,questions:[{instruction:"SELpowside"},{instruction:"SELpowpos",from:function(o){return o.deps.getTerms(o.target.objs[o.selection[0][0]])},filter:function(o){var exps;exps=o.deps.varDependency(o.item)[o.argument.val]||[];if(exps.length!==1||!o.deps.equal(exps[0],two)){return Err("SELnotcorrectvardep")}else{return OK}}},{instruction:"SELpowfac",filter:function(o){if(o.deps.equal(o.item,Pow(o.argument,two))){return OK}else{return Err("SELnotvar")}},from:function(o){var term,terms;terms=o.deps.getTerms(o.target.objs[o.selection[0][0]]);term=terms[o.selection[1][0]];return o.deps.getFacs(term,o.choices[0])}},{instruction:"SELvarside"},{instruction:"SELvarpos",from:function(o){return o.deps.getTerms(o.target.objs[o.selection[3][0]])},filter:function(o){var exps;exps=o.deps.varDependency(o.item)[o.argument.val]||[];if(exps.length!==1||!o.deps.equal(exps[0],one)){return Err("SELnotcorrectvardep")}else{return OK}}},{instruction:"SELvarfac",filter:function(o){if(o.deps.equal(o.item,o.argument)){return OK}else{return Err("SELnotvar")}},from:function(o){var term,terms;terms=o.deps.getTerms(o.target.objs[o.selection[3][0]]);term=terms[o.selection[4][0]];return o.deps.getFacs(term,o.choices[1])}}]},choices:{questions:[{instruction:"CHOpowfactactic",options:function(o){var term;term=o.deps.getTerms(o.target.objs[o.selection[0][0]])[o.selection[1][0]];return o.deps.getFacOptions(term,false,false,false)}},{instruction:"CHOvarfactactic",options:function(o){var term;term=o.deps.getTerms(o.target.objs[o.selection[3][0]])[o.selection[4][0]];return o.deps.getFacOptions(term,false,false,false)}}]},auto:function(o){var allpowpos,allterms,allvarpos,exps,left,leftterms,powchoice,power,powpath,powpos,powside,powterm,rightterms,solvevar,varchoice,vardeps,varname,varpath,varpos,varside,varterm,_i,_j,_len,_len1;leftterms=o.deps.getTerms(o.target.objs[0]);rightterms=o.deps.getTerms(o.target.objs[1]);allterms=o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]));left=leftterms.length;vardeps=o.deps.varDependency(o.target);if(Object.keys(vardeps).length===1||o.desperate===3){for(varname in vardeps){exps=vardeps[varname];if(!(exps.length===2&&(o.deps.equal(exps[0],two)||o.deps.equal(exps[1],two))&&(o.deps.equal(exps[0],one)||o.deps.equal(exps[1],one)))){continue}solvevar={type:"variable",val:varname};power=Pow(solvevar,two);for(allpowpos=_i=0,_len=allterms.length;_i<_len;allpowpos=++_i){powterm=allterms[allpowpos];powpath=o.deps.findPathTo(powterm,power);if(powpath){powchoice=o.deps.pathToChoice(powterm,powpath,true);if(powchoice){powside=allpowpos>=left?1:0;powpos=allpowpos-(powside?left:0);for(allvarpos=_j=0,_len1=allterms.length;_j<_len1;allvarpos=++_j){varterm=allterms[allvarpos];if(!(allvarpos!==allpowpos)){continue}varpath=o.deps.findPathTo(varterm,solvevar);if(varpath){varchoice=o.deps.pathToChoice(varterm,varpath,true);if(varchoice){varside=allvarpos>=left?1:0;varpos=allvarpos-(varside?left:0);return{argument:solvevar,selection:[[powside],[powpos],powpath.slice(-1).length?powpath.slice(-1):[0],[varside],[varpos],varpath.slice(-1).length?varpath.slice(-1):[0]],choices:[powchoice,varchoice]}}}}}}}}}else{console.log("\n\nQUADFAIL",Object.keys(vardeps),o.desperate)}return Err("AUTOnovarstosolvefor")},perform:function(o){var arg,choices,cleanpath,ineq,movedtoneg,n,newpath,newpowpos,others,otherside,othersideobj,path,paths,pow,powchoice,powpos,powsel,powside,powtermpath,quadpos,relside,sels,side,t,termb,toclean,todestroy,varchoice,varsel,varside,varterm,vartermpath,vartermpos,wasneg,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref1,_ref10,_ref11,_ref12,_ref13,_ref14,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9;_ref1=o.selection,_ref2=_ref1[0],powside=_ref2[0],_ref3=_ref1[1],powpos=_ref3[0],_ref4=_ref1[2],powsel=_ref4[0],_ref5=_ref1[3],varside=_ref5[0],_ref6=_ref1[4],vartermpos=_ref6[0],_ref7=_ref1[5],varsel=_ref7[0];ineq=(_ref8=o.target.val)==="lt"||_ref8==="leq"||_ref8==="gt"||_ref8==="geq";arg=o.argument;_ref9=o.choices,powchoice=_ref9[0],varchoice=_ref9[1];o.beforemark([powside].concat((o.target.objs[powside].type==="sum"?[powpos]:[]).concat(o.deps.facPath(powchoice,powsel))));o.beforemark([varside].concat((o.target.objs[varside].type==="sum"?[vartermpos]:[]).concat(o.deps.facPath(varchoice,varsel))));if(powside!==varside){if(o.deps.getTerms(o.target.objs[powside])[powpos].type==="negation"){o["do"]("moveTermsBetweenSidesInRel","movenegpowterm",{selection:[[powside],[powpos]],direction:"left"});o["try"]("purgeZeroTerms","cleanupafterpowmove",{aim:[powside]});powpos=0;powchoice=o.deps.toPosPath(powchoice);vartermpos++;_ref10=powside===1?[0,1]:[1,0],side=_ref10[0],otherside=_ref10[1]}else{wasneg=o.deps.getTerms(o.target.objs[varside])[vartermpos].type==="negation";o["do"]("moveTermsBetweenSidesInRel","movenegvarterm",{selection:[[varside],[vartermpos]],direction:"right"});o["try"]("purgeZeroTerms","cleanupaftervarmove",{aim:[varside]});vartermpos=o.target.objs[powside].objs.length-1;if(wasneg){varchoice=o.deps.toPosPath(varchoice)}else{movedtoneg=true}_ref11=varside===1?[0,1]:[1,0],side=_ref11[0],otherside=_ref11[1]}}else{_ref12=powside===1?[1,0]:[0,1],side=_ref12[0],otherside=_ref12[1]}vartermpath=[side,vartermpos];powtermpath=[side,powpos];if(movedtoneg){o.doIf("extractFacsFromExpression","extractvar",{aim:vartermpath.concat(0),choices:[varchoice],selection:[[varsel]],direction:"right"});o["do"]("moveNegFromProdToFac","movenegtofreevar",{aim:vartermpath,selection:[[0]]});o["try"]("collapseDoubleNeg","cleannegmove",{aim:vartermpath.concat(0)});o["try"]("collapseNegFacNegFrac","cleannegmove",{aim:vartermpath.concat(0)});o["try"]("collapseNegProdWithNegFac","cleannegmove",{aim:vartermpath.concat(0)})}else{o.doIf("extractFacsFromExpression","extractvar",{aim:vartermpath,choices:[varchoice],selection:[[varsel]],direction:"right"})}if(!o.deps.equal(o.deps.lookUp(o.target,powtermpath),Pow(arg,two))){o.doIf("extractFacsFromExpression","extractpow",{aim:powtermpath,choices:[powchoice],selection:[[powsel]],direction:"right"});todestroy=o.deps.lookUp(o.target,powtermpath.concat(0));o["do"]("divRelSidesAndFix","divwithfactodestroy",{argument:todestroy});o["try"]("zeroFacExprToZero","cleanotherside",[0,otherside],false,"AND");o["do"]("sumNumerFracToSum","preptofix",{aim:[0,side],assuming:"AND"});o["do"]("eliminateFromFrac","freepow",{aim:[0].concat(powtermpath),choices:["facs","self"],selection:[[0],[0]],assuming:"AND"});o["do"]("extractFacsFromFrac","moveoutx",{aim:[0].concat(vartermpath),choices:["facs","self"],selection:[[1],[]],direction:"right",assuming:"AND"});toclean=[vartermpath.concat(0),[otherside]];relside=o.deps.lookUp(o.target,[0,side],"AND");_ref13=relside.objs;for(n=_i=0,_len=_ref13.length;_i<_len;n=++_i){t=_ref13[n];if(!(n===powpos||n===vartermpos)){toclean.push([side,n])}}for(_j=0,_len1=toclean.length;_j<_len1;_j++){cleanpath=toclean[_j];cleanpath=[0].concat(cleanpath);o["try"]("collapseNegOneDenom","flattenfracs",cleanpath,false,"AND");o["try"]("flattenFracNumerDenom","flattenfracs",cleanpath,false,"AND");o["try"]("flattenFracNumer","flattenfracs",cleanpath,false,"AND");o["try"]("flattenFracDenom","flattenfracs",cleanpath,false,"AND");o["try"]("collapseNegNumerDenomFacs","flattenfracs",cleanpath,false,"AND");_ref14=[cleanpath.concat(0),cleanpath.concat(1),cleanpath];for(_k=0,_len2=_ref14.length;_k<_len2;_k++){newpath=_ref14[_k];o["try"]("absorbProductFacs","cleanprod",newpath,false,"AND");o["try"]("flattenNegProdFac","cleanprod",newpath,false,"AND");o["try"]("multiplyAllNumFacs","cleanprod",newpath,false,"AND")}}}varterm=o.deps.lookUp(o.target,[0].concat(vartermpath.concat([0])),"AND");if(!(varterm.type==="product"&&o.deps.equal(two,varterm.objs[0]))){o["do"]("extractNumFacFromExpression","extracting2",{aim:[0].concat(vartermpath.concat([0])),direction:"left",argument:two,assuming:"AND"})}o["do"]("absorbProductFacs","smoothingout",{aim:[0].concat(vartermpath),selection:[[0]],assuming:"AND"});o["try"]("flattenFracNumer","fixingp",[0].concat(vartermpath.concat(1)),false,"AND");o["try"]("multiplyAllNumFacs","fixingpdenom",[0].concat(vartermpath.concat([1,1])),false,"AND");termb=Pow(o.deps.lookUp(o.target,[0].concat(vartermpath.concat([1])),"AND"),two);o["do"]("addToRelationSides","addingmissingpart",{aim:[0],argument:termb,direction:side===0?["right","left"]:["left","right"],assuming:"AND"});o["try"]("purgeZeroTerms","removeresultingzero",[0,otherside],false,"AND");o["try"]("absorbSumTerms","flatteningsum",[0,0],false,"AND");o["try"]("absorbSumTerms","flatteningsum",[0,1],false,"AND");relside=o.deps.lookUp(o.target,[0,side],"AND");quadpos=relside.objs.length-1;newpowpos=Math.min(powpos,vartermpos,quadpos)?1:0;o["do"]("backwardsQuadrify","quadrifybackwards",{aim:[0,side],selection:[[powpos],[vartermpos],[quadpos]],assuming:"AND"});relside=o.deps.lookUp(o.target,[0,side],"AND");if(relside.type==="sum"){if(relside.objs.length>2){o["do"]("splitTermsToSum","collectingotherterms",{aim:[0,side],selection:[function(){var _l,_ref15,_results;_results=[];for(n=_l=0,_ref15=relside.objs;0<=_ref15?_l<_ref15:_l>_ref15;n=0<=_ref15?++_l:--_l){if(n!==newpowpos){_results.push(n)}}return _results}()],assuming:"AND"})}o["do"]("moveTermsBetweenSidesInRel","movingthemover",{aim:[0],selection:[[side],[newpowpos?0:1]],direction:"right",assuming:"AND"})}otherside=side===0?1:0;othersideobj=o.deps.lookUp(o.target,[0,otherside],"AND");others=o.deps.getTerms(othersideobj).length;if(side===0){choices=["self"].concat(function(){var _l,_results;_results=[];for(n=_l=0;0<=others?_l<others:_l>others;n=0<=others?++_l:--_l){_results.push("none")}return _results}());sels=[[0]].concat(function(){var _l,_results;_results=[];for(n=_l=0;0<=others?_l<others:_l>others;n=0<=others?++_l:--_l){_results.push([])}return _results}())}else{choices=function(){var _l,_results;_results=[];for(n=_l=0;0<=others?_l<others:_l>others;n=0<=others?++_l:--_l){_results.push("none")}return _results}().concat("self");sels=function(){var _l,_results;_results=[];for(n=_l=0;0<=others?_l<others:_l>others;n=0<=others?++_l:--_l){_results.push([])}return _results}().concat([[0]])}pow=o.deps.lookUp(o.target,[0,side],"AND");o["do"]("solvePowEq","solveforsub",{aim:[0],argument:pow,selection:sels,choices:choices,assuming:"AND"});if(!ineq){o["do"]("moveTermsBetweenSidesInRel","finallymoveb",{aim:[0],selection:[[side],[1]],direction:"left",assuming:"AND"});o["try"]("collapseNegFacNegFrac","cleanb",{aim:[0,otherside,0],assuming:"AND"});o.aftermark([0,side],"AND")}else{o.doIf("absorbSubAnds","flattenpath",{aim:[0,2],selection:[[0]]});o.doIf("absorbOrsInAnd","flattenpath",{aim:[0,2],selection:[[0]]});o.report("OK, HERE WE GO WOOOO!");if(o.target.objs[0].type==="relation"){paths=[[0],[1]]}else if(o.target.objs[0].type==="ifelse"&&o.target.objs[0].objs[1].type==="OR"){paths=[[0,1,0],[0,1,1],[0,2,0],[0,2,1]]}else if(o.target.objs[0].type==="ifelse"&&o.target.objs[0].objs[1].type==="AND"){paths=[[0,1,0],[0,1,1],[0,2,0,0],[0,2,1,0]]}else{throw"Ack, i got lost!"}for(n=_l=0,_len3=paths.length;_l<_len3;n=++_l){path=paths[n];o["do"]("moveTermsBetweenSidesInRel",n?"LOGICPATHDOUBLE":"finallymoveb",{aim:path,selection:[[side],[1]],direction:"left"});o["try"]("collapseNegFacNegFrac",n?"LOGICPATHDOUBLE":"cleanb",{aim:path.concat([otherside,0])});o.aftermark(path.concat(side))}}return o}};backwardsQuadrify={info:{name:"backwardsQuadrify",effect:"complicating",example:{str:"x2+2xy+y2",selection:[[0],[1],[2]]},uses:["splitTermsToSum","rearrange","numToSum","moveNegFromFacToProd","distributeFacs","purgeOneFacs","collapseNegSum","absorbSumTerms","extractFacsFromTerms","addTwoNegOneFacsToExpression","mirrorSumWithNegInProd","collapseNegOneFac","mergeSameBaseFacs"],tags:["sum","factorise"],lesson:"equationsolve"},prints:{instructions:["SELx2term","SEL2xyterm","SELy2term"],errors:["SELmustbepow","SELexpmustbe2","VALfirstbasenotinprod","VALsecondbasenotinprod","VALtwonotinprod"],steps:[]},target:"sum",selection:{filter:function(o){if(o.item.type!=="power"){return Err("SELmustbepow")
}else if(!o.deps.equal(two,o.item.objs[1])){return Err("SELexpmustbe2",[1])}else{return OK}},questions:[{instruction:"SELx2term"},{instruction:"SEL2xyterm",filter:function(o){if(o.item.type==="product"||o.item.type==="negation"&&o.item.objs[0].type==="product"){return OK}else{return Err("SELmustbeprodornegprod")}}},{instruction:"SELy2term"}]},validate:function(o){var first,firstpos,n,prod,second,secondpos,twopos,wasneg;first=o.target.objs[o.selection[0][0]].objs[0];second=o.target.objs[o.selection[2][0]].objs[0];prod=o.target.objs[o.selection[1][0]];if(prod.type==="negation"){wasneg=true;prod=prod.objs[0]}firstpos=o.deps.find(prod,first);if(!firstpos.length){return Err("VALfirstbasenotinprod")}else{secondpos=o.deps.find(prod,second);if(!secondpos.length){return Err("VALsecondbasenotinprod")}else{twopos=function(){var _i,_results;_results=[];for(n=_i=0;_i<=2;n=++_i){if(n!==firstpos&&n!==secondpos){_results.push(n)}}return _results}()[0];if(!(o.deps.equal(prod.objs[twopos],two)||!wasneg&&o.deps.equal(prod.objs[twopos],Neg(two)))){return Err("VALtwonotinprod")}else{return OK}}}},perform:function(o){var facword,firstextractchoices,firstextractsels,firstinprod,firstpos,full,n,negprod,negtwopos,ordered,prod,prodpath,prodpos,rearr,secondextractchoices,secondextractsels,secondinprod,secondpos,twopath,twopos,_i,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9;_ref1=o.selection,_ref2=_ref1[0],firstpos=_ref2[0],_ref3=_ref1[1],prodpos=_ref3[0],_ref4=_ref1[2],secondpos=_ref4[0];o.beforemark([firstpos,0]);o.beforemark([secondpos,0]);if(o.target.objs.length>3){ordered=[firstpos,prodpos,secondpos].sort();o["do"]("splitTermsToSum","collectingterms",{selection:[ordered]});full=[ordered[0]];firstpos=firstpos===ordered[0]?0:firstpos===ordered[1]?1:2;prodpos=prodpos===ordered[0]?0:prodpos===ordered[1]?1:2;secondpos=secondpos===ordered[0]?0:secondpos===ordered[1]?1:2}else{full=[]}if(firstpos!==0||prodpos!==1||secondpos!==2){rearr=[o.deps.lookUp(o.target,full.concat(firstpos)),o.deps.lookUp(o.target,full.concat(prodpos)),o.deps.lookUp(o.target,full.concat(secondpos))].concat(o.deps.lookUp(o.target,full).objs.filter(function(child,i){return!(i===firstpos||i===prodpos||i===secondpos)}));o["do"]("rearrange","movetermsright",{aim:full,rearrange:rearr});_ref5=[0,1,2],firstpos=_ref5[0],prodpos=_ref5[1],secondpos=_ref5[2]}prod=o.deps.lookUp(o.target,full.concat(prodpos));if(prod.type==="negation"){negprod=true;prod=prod.objs[0]}twopos=o.deps.find(prod,two)[0];negtwopos=o.deps.find(prod,Neg(two))[0];prodpath=negprod?[prodpos,0]:[prodpos];for(n=_i=0;_i<=2;n=++_i){if(n!==twopos&&n!==negtwopos){o.beforemark(prodpath.concat(n))}}if(twopos===void 0){twopos=negtwopos;if(negtwopos===void 0){throw"ASS!"}o["do"]("moveNegFromFacToProd","fixthisshit",{aim:full.concat(prodpath),selection:[[negtwopos]]});negprod=true;prodpath=prodpath.concat(0)}twopath=prodpath.concat(twopos);o["do"]("numToSum","twotoones",{aim:full.concat(twopath),argument:Sum(one,one)});o["try"]("distributeFacs","multin",{aim:full.concat(prodpath)});o.doIf("purgeOneFacs","skipones",{aim:full.concat(prodpath.concat([0])),selection:[[((_ref6=o.deps.lookUp(o.target,full.concat(prodpath.concat([0]))).objs)!=null?_ref6.length:void 0)-1]]});o.doIf("purgeOneFacs","skipones2",{aim:full.concat(prodpath.concat([1])),selection:[[((_ref7=o.deps.lookUp(o.target,full.concat(prodpath.concat([1]))).objs)!=null?_ref7.length:void 0)-1]]});if(o.deps.equal(o.deps.lookUp(o.target,full.concat([firstpos,0])),o.deps.lookUp(o.target,full.concat(prodpath.concat([0,0]))))){_ref8=[0,1],firstinprod=_ref8[0],secondinprod=_ref8[1]}else{_ref9=[1,0],firstinprod=_ref9[0],secondinprod=_ref9[1]}if(negprod){o["do"]("collapseNegSum","negifysum",{aim:full.concat([prodpos])})}o["do"]("absorbSumTerms","flattenout",{aim:full,selection:[[prodpos]]});facword=negprod?"negchildfacs":"facs";firstextractsels=function(){var _j,_results;_results=[];for(n=_j=0;_j<=3;n=++_j){_results.push(n===firstpos?[0]:n===prodpos?[firstinprod]:[])}return _results}();firstextractchoices=function(){var _j,_results;_results=[];for(n=_j=0;_j<=3;n=++_j){_results.push(n===firstpos?"powbase":n===prodpos?facword:"none")}return _results}();o["do"]("extractFacsFromTerms","extractingfirstbase",{aim:full,selection:firstextractsels,choices:firstextractchoices});secondextractsels=function(){var _j,_results;_results=[];for(n=_j=0;_j<=2;n=++_j){_results.push(n===secondpos?[0]:n===prodpos?[secondinprod]:[])}return _results}();secondextractchoices=function(){var _j,_results;_results=[];for(n=_j=0;_j<=2;n=++_j){_results.push(n===secondpos?"powbase":n===prodpos?facword:"none")}return _results}();o["do"]("extractFacsFromTerms","extractingsecondbase",{aim:full,selection:secondextractsels,choices:secondextractchoices});if(negprod){o["do"]("addTwoNegOneFacsToExpression","addingnegstoturnlast",{aim:full.concat([1]),direction:"right"});o["do"]("mirrorSumWithNegInProd","neggingsumterm",{aim:full.concat([1]),selection:[[3],[1]]});o["do"]("collapseNegOneFac","neggingsecondbase",{aim:full.concat([1]),selection:[[2],[0]]})}o["do"]("extractFacsFromTerms","extractingsum",{aim:full,selection:[[1],[1]],choices:["facs","facs"]});o["do"]("mergeSameBaseFacs","mergingsumfacs",{aim:full,selection:[[0,1]]});o.aftermark(full.concat([0,0]));return o.aftermark(full.concat([0,1]))}};moveTermsBetweenSidesInRel={info:{name:"moveTermsBetweenSidesInRel",tags:["relation","switchedsigns"],uses:["splitTermsToSum","addToRelationSides","absorbSumTerms","mergeAllNumTerms","addExpressions","purgeZeroTerms","collapseNegSum"],example:{str:"3x+7+5x2=0",selection:[[0],[0,2]]},effect:"condsimpl",lesson:"relationmanip"},target:"relation",prints:{instructions:["SELsidetomovefrom","SELtermstomove","DIRsideonnewside"],steps:["collecttermstomove","addmirroroftermtomove","addthenumbers","smashthemtozero"],errors:["AUTOnosimplmoves"]},selection:{questions:[{instruction:"SELsidetomovefrom"},{instruction:"SELtermstomove",from:function(o){return o.deps.getTerms(o.target.objs[o.selection[0][0]])}}]},direction:{instruction:"DIRsideonnewside"},auto:function(o){var analysis,exps,hasvars,him,hisdeps,hisotherterms,key,leftdeps,lefts,me,mydeps,myotherterms,n,otherside,rightdeps,rights,side,sideterms,term,terms,val,varname,vars,_base,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref1,_ref2,_ref3,_ref4,_ref5;analysis=[{total:0,varterms:0,vardeps:{},numterms:[]},{total:0,varterms:0,vardeps:{},numterms:[]}];lefts=o.deps.getTerms(o.target.objs[0]);rights=o.deps.getTerms(o.target.objs[1]);leftdeps=o.deps.varDependency(o.target.objs[0]);rightdeps=o.deps.varDependency(o.target.objs[1]);terms=[lefts,rights];_ref1=[1,0];for(side=_i=0,_len=_ref1.length;_i<_len;side=++_i){otherside=_ref1[side];_ref2=side?[rightdeps,leftdeps]:[leftdeps,rightdeps],mydeps=_ref2[0],hisdeps=_ref2[1];if(o.target.objs[side].type!=="sum"){for(varname in mydeps){exps=mydeps[varname];if(!hisdeps[varname]){return Err("AUTOalreadysolvedtermwise")}}}}for(side=_j=0,_len1=terms.length;_j<_len1;side=++_j){sideterms=terms[side];for(n=_k=0,_len2=sideterms.length;_k<_len2;n=++_k){term=sideterms[n];vars=o.deps.varDependency(term);hasvars=false;analysis[side].total++;for(key in vars){val=vars[key];hasvars=true;if((_ref3=(_base=analysis[side].vardeps)[key])==null){_base[key]=[]}analysis[side].vardeps[key].push(n)}if(hasvars){analysis[side].varterms++}else{analysis[side].numterms.push(n)}}}if(Object.keys(o.deps.varDependency(o.target)).length===0&&(o.deps.equal(o.target.objs[0],zero)||o.deps.equal(o.target.objs[1],zero)||lefts.length===1&&rights.length===1)){return Err("AUTOnumwithzero")}if(analysis[0].numterms.length&&analysis[1].numterms.length){if(o.deps.equal(o.target.objs[1],zero)||analysis[0].varterms>analysis[1].varterms){return{selection:[[0],analysis[0].numterms]}}else{return{selection:[[1],analysis[1].numterms]}}}_ref4=[1,0];for(side=_l=0,_len3=_ref4.length;_l<_len3;side=++_l){otherside=_ref4[side];me=analysis[0],him=analysis[1];_ref5=me.vardeps;for(key in _ref5){val=_ref5[key];if(him.vardeps[key]){myotherterms=terms[side].length-val.length;hisotherterms=terms[otherside].length-val.length;if(myotherterms>hisotherterms){return{selection:[[side],val]}}else{return{selection:[[otherside],him.vardeps[key]]}}}}}return Err("AUTOnosimplmoves")},perform:function(o){var afterpre,choices,dir,from,fromside,fromsidetermsnow,n,newpos,numfromsideterms,numothersideterms,oldpos,p,pos,sels,term,terms,to,tosidewaszero,_i,_j,_k,_len,_len1,_len2,_ref1,_ref2,_ref3;_ref1=o.selection,_ref2=_ref1[0],from=_ref2[0],terms=_ref1[1];dir=o.direction;fromside=o.target.objs[from];if(fromside.type==="sum"){for(_i=0,_len=terms.length;_i<_len;_i++){n=terms[_i];o.beforemark([from].concat(n))}}else{o.beforemark([from])}numfromsideterms=o.deps.getTerms(fromside).length;to=from===0?1:0;tosidewaszero=o.deps.equal(o.target.objs[to],zero);if(terms.length>1&&terms.length<numfromsideterms){o["do"]("splitTermsToSum","collecttermstomove",{aim:[from],selection:[terms]})}pos=terms[0];term=o.target.objs[from].type!=="sum"?o.target.objs[from]:o.target.objs[from].objs[pos];numothersideterms=o.deps.getTerms(o.target.objs[to]).length;o["do"]("addToRelationSides","addmirroroftermtomove",{direction:dir,argument:term.type==="negation"?term.objs[0]:Neg(term)});if(numfromsideterms!==o.target.objs[from].length){o.doIf("absorbSumTerms","flattenfromside",{aim:[from],selection:[[dir==="right"?0:1]]})}fromsidetermsnow=o.deps.getTerms(o.target.objs[from]);_ref3=dir==="right"?[fromsidetermsnow.length-1,pos]:[0,pos+1],newpos=_ref3[0],oldpos=_ref3[1];if(o.deps.isNumeric(term)){o["do"]("mergeAllNumTerms","addthenumbers",{aim:[from],selection:[[oldpos,newpos].sort()]})}else{sels=[];choices=[];for(n=_j=0,_len1=fromsidetermsnow.length;_j<_len1;n=++_j){term=fromsidetermsnow[n];if(n===oldpos){sels.push([0]);choices.push(term.type==="negation"?"negchild":"self")}else if(n===newpos){sels.push([0]);choices.push(term.type==="negation"?"negchild":"self")}else{sels.push([]);choices.push("none")}}o["do"]("addExpressions","smashthemtozero",{aim:[from],selection:sels,choices:choices})}if(o.target.objs[from].type==="sum"){o["try"]("purgeZeroTerms","removebehindzero",{aim:[from]})}afterpre=dir==="right"?numothersideterms:0;if(tosidewaszero){o["try"]("purgeZeroTerms","removetosidezero",{aim:[to]})}else if(numothersideterms>1){o["do"]("absorbSumTerms","finallyflattenotherside",{aim:[to],selection:[[dir==="right"?0:1]]})}if(terms.length>1){o.doIf("collapseNegSum","collapsethenegsum",{aim:[to,afterpre]});o.doIf("absorbSumTerms","finallyflattenotherside",{aim:[to],selection:[[afterpre]]})}for(n=_k=0,_len2=terms.length;_k<_len2;n=++_k){p=terms[n];o.aftermark([to,afterpre+n])}return o}};solveLinearEq={info:{name:"solveLinearEq",effect:"simplifying",example:{str:"3x=2",argument:x,choices:["facs","none"],selection:[[1],[]]},desperate:true,tags:["relation"],uses:["moveTermsBetweenSidesInRel","addExpressions","multRelSidesAndFix","divRelSidesAndFix","multFacsIntoFrac","eliminateFromFrac","absorbSubAnds","extractFacsFromExpression"],lesson:"equationsolve"},target:"relation",prints:{errors:["SELsolveexprnotinterm","ARGnosuchfacinrelation"],instructions:["ARGexprtosolvefor","SELleftterms","SELrightterms"]},argument:{instruction:"ARGexprtosolvefor",validate:function(o){var side,term,_i,_j,_len,_len1,_ref1,_ref2;_ref1=o.target.objs;for(_i=0,_len=_ref1.length;_i<_len;_i++){side=_ref1[_i];_ref2=o.deps.getTerms(side);for(_j=0,_len1=_ref2.length;_j<_len1;_j++){term=_ref2[_j];if(o.deps.getStraightFacAddress(term,o.argument)){return OK}}}return Err("ARGnosuchfacinrelation")}},choices:{questions:function(o){var pos,term,_i,_len,_ref1,_results;_ref1=o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]));_results=[];for(pos=_i=0,_len=_ref1.length;_i<_len;pos=++_i){term=_ref1[pos];_results.push({options:["none"].concat(o.deps.getFacOptions(term))})}return _results}},selection:{filter:function(o){if(o.deps.getStraightFacAddress(o.item,o.argument)){return OK}else{return"SELsolveexprnotinterm"}},or0:true,totalmin:1,questions:function(o){var pos,term,_i,_len,_ref1,_results;_ref1=o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]));_results=[];for(pos=_i=0,_len=_ref1.length;_i<_len;pos=++_i){term=_ref1[pos];_results.push(function(t,c){return{from:function(i){return i.deps.getFacs(t,c)}}}(term,o.choices[pos]))}return _results},from:function(o){return o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]))}},auto:function(o){var all,choices,exps,lefts,n,path,rights,sels,solvefor,term,terms,termvars,vardeps,varname,_i,_len,_ref1;if(((_ref1=o.target.val[0])==="g"||_ref1==="l")&&!o.desperate){return Err("AUTOnotdesperateenough")}if(o.target.objs[0].type!=="variable"&&o.target.objs[1].type!=="variable"){vardeps=o.deps.varDependency(o.target);lefts=o.deps.getTerms(o.target.objs[0]);rights=o.deps.getTerms(o.target.objs[1]);all=lefts.concat(rights);for(varname in vardeps){exps=vardeps[varname];if(!(exps.filter(function(exp){return!o.deps.equal(exp,one)}).length===0)){continue}solvefor={type:"variable",val:varname};terms=[];choices=[];sels=[];for(n=_i=0,_len=all.length;_i<_len;n=++_i){term=all[n];termvars=o.deps.varDependency(term);if((Object.keys(termvars).length===1||o.desperate>=2)&&(term.type==="variable"||o.desperate>=1)){path=o.deps.getStraightFacAddress(term,solvefor);if(path){terms.push(n);sels.push([path[1]]);choices.push(path[0])}else{sels.push([]);choices.push("none")}}else{sels.push([]);choices.push("none")}}if(terms.length===exps.length){return{argument:solvefor,selection:sels,choices:choices}}}}return Err("AUTOnovartosolvefor")},perform:function(o){var all,beforelen,choices,lefts,meat,n,numleftterms,other,others,otherside,pre,relation,relside,rights,s,selection,shouldclean,side,solvefor,t,termnum,terms,trm,way,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref1,_ref2,_ref3;solvefor=o.argument;numleftterms=o.deps.getTerms(o.target.objs[0]).length;lefts=[];rights=[];shouldclean=false;_ref1=o.selection;for(termnum=_i=0,_len=_ref1.length;_i<_len;termnum=++_i){s=_ref1[termnum];if(s.length){if(termnum<numleftterms){lefts.push(termnum)}else{rights.push(termnum-numleftterms)}}}_ref2=[0,1];for(_j=0,_len1=_ref2.length;_j<_len1;_j++){s=_ref2[_j];pre=o.target.objs[s].type==="sum"?[s]:[];terms=o.deps.getTerms(o.target.objs[s]);for(n=_k=0,_len2=terms.length;_k<_len2;n=++_k){trm=terms[n];if(__indexOf.call(s?rights:lefts,n)>=0){o.beforemark([s].concat(terms.length===1?[]:n).concat(o.deps.findPathTo(trm,solvefor)))}}}if(lefts.length===0){all=rights;side=1}else if(rights.length===0){all=lefts;side=0}else{side=0;beforelen=o.deps.getTerms(o.target.objs[side]).length;o["do"]("moveTermsBetweenSidesInRel","gatherononeside",{selection:[[1],rights],direction:"right"});all=lefts.concat(function(){var _l,_len3,_results;_results=[];for(n=_l=0,_len3=rights.length;_l<_len3;n=++_l){t=rights[n];_results.push(beforelen+n)}return _results}())}if(o.target.objs[side].type==="sum"&&o.target.objs[side].objs.length>all.length){others=function(){var _l,_ref3,_results;_results=[];for(n=_l=0,_ref3=o.target.objs[side].objs.length;0<=_ref3?_l<_ref3:_l>_ref3;n=0<=_ref3?++_l:--_l){if(!(__indexOf.call(all,n)>=0)){_results.push(n)}}return _results}();o["do"]("moveTermsBetweenSidesInRel","moveotherstuffaway",{selection:[[side],others]});all=all.length===1?[0]:function(){var _l,_ref3,_results;_results=[];for(n=_l=0,_ref3=o.target.objs[side].objs.length;0<=_ref3?_l<_ref3:_l>_ref3;n=0<=_ref3?++_l:--_l){_results.push(n)}return _results}()}if(all.length>1){selection=[];choices=[];for(_l=0,_len3=all.length;_l<_len3;_l++){n=all[_l];way=o.deps.getStraightFacAddress(o.target.objs[side].objs[n],solvefor);selection.push([way[1]]);choices.push(way[0])}o["do"]("addExpressions","mashxtogether",{aim:[side],selection:selection,choices:choices})}if(!o.deps.equal(o.target.objs[side],solvefor)){otherside=side===1?0:1;if(o.target.objs[side].type==="fraction"&&((_ref3=o.target.val)==="eq"||_ref3==="neq"||o.deps.newEvalNumVal(o.target.objs[side].objs[1])!==false||o.deps.equal(o.target.objs[side].objs[0],solvefor))){o["do"]("multRelSidesAndFix","multeqwithxdenom",{argument:o.target.objs[side].objs[1],direction:"left"});o["do"]("multFacsIntoFrac","multintorid",{aim:[0,side],selection:[[1],[0]],assuming:"AND"});o["do"]("eliminateFromFrac","kill",{aim:[0,side],choices:["facs","self"],selection:[[0],[0]],assuming:"AND"})}relside=o.deps.lookUp(o.target,[side],"relation");way=o.deps.getStraightFacAddress(relside,solvefor);if(way[0]!=="self"){if(way[0]==="facs"&&relside.objs.length===2){meat=way[1]}else{o["do"]("extractFacsFromExpression","extractsolvefor",{aim:[side],choices:[way[0]],selection:[[way[1]]],direction:"right",assuming:"relation"});relside=o.deps.lookUp(o.target,[side],"relation");meat=relside.objs.length-1}other=meat===1?0:1;relation=o.deps.lookUp(o.target,[],"relation");o["do"]("divRelSidesAndFix","divrel",{argument:relation.objs[side].objs[other],assuming:"relation"});o["try"]("absorbSubAnds","flattenstuffout",[],false,"AND");o["do"]("eliminateFromFrac","removecoeff",{aim:[side],choices:["facs","self"],selection:[[other],[0]],assuming:"relation"})}}return o.aftermark([side])}};solveRootEq={info:{name:"solveRootEq",effect:"simplifying",example:{str:"pi+(sqrtx)/2=7",choices:["none","numerself","none"],selection:[[],[0],[]],argument:Sqrt(x)},tags:["relation","root"],uses:["solveLinearEq","powerifyRelationSides","collapseRootBasePow"],lesson:"equationsolve"},target:"equality",argument:{instruction:"ARGroottosolvefor",validate:function(o){var side,term,_i,_j,_len,_len1,_ref1,_ref2;if(o.argument.type!=="root"){return Err("ARGmustberoot")}else{_ref1=o.target.objs;for(_i=0,_len=_ref1.length;_i<_len;_i++){side=_ref1[_i];_ref2=o.deps.getTerms(side);for(_j=0,_len1=_ref2.length;_j<_len1;_j++){term=_ref2[_j];if(o.deps.getStraightFacAddress(term,o.argument)){return OK}}}return Err("ARGnosuchfacinrelation")}}},choices:{questions:function(o){var pos,term,_i,_len,_ref1,_results;_ref1=o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]));_results=[];for(pos=_i=0,_len=_ref1.length;_i<_len;pos=++_i){term=_ref1[pos];_results.push({options:["none"].concat(o.deps.getFacOptions(term))})}return _results}},selection:{filter:function(o){if(o.deps.getStraightFacAddress(o.item,o.argument)){return OK}else{return"SELsolverootnotinterm"}},or0:true,totalmin:1,questions:function(o){var pos,term,_i,_len,_ref1,_results;_ref1=o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]));_results=[];for(pos=_i=0,_len=_ref1.length;_i<_len;pos=++_i){term=_ref1[pos];_results.push(function(t,c){return{from:function(i){return i.deps.getFacs(t,c)}}}(term,o.choices[pos]))}return _results},from:function(o){return o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]))}},auto:function(o){var all,analysis,choice,choices,fac,facdeps,fchoice,foundhere,fsel,lefts,n,possibility,residue,rights,root,sel,sels,solvefor,term,terms,termvars,vardeps,varname,_i,_j,_len,_len1;if(o.deps.containsType(o.target,"plusminus")){return Err("AUTOhasplusminusiwait")}if(o.target.objs[0].type!=="variable"&&o.target.objs[1].type!=="variable"){vardeps=o.deps.varDependency(o.target);lefts=o.deps.getTerms(o.target.objs[0]);rights=o.deps.getTerms(o.target.objs[1]);all=lefts.concat(rights);for(varname in vardeps){solvefor={type:"variable",val:varname};terms=[];choices=[];sels=[];root=null;for(n=_i=0,_len=all.length;_i<_len;n=++_i){term=all[n];termvars=o.deps.varDependency(term);foundhere=false;fsel=void 0;fchoice=void 0;if(Object.keys(termvars).length===1){analysis=o.deps.getFacPossibilities(mixin({oneatatime:true,allowdenom:false,obj:term},o));for(_j=0,_len1=analysis.length;_j<_len1;_j++){possibility=analysis[_j];if(!!foundhere){continue}choice=possibility[0],sel=possibility[1],fac=possibility[2],residue=possibility[3];if(fac.type==="root"){facdeps=o.deps.varDependency(fac);if(facdeps[varname]){if(!root||o.deps.equal(root,fac)){root=fac;foundhere=true;fsel=sel;fchoice=choice}}}}}if(foundhere){terms.push(n);sels.push(fsel);choices.push(fchoice)}else{sels.push([]);choices.push("none")}}if(terms.length&&vardeps[varname].length===terms.length){return{argument:root,selection:sels,choices:choices}}}}return Err("AUTOnoroottosolvefor")},perform:function(o){var all,choices,lefts,n,pre,root,rootside,sels,trm,_i,_len;root=o.argument;sels=o.selection;choices=o.choices;lefts=o.deps.getTerms(o.target.objs[0]);all=lefts.concat(o.deps.getTerms(o.target.objs[1]));for(n=_i=0,_len=all.length;_i<_len;n=++_i){trm=all[n];if(choices[n]!=="none"){if(n<lefts.length){pre=lefts.length===1?[0]:[0,n]}else{pre=lefts.length+1===all.length?[1]:[1,n-lefts.length]}o.beforemark(pre.concat(o.deps.facPath(choices[n],sels[n])))}}o.doIf("solveLinearEq","firstfreeroot",{selection:sels,choices:choices,argument:root});rootside=o.deps.equal(o.target.objs[0],root)?0:1;o["do"]("powerifyRelationSides","powerup",{argument:root.objs[1]});o["do"]("collapseRootBasePow","andfree",{aim:[rootside]});return o.aftermark([rootside])}};solveLogEq={info:{name:"solveLogEq",effect:"simplifying",example:{str:"pi+(logx)/2=7",choices:["none","numerself","none"],selection:[[],[0],[]],argument:Log(x)},tags:["relation","log"],desperate:true,uses:["solveLinearEq","baseBothSidesOfRel","powWithBaseLogExpToExp"],lesson:"equationsolve"},target:"relation",argument:{instruction:"ARGlogtosolvefor",validate:function(o){var side,term,_i,_j,_len,_len1,_ref1,_ref2;if(o.argument.type!=="log"){return Err("ARGmustbelog")}else{_ref1=o.target.objs;for(_i=0,_len=_ref1.length;_i<_len;_i++){side=_ref1[_i];_ref2=o.deps.getTerms(side);for(_j=0,_len1=_ref2.length;_j<_len1;_j++){term=_ref2[_j];if(o.deps.getStraightFacAddress(term,o.argument)){return OK}}}return Err("ARGnosuchloginrelation")}}},choices:{questions:function(o){var pos,term,_i,_len,_ref1,_results;_ref1=o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]));_results=[];for(pos=_i=0,_len=_ref1.length;_i<_len;pos=++_i){term=_ref1[pos];_results.push({options:["none"].concat(o.deps.getFacOptions(term))})}return _results}},selection:{filter:function(o){if(o.deps.getStraightFacAddress(o.item,o.argument)){return OK}else{return"SELsolvelognotinterm"}},or0:true,totalmin:1,questions:function(o){var pos,term,_i,_len,_ref1,_results;_ref1=o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]));_results=[];for(pos=_i=0,_len=_ref1.length;_i<_len;pos=++_i){term=_ref1[pos];_results.push(function(t,c){return{from:function(i){return i.deps.getFacs(t,c)}}}(term,o.choices[pos]))}return _results},from:function(o){return o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]))}},auto:function(o){var all,analysis,choice,choices,fac,facdeps,fchoice,foundhere,fsel,lefts,log,n,possibility,residue,rights,sel,sels,solvefor,term,terms,termvars,vardeps,varname,_i,_j,_len,_len1;if(o.deps.containsType(o.target,"plusminus")){return Err("AUTOhasplusminusiwait")}if(o.target.objs[0].type!=="variable"&&o.target.objs[1].type!=="variable"){vardeps=o.deps.varDependency(o.target);lefts=o.deps.getTerms(o.target.objs[0]);rights=o.deps.getTerms(o.target.objs[1]);all=lefts.concat(rights);for(varname in vardeps){solvefor={type:"variable",val:varname};terms=[];choices=[];sels=[];log=null;for(n=_i=0,_len=all.length;_i<_len;n=++_i){term=all[n];termvars=o.deps.varDependency(term);foundhere=false;fsel=void 0;fchoice=void 0;if(Object.keys(termvars).length===1||o.desperate){analysis=o.deps.getFacPossibilities(mixin({oneatatime:true,allowdenom:false,obj:term},o));for(_j=0,_len1=analysis.length;_j<_len1;_j++){possibility=analysis[_j];if(!!foundhere){continue}choice=possibility[0],sel=possibility[1],fac=possibility[2],residue=possibility[3];if(fac.type==="log"){facdeps=o.deps.varDependency(fac);if(facdeps[varname]){if(!log||o.deps.equal(log,fac)){log=fac;foundhere=true;fsel=sel;fchoice=choice}}}}}if(foundhere){terms.push(n);sels.push(fsel);choices.push(fchoice)}else{sels.push([]);choices.push("none")}}if(terms.length&&vardeps[varname].length===terms.length){return{argument:log,selection:sels,choices:choices}}}}return Err("AUTOnoroottosolvefor")},perform:function(o){var all,choices,lefts,log,logside,n,pre,sels,trm,_i,_len;log=o.argument;sels=o.selection;choices=o.choices;lefts=o.deps.getTerms(o.target.objs[0]);all=lefts.concat(o.deps.getTerms(o.target.objs[1]));for(n=_i=0,_len=all.length;_i<_len;n=++_i){trm=all[n];if(choices[n]!=="none"){if(n<lefts.length){pre=lefts.length===1?[0]:[0,n]}else{pre=lefts.length+1===all.length?[1]:[1,n-lefts.length]}o.beforemark(pre.concat(o.deps.facPath(choices[n],sels[n])))}}o.doIf("solveLinearEq","firstfreeroot",{selection:sels,choices:choices,argument:log});logside=o.deps.equal(o.target.objs[0],log)?0:1;o["do"]("baseBothSidesOfRel","baseup",{argument:log.objs[1]});o["do"]("powWithBaseLogExpToExp","flatten",{aim:[logside]});return o.aftermark([logside])}};solveExpEq={info:{name:"solveExpEq",effect:"simplifying",example:{str:"pi+(4^x)/2=7",choices:["none","numerself","none"],selection:[[],[0],[]],argument:Pow(four,x)},tags:["relation","log","exponent"],uses:["solveLinearEq","logifyRelationSides","logOfPowToProd","logOfBaseToOne","purgeOneFacs"],lesson:"equationsolve"},target:"equality",argument:{instruction:"ARGpowtosolvefor",validate:function(o){var side,term,_i,_j,_len,_len1,_ref1,_ref2;if(o.argument.type!=="power"){return Err("ARGmustbepow")}else{_ref1=o.target.objs;for(_i=0,_len=_ref1.length;_i<_len;_i++){side=_ref1[_i];_ref2=o.deps.getTerms(side);for(_j=0,_len1=_ref2.length;_j<_len1;_j++){term=_ref2[_j];if(o.deps.getStraightFacAddress(term,o.argument)){return OK}}}return Err("ARGnosuchexpinrelation")}}},choices:{questions:function(o){var pos,term,_i,_len,_ref1,_results;_ref1=o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]));_results=[];for(pos=_i=0,_len=_ref1.length;_i<_len;pos=++_i){term=_ref1[pos];_results.push({options:["none"].concat(o.deps.getFacOptions(term))})}return _results}},selection:{filter:function(o){if(o.deps.getStraightFacAddress(o.item,o.argument)){return OK}else{return"SELsolveexpnotinterm"}},or0:true,totalmin:1,questions:function(o){var pos,term,_i,_len,_ref1,_results;_ref1=o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]));_results=[];for(pos=_i=0,_len=_ref1.length;_i<_len;pos=++_i){term=_ref1[pos];_results.push(function(t,c){return{from:function(i){return i.deps.getFacs(t,c)}}}(term,o.choices[pos]))}return _results},from:function(o){return o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]))}},auto:function(o){var all,analysis,choice,choices,expdeps,fac,fchoice,foundhere,fsel,lefts,n,possibility,pow,residue,rights,sel,sels,solvefor,term,terms,termvars,vardeps,varname,_i,_j,_len,_len1,_ref1;if(o.deps.containsType(o.target,"plusminus")){return Err("AUTOhasplusminusiwait")}if(o.target.objs[0].type!=="variable"&&o.target.objs[1].type!=="variable"){vardeps=o.deps.varDependency(o.target);lefts=o.deps.getTerms(o.target.objs[0]);rights=o.deps.getTerms(o.target.objs[1]);all=lefts.concat(rights);for(varname in vardeps){solvefor={type:"variable",val:varname};terms=[];choices=[];sels=[];pow=null;for(n=_i=0,_len=all.length;_i<_len;n=++_i){term=all[n];termvars=o.deps.varDependency(term);foundhere=false;fsel=void 0;fchoice=void 0;if(Object.keys(termvars).length===1){analysis=o.deps.getFacPossibilities(mixin({oneatatime:true,allowdenom:false,obj:term},o));for(_j=0,_len1=analysis.length;_j<_len1;_j++){possibility=analysis[_j];if(!!foundhere){continue}choice=possibility[0],sel=possibility[1],fac=possibility[2],residue=possibility[3];if(fac.type==="power"&&!o.deps.equal(fac.objs[0],zero)){expdeps=o.deps.varDependency(fac.objs[1]);if(((_ref1=expdeps[varname])!=null?_ref1.length:void 0)===vardeps[varname].length){if(!pow||o.deps.equal(pow,fac)){pow=fac;foundhere=true;fsel=sel;fchoice=choice}}}}}if(foundhere){terms.push(n);sels.push(fsel);choices.push(fchoice)}else{sels.push([]);choices.push("none")}}if(terms.length&&vardeps[varname].length===terms.length){return{argument:pow,selection:sels,choices:choices}}}}return Err("AUTOnopowtosolvefor")},perform:function(o){var all,choices,lefts,n,pow,powside,pre,sels,trm,_i,_len;pow=o.argument;sels=o.selection;choices=o.choices;lefts=o.deps.getTerms(o.target.objs[0]);all=lefts.concat(o.deps.getTerms(o.target.objs[1]));for(n=_i=0,_len=all.length;_i<_len;n=++_i){trm=all[n];if(choices[n]!=="none"){if(n<lefts.length){pre=lefts.length===1?[0]:[0,n]}else{pre=lefts.length+1===all.length?[1]:[1,n-lefts.length]}o.beforemark(pre.concat(o.deps.facPath(choices[n],sels[n])))}}o.doIf("solveLinearEq","firstfreeexp",{selection:sels,choices:choices,argument:pow});powside=o.deps.equal(o.target.objs[0],pow)?0:1;o["do"]("logifyRelationSides","logbothsides",{argument:o.target.objs[powside].objs[0]});o["do"]("logOfPowToProd","shootdownx",{aim:[powside]});o["do"]("logOfBaseToOne","collapselogtoone",{aim:[powside,1]});o["do"]("purgeOneFacs","removeone",{aim:[powside],selection:[[1]]});return o.aftermark([powside])}};solvePowEq={info:{name:"solvePowEq",effect:"simplifying",example:{str:"pi+(x^4)/2=7",choices:["none","numerself","none"],selection:[[],[0],[]],argument:Pow(x,four)},desperate:true,tags:["relation","log","exponent"],uses:["solveLinearEq","collapseRoot","rootifyRelationSides","evalNumericDivTest","evalIfElse","expandAbsPartInRelAndFix"]},target:"relation",argument:{instruction:"ARGpowtosolvefor",validate:function(o){var side,term,_i,_j,_len,_len1,_ref1,_ref2;if(o.argument.type!=="power"){return Err("ARGmustbepow")}else{_ref1=o.target.objs;for(_i=0,_len=_ref1.length;_i<_len;_i++){side=_ref1[_i];_ref2=o.deps.getTerms(side);for(_j=0,_len1=_ref2.length;_j<_len1;_j++){term=_ref2[_j];if(o.deps.getStraightFacAddress(term,o.argument)){return OK}}}return Err("ARGnosuchexpinrelation")}}},choices:{questions:function(o){var pos,term,_i,_len,_ref1,_results;_ref1=o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]));_results=[];for(pos=_i=0,_len=_ref1.length;_i<_len;pos=++_i){term=_ref1[pos];_results.push({options:["none"].concat(o.deps.getFacOptions(term))})}return _results}},selection:{filter:function(o){if(o.deps.equal(o.item,o.argument)||o.deps.getStraightFacAddress(o.item,o.argument)){return OK}else{return"SELsolveexpnotinterm"}},or0:true,totalmin:1,questions:function(o){var pos,term,_i,_len,_ref1,_results;_ref1=o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]));_results=[];for(pos=_i=0,_len=_ref1.length;_i<_len;pos=++_i){term=_ref1[pos];_results.push(function(t,c){return{from:function(i){return i.deps.getFacs(t,c)}}}(term,o.choices[pos]))}return _results},from:function(o){return o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]))}},auto:function(o){var all,analysis,basedeps,choice,choices,comp,exps,fac,fchoice,foundhere,fsel,lefts,n,possibility,pow,residue,rights,sel,sels,solvefor,term,terms,termvars,vardeps,varname,_i,_j,_len,_len1,_ref1;if(o.deps.containsType(o.target,"plusminus")){return Err("AUTOhasplusminusiwait")}comp=(_ref1=o.target.val)==="lt"||_ref1==="leq"||_ref1==="gt"||_ref1==="geq";if(o.target.objs[0].type!=="variable"&&o.target.objs[1].type!=="variable"){vardeps=o.deps.varDependency(o.target);lefts=o.deps.getTerms(o.target.objs[0]);rights=o.deps.getTerms(o.target.objs[1]);all=lefts.concat(rights);for(varname in vardeps){exps=vardeps[varname];if(exps.length&&Object.keys(o.deps.varDependency(exps[0])).length===0&&(exps.length===1||exps.slice(1).filter(function(e){return!o.deps.equal(exps[0],e)}).length===0)){solvefor={type:"variable",val:varname};terms=[];choices=[];sels=[];pow=null;for(n=_i=0,_len=all.length;_i<_len;n=++_i){term=all[n];termvars=o.deps.varDependency(term);foundhere=false;fsel=void 0;fchoice=void 0;if(Object.keys(termvars).length===1||o.desperate){analysis=o.deps.getFacPossibilities(mixin({oneatatime:true,allowdenom:false,obj:term},o));for(_j=0,_len1=analysis.length;_j<_len1;_j++){possibility=analysis[_j];if(!!foundhere){continue}choice=possibility[0],sel=possibility[1],fac=possibility[2],residue=possibility[3];
if(fac.type==="power"){basedeps=o.deps.varDependency(fac.objs[0]);if(basedeps[varname]){if(!pow||o.deps.equal(pow,fac)){pow=fac;foundhere=true;fsel=sel;fchoice=choice}}}}}if(foundhere){terms.push(n);sels.push(fsel);choices.push(fchoice)}else{sels.push([]);choices.push("none")}}if(terms.length&&vardeps[varname].length===terms.length){return{argument:pow,selection:sels,choices:choices}}}}}return Err("AUTOnopowtosolvefor")},perform:function(o){var all,choices,lefts,n,pow,powside,pre,rel,sels,trm,_i,_len;pow=o.argument;sels=o.selection;choices=o.choices;lefts=o.deps.getTerms(o.target.objs[0]);all=lefts.concat(o.deps.getTerms(o.target.objs[1]));for(n=_i=0,_len=all.length;_i<_len;n=++_i){trm=all[n];if(choices[n]!=="none"){if(n<lefts.length){pre=lefts.length===1?[0]:[0,n]}else{pre=lefts.length+1===all.length?[1]:[1,n-lefts.length]}o.beforemark(pre.concat(o.deps.facPath(choices[n],sels[n])))}}o.doIf("solveLinearEq","firstfreeexp",{selection:sels,choices:choices,argument:pow});rel=o.deps.lookUp(o.target,[],"relation");powside=o.deps.equal(rel.objs[0],pow)?0:1;o["do"]("rootifyRelationSides","baseup",{argument:rel.objs[powside].objs[1],assuming:"relation"});o["do"]("collapseRoot",{aim:[powside],assuming:"relation"});o["try"]("evalNumericDivTest","wasiteven",[powside,0],false,"relation");o["try"]("evalIfElse","decidebranch!",[powside],false,"relation");return o["try"]("expandAbsPartInRelAndFix","expandabs",[],false,"relation")}};liftVarFromDenomInRel={info:{name:"liftVarFromDenomInRel",effect:"simplifying",example:{str:"1/x2=7",selection:[[0],[0]],choices:["self"]},tags:["relation","denominator"],uses:["multEquality","multInequality","moveNegFromFracToFloorFac","distribute","multFacsIntoFrac","eliminateFromFrac","sameNumerDenomFracToOne"],lesson:"equationsolve"},target:"relation",prints:{errors:["AUTOalreadysolvedtermwise","AUTOalreadysolvedforreal"]},choices:{options:function(o){var frac,terms;({instruction:"CHOfactacticinfracterm"});terms=o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]));frac=terms[o.selection[0][0]];if(frac.type==="negation"){frac=frac.objs[0]}return o.deps.getFacOptions(frac.objs[1])}},selection:{max:1,questions:[{instruction:"SELfracterm",filter:function(o){if(o.item.type==="fraction"||o.item.type==="negation"&&o.item.objs[0].type==="fraction"){return OK}else{return Err("SELfracornegfrac")}},from:function(o){return o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]))}},{instruction:"SELdenomfac",from:function(o){var frac,terms;terms=o.deps.getTerms(o.target.objs[0]).concat(o.deps.getTerms(o.target.objs[1]));frac=terms[o.selection[0][0]];if(frac.type==="negation"){frac=frac.objs[0]}return o.deps.getFacs(frac.objs[1],o.choices[0])}}]},auto:function(o){var analysis,choice,denom,deps,fac,facdeps,facname,leftdeps,lefts,n,otherside,othersidedeps,poss,residue,rightdeps,rights,sel,side,term,terms,_i,_j,_k,_len,_len1,_len2,_ref1,_ref2;lefts=o.deps.getTerms(o.target.objs[0]);rights=o.deps.getTerms(o.target.objs[1]);terms=lefts.concat(rights);leftdeps=o.deps.varDependency(o.target.objs[0]);rightdeps=o.deps.varDependency(o.target.objs[1]);if(o.target.objs[0].type==="variable"&&!rightdeps[o.target.objs[0].val]||o.target.objs[1].type==="variable"&&!leftdeps[o.target.objs[1].val]){return Err("AUTOalreadysolvedforreal")}if(leftdeps.length+rightdeps.length>1){_ref1=[1,0];for(side=_i=0,_len=_ref1.length;_i<_len;side=++_i){otherside=_ref1[side];othersidedeps=side?leftdeps:rightdeps;analysis=o.deps.getFacPossibilities(mixin({oneatatime:true,allowdenom:false,obj:o.target.objs[side]},o));for(_j=0,_len1=analysis.length;_j<_len1;_j++){poss=analysis[_j];fac=poss[2];facdeps=o.deps.varDependency(fac);for(facname in facdeps){if(!othersidedeps[facname]){return Err("AUTOalreadysolvedtermwise")}}}}}for(n=_k=0,_len2=terms.length;_k<_len2;n=++_k){term=terms[n];if(!(term.type==="fraction"||term.type==="negation"&&term.objs[0].type==="fraction")){continue}denom=term.type==="negation"?term.objs[0].objs[1]:term.objs[1];deps=o.deps.varDependency(denom);if(Object.keys(deps).length>0){analysis=o.deps.getFacPossibilities(mixin({oneatatime:true,allowdenom:false,obj:denom},o));analysis.sort(function(o1,o2){var _ref2;if(o1.type==="variable"){return-1}else if((_ref2=!o1.type)==="facs"||_ref2==="negchildfacs"){return-1}else{return 1}});_ref2=analysis[0],choice=_ref2[0],sel=_ref2[1],fac=_ref2[2],residue=_ref2[3];return{choices:[choice],selection:[[n],sel]}}}return Err("AUTOnovardenoms")},perform:function(o){var choice,fac,facpath,facsel,lefts,term,terms,tnum,tpath,_ref1,_ref2,_ref3,_ref4,_ref5;_ref1=o.selection,_ref2=_ref1[0],tnum=_ref2[0],_ref3=_ref1[1],facsel=_ref3[0],_ref4=o.choices,choice=_ref4[0];lefts=o.deps.getTerms(o.target.objs[0]);terms=lefts.concat(o.deps.getTerms(o.target.objs[1]));tpath=tnum===0&&lefts.length===1?[0]:tnum<lefts.length?[0,tnum]:terms.length===lefts.length+1?[1]:[1,tnum-lefts.length];term=o.deps.lookUp(o.target,tpath);facpath=o.deps.facPath(choice,facsel);if(term.type==="negation"){o["do"]("moveNegFromFracToFloorFac","ditchneg",{aim:tpath,choices:["numer","self"],selection:[[0]]});o.beforemark(tpath.concat([0,1].concat(facpath)))}else{o.beforemark(tpath.concat([1].concat(facpath)))}fac=o.deps.lookUp(o.target,tpath.concat(1).concat(facpath));o["do"]((_ref5=o.target.val)==="eq"||_ref5==="neq"?"multEquality":"multInequality","multrelwithdenomfac",{argument:fac});tpath=[0].concat(tpath);o.doIf("distribute","dist",{aim:tpath.slice(0,2),selection:[[1]],assuming:"AND"});o["do"]("multFacsIntoFrac","multinthefac",{aim:tpath,selection:[[1],[0]],assuming:"AND"});o.doIf("sameNumerDenomFracToOne","nowcleansame",{aim:tpath,assuming:"AND"});o.doIf("eliminateFromFrac","nowclean",{aim:tpath,selection:[[0],[facsel]],choices:["facs",choice],assuming:"AND"});o.doIf("eliminateFromFrac","nowclean",{aim:tpath,selection:[[0],[facsel]],choices:["self",choice],assuming:"AND"});return o.aftermark([[0,tpath[0]?0:1,0],[1,0]],"AND")}};multEquality={info:{name:"multEquality",effect:"complicating",example:{str:"x=y",argument:z,direction:["left","right"]},tags:["relation","logicand","equality","forbiddenequality"],lesson:"relationmanip"},prints:{instructions:["ARGreldenom"]},target:{type:"relation",validate:function(o){var _ref1;if((_ref1=o.target.val)==="eq"||_ref1==="neq"){return OK}else{return Err("TARmustbeeqorneq")}}},argument:{instruction:"ARGreldenom"},perform:function(o){var dirs,fac,left,mark,marks,newleft,newrel,newright,right,_ref1;dirs=!o.direction?["left","left"]:typeof o.direction==="string"?[o.direction,o.direction]:o.direction;fac=o.argument;_ref1=o.target.objs,left=_ref1[0],right=_ref1[1];marks=[];if(dirs[0]==="right"){newleft=Prod(left,fac);marks.push([0,1])}else{newleft=Prod(fac,left);marks.push([0,0])}if(dirs[1]==="right"){newright=Prod(right,fac);marks.push([1,1])}else{newright=Prod(fac,right);marks.push([1,0])}newrel={type:"relation",val:o.target.val,objs:[newleft,newright]};if(o.cheat){return{result:newrel,aftermarks:marks}}else{return{result:And(newrel,Neq(fac,zero)),aftermarks:function(){var _i,_len,_results;_results=[];for(_i=0,_len=marks.length;_i<_len;_i++){mark=marks[_i];_results.push([0].concat(mark))}return _results}().concat([[1,0]])}}}};multInequality={info:{name:"multInequality",effect:"complicating",example:{str:"x>=y",argument:z,direction:["left","right"]},tags:["relation","ifelse","comparison","logicand"],lesson:"relationmanip"},prints:{instructions:["ARGreldenom"]},target:{type:"relation",validate:function(o){var _ref1;if(!((_ref1=o.target.val)==="eq"||_ref1==="neq")){return OK}else{return Err("TARmustbeineq")}}},argument:{instruction:"ARGreldenom"},perform:function(o){var dirs,fac,left,mark,marks,newleft,newrel,newright,res,right,_ref1;dirs=!o.direction?["left","left"]:typeof o.direction==="string"?[o.direction,o.direction]:o.direction;fac=o.argument;_ref1=o.target.objs,left=_ref1[0],right=_ref1[1];marks=[];if(dirs[0]==="right"){newleft=Prod(left,fac);marks.push([0,1])}else{newleft=Prod(fac,left);marks.push([0,0])}if(dirs[1]==="right"){newright=Prod(right,fac);marks.push([1,1])}else{newright=Prod(fac,right);marks.push([1,0])}newrel={type:"relation",val:o.target.val,objs:[newleft,newright]};res=IfElse(Lt(fac,zero),flipRel(newrel),o.cheat?newrel:And(newrel,Neq(fac,zero)));if(o.cheat){return{result:res,aftermarks:[[0,0]].concat(function(){var _i,_len,_results;_results=[];for(_i=0,_len=marks.length;_i<_len;_i++){mark=marks[_i];_results.push([1].concat(mark))}return _results}()).concat(function(){var _i,_len,_results;_results=[];for(_i=0,_len=marks.length;_i<_len;_i++){mark=marks[_i];_results.push([2].concat(mark))}return _results}())}}else{return{result:res,aftermarks:[[0,0]].concat(function(){var _i,_len,_results;_results=[];for(_i=0,_len=marks.length;_i<_len;_i++){mark=marks[_i];_results.push([1].concat(mark))}return _results}()).concat(function(){var _i,_len,_results;_results=[];for(_i=0,_len=marks.length;_i<_len;_i++){mark=marks[_i];_results.push([2,0].concat(mark))}return _results}()).concat([[2,1,0]])}}}};divEquality={info:{name:"divEquality",effect:"complicating",example:{str:"x=y",argument:z},tags:["relation","equality","forbiddenequality"],lesson:"relationmanip"},prints:{instructions:["ARGreldenom"]},target:{type:"relation",validate:function(o){var _ref1;if((_ref1=o.target.val)==="eq"||_ref1==="neq"){return OK}else{return Err("TARmustbeeqorneq")}}},argument:{instruction:"ARGreldenom"},perform:function(o){var denom,left,newrel,right,_ref1;denom=o.argument;_ref1=o.target.objs,left=_ref1[0],right=_ref1[1];newrel={type:"relation",val:o.target.val,objs:[Frac(left,denom),Frac(right,denom)]};return{result:Or(And(newrel,Neq(denom,zero)),And(o.target,Eq(denom,zero))),aftermarks:[[0,0,0,1],[0,0,1,1],[0,1,0],[1,1,0]]}}};divInequality={info:{name:"divInequality",effect:"complicating",example:{str:"x=>y",argument:z},tags:["relation","ifelse","comparison"],lesson:"relationmanip"},prints:{instructions:["ARGreldenom"]},target:{type:"relation",validate:function(o){var _ref1;if(!((_ref1=o.target.val)==="eq"||_ref1==="neq")){return OK}else{return Err("TARmustbeineq")}}},argument:{instruction:"ARGreldenom"},perform:function(o){var denom,left,newrel,right,_ref1;denom=o.argument;_ref1=o.target.objs,left=_ref1[0],right=_ref1[1];newrel={type:"relation",val:o.target.val,objs:[Frac(left,denom),Frac(right,denom)]};return{result:Or(IfElse(Lt(denom,zero),flipRel(newrel),And(newrel,Neq(denom,zero))),And(o.target,Eq(denom,zero))),aftermarks:[[0,0,0],[0,1,0,1],[0,1,1,1],[0,2,0,0,1],[0,2,0,1,1],[0,2,1,0],[1,1,0]]}}};divRelSidesAndFix={info:{name:"divRelSidesAndFix",effect:"complicating",example:{str:"2>z",argument:Neg(three)},tags:["relation","ifelse"],uses:["divEquality","divInequality","numericRelToBool","andWithIncompatiblePartsToFalse","evalIfElse","purgeTrueFromAnd","purgeFalseFromOr","andWithFalseIsFalse","zeroFacExprToZero","substitute"],lesson:"relationmanip"},prints:{instructions:["ARGreldenom"]},target:"relation",argument:{instruction:"ARGreldenom"},perform:function(o){var denom0,mark,not0,part,path,paths,_i,_j,_len,_len1,_ref1,_ref2,_ref3,_ref4;o["do"]((_ref1=o.target.val)==="eq"||_ref1==="neq"?"divEquality":"divInequality","wediv",{argument:o.argument});o["try"]("numericRelToBool","solveifelsecond",[0],false,"ifelse");o["try"]("evalIfElse","nowcollapse"+((_ref2=o.target.objs[0].objs[0])!=null?(_ref3=_ref2.type)!=null?_ref3.toLowerCase():void 0:void 0),[],false,"ifelse");denom0=o.target.type==="ifelse"?[2]:o.target.type==="OR"?[1]:o.target.objs[1].val==="eq"?[]:false;if(denom0){o["try"]("numericRelToBool","isdenomzero",denom0.concat([1]));o["try"]("substitute","denomcouldbezero",denom0);o["try"]("zeroFacExprToZero","sidetozero",denom0.concat([0,0]));o["try"]("zeroFacExprToZero","sidetozero",denom0.concat([0,1]));o["try"]("andWithIncompatiblePartsToFalse","zerocontr",denom0);o["try"]("numericRelToBool","relaftersubst",denom0.concat([0]));o["try"]("andWithFalseIsFalse","denomzerobranchisfalse",denom0);o["try"]("purgeTrueFromAnd","denomzerobranchistrue",denom0);if(denom0.length){o["try"]("purgeFalseFromOr","removedenomzerobranch",denom0.slice(0,-1))}}not0=o.target.type==="ifelse"?[1]:o.target.type==="OR"?[0]:o.target.objs[1].val==="neq"?[]:false;if(not0){o["try"]("numericRelToBool","evalzerotest",not0.concat([1]));o["try"]("purgeTrueFromAnd","removenotzerotrue",not0);o["try"]("andWithFalseIsFalse","collapseandsincefalse",not0)}paths=function(){switch(o.target.type){case"OR":return[[1]].concat(o.target.objs[0].type==="ifelse"?[[0,1],[0,2]]:[]);case"ifelse":return[[1],[2]];default:return[[]]}}();for(_i=0,_len=paths.length;_i<_len;_i++){path=paths[_i];part=o.deps.lookUp(o.target,path);_ref4=part.type==="AND"?[[0,0,1],[0,1,1],[1,0]]:[[0,1],[1,1]];for(_j=0,_len1=_ref4.length;_j<_len1;_j++){mark=_ref4[_j];o.aftermark(path.concat(mark))}}return o}};multRelSidesAndFix={info:{name:"multRelSidesAndFix",effect:"complicating",example:{str:"x>y",argument:Neg(two),direction:["left","right"]},tags:["relation","ifelse"],uses:["multEquality","multInequality","numericRelToBool","evalIfElse","purgeTrueFromAnd","andWithFalseIsFalse"],lesson:"relationmanip"},prints:{instructions:["ARGreldenom"]},target:"relation",argument:{instruction:"ARGreldenom"},perform:function(o){var mark,part,path,_i,_j,_len,_len1,_ref1,_ref2,_ref3;o["do"]((_ref1=o.target.val)==="eq"||_ref1==="neq"?"multEquality":"multInequality","wemult",{argument:o.argument,direction:o.direction});o["try"]("numericRelToBool","solveifelsecond",{aim:[0]});o["try"]("evalIfElse","nowcollapse"+o.target.objs[0].type.toLowerCase());if(!o.cheat){o["try"]("numericRelToBool","evalzerotest",{aim:[1]});o.doIf("purgeTrueFromAnd","removenotzerotrue",{selection:[[1]]});o.doIf("andWithFalseIsFalse","collapseandsincefalse",{selection:[[1]]})}if(o.target.type==="ifelse"){o.aftermark([0,0])}_ref2=o.target.type==="ifelse"?[[1],[2]]:[[]];for(_i=0,_len=_ref2.length;_i<_len;_i++){path=_ref2[_i];part=o.deps.lookUp(o.target,path);_ref3=part.type==="AND"?[[0,0,1],[0,1,1],[1,0]]:[[0,1],[1,1]];for(_j=0,_len1=_ref3.length;_j<_len1;_j++){mark=_ref3[_j];o.aftermark(path.concat(mark))}}return o}};if(typeof exports==="undefined"){exportTo=this.CATS.math}else{exportTo=exports}funcs={containsTypeWithVal:containsTypeWithVal,newEvalNumVal:newEvalNumVal,containsType:containsType,multRelSidesAndFix:multRelSidesAndFix,multEquality:multEquality,multInequality:multInequality,divRelSidesAndFix:divRelSidesAndFix,divEquality:divEquality,divInequality:divInequality,liftVarFromDenomInRel:liftVarFromDenomInRel,solvePowEq:solvePowEq,rootifyRelationSides:rootifyRelationSides,logifyRelationSides:logifyRelationSides,solveExpEq:solveExpEq,solveLogEq:solveLogEq,powerifyRelationSides:powerifyRelationSides,solveRootEq:solveRootEq,solveLinearEq:solveLinearEq,solveQuadHiddenInRoot:solveQuadHiddenInRoot,solveQuadHiddenInHigher:solveQuadHiddenInHigher,moveTermsBetweenSidesInRel:moveTermsBetweenSidesInRel,solveQuadraticEquation:solveQuadraticEquation,backwardsQuadrify:backwardsQuadrify,varDependency:varDependency,collapsePowInZeroRel:collapsePowInZeroRel,collapseRootInZeroRel:collapseRootInZeroRel,solveEqWithNoConstant:solveEqWithNoConstant,zeroProdMethod:zeroProdMethod,mergeNumFracFacOnOppRelSides:mergeNumFracFacOnOppRelSides,relTermAnalysis:relTermAnalysis,collapseNegationsInSumsInRelation:collapseNegationsInSumsInRelation,eliminateCommonInnerFacsInRel:eliminateCommonInnerFacsInRel,eliminateSameFacsFromRelationSides:eliminateSameFacsFromRelationSides,purgeEqualTermsFromRelation:purgeEqualTermsFromRelation,addToRelationSides:addToRelationSides};for(k in funcs){v=funcs[k];exportTo[k]=v}}).call(this);